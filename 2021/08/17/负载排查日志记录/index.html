<!-- @format -->



<!DOCTYPE html>
<html lang="en">
<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <!--360 使用 Google Chrome Frame-->
  <meta name="renderer" content="webkit">
  <!--百度禁止转码-->
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <!--Description-->
  
  <meta name="description" content="记一次服务器负载排查">
  
  <meta name="google-site-verification" content="J4gssmXGNI9-DfJ9w52mL5KFPlRCYvySveEN0RJFZHU" />
  <!--Author-->
  
  <meta name="author" content="李恒">
  
  <!--Open Graph Title-->
  <meta property="og:title" content="负载排查日志记录" />
  <!--Open Graph Description-->
  <meta property="og:description" content="记一次服务器负载排查" />
  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="Harthali" />
  <!--Type page-->
  
  <meta property="og:type" content="article" />
  
  <!--Page Cover-->
  
  <meta property="og:image" content="/null" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- Title -->
  
  <title>负载排查日志记录 - Harthali</title>
  <!-- 添加到主屏后的标题（iOS 6 新增） -->
  <meta name="apple-mobile-web-app-title" content="Harthali">
  <!-- 是否启用 WebApp 全屏模式 -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <link rel="apple-touch-startup-image" href="/assets/ splash-assets.png" media="(max-device-width: 700px)">
  <!-- 禁止数字识自动别为电话号码 -->
  <meta name="format-detection" content="telephone=no" />
  <link rel="shortcut icon" href="/null">
  <!--Apple iOS Safari ICON-->
  <link rel="apple-touch-icon" sizes="57x57" href="" />
  <link rel="apple-touch-icon" sizes="72x72" href="" />
  <link rel="apple-touch-icon" sizes="114x114" href="" />
  <link rel="apple-touch-icon" sizes="144x144" href="" />
  <!-- 添加 RSS 订阅 -->
  <link rel="alternate" type="application/rss+xml" title="Harthali" href="/atom.xml" />
  <!-- uc强制竖屏 -->
  <meta name="screen-orientation" content="portrait">
  <!-- QQ强制竖屏 -->
  <meta name="x5-orientation" content="portrait">
  <!-- UC强制全屏 -->
  <meta name="full-screen" content="yes">
  <!-- QQ强制全屏 -->
  <meta name="x5-fullscreen" content="true">
  <!-- UC应用模式 -->
  <meta name="browsermode" content="application">
  <!-- QQ应用模式 -->
  <meta name="x5-page-mode" content="app">
  <!-- https://material.io/resources/icons/?style=outline -->
  
  <script src="https://lf1-cdn-tos.bytegoofy.com/obj/iconpark/icons_20213_18.4a5f87dae8e6f9e336b9ad6fa00f8e8f.js"></script>
  
  
<style>
  .itp-gallery-title,
  .itp-gallery-subtitle,
  .itp-post-title,
  .itp-post-entry-title,
  .itp-post-entry-subtitle,
  .itp-mag-logo,
  .itp-index-title,
  .itp-post-entry-moment,
  .itp-header-actions-menu {
    font-family: ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans,Ubuntu,Cantarell,Helvetica Neue,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans,Ubuntu,Cantarell,Helvetica Neue,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;
  }

  .itp-header-title,
  .itp-m3-post-entry-info .title,
  .itp-header-actions,
  .itp-cover-title,
  .itp-cover-subtitle,
  .itp-post-subtitle,
  .itp-post-entry-title,
  .itp-m3-cover-subtitle,
  .itp-m3-cover-title,
  .itp-gallery-info .title,
  .footer-info {
    font-family: ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans,Ubuntu,Cantarell,Helvetica Neue,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans,Ubuntu,Cantarell,Helvetica Neue,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;
  }

  .article,
  .itp-post-entry-excerpt {
    font-family: 'SF UI Display', '.PingFang SC', 'PingFang SC', 'Neue Haas Grotesk Text Pro', 'Arial Nova', 'Segoe UI', 'Microsoft YaHei', 'Microsoft JhengHei', 'Helvetica Neue', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'Helvetica', 'Hiragino Sans GB', sans-serif;
  }
</style>

  <!-- Custom CSS/Sass -->
  
<link rel="stylesheet" href="/css/style.css">

  <!--样式切换-->
  
  
<link rel="stylesheet" href="/css/material3.css">

  
  
  
  
  <!--highlight.js CSS-->
  
  
<link rel="stylesheet" href="/css/highlight/github.css">

  
  
  <!-- jquery -->
  
  <script src="/js/jquery.min.js"></script>
  
  <!--Comment-->
  
  <!--Waline-->
  <script src="/js/waline.js" defer></script>
  <link rel="stylesheet" href="/css/waline.css" />
  
  <!--Vercel Audiences Analytics-->
  
  <!--umami analytics-->
  
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HFH67WJVKQ" defer></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'G-HFH67WJVKQ');
  </script>
  
  
  
  
  
  <!-- Google Search Advanced
  https://developers.google.com/search/docs/advanced/structured-data/search-gallery
  -->
  
  
  
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "headline": "负载排查日志记录",
      "image": "",
      "datePublished": "Tue Aug 17 2021 17:47:05 GMT+0800",
      "author": [{
        "@type": "Person",
        "name": "李恒",
        "url": "https://lihengtt.github.io"
      }]
    }
  </script>
  
  
  
  <!--<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      spacing: {
        '1': '8px',
        '2': '12px',
        '3': '16px',
        '4': '24px',
        '5': '32px',
        '6': '48px',
      },
      container: {
        center: true,
      },
      extend: {
        colors: {
          tblack: '#222831',
        },
        boxShadow: {
          'itp': '1px 10px 30px 0 rgb(0 0 0 / 10%)',
        }
      }
    }
  }
</script>-->

<link rel="stylesheet" href="/css/tailwind.css">

<meta name="generator" content="Hexo 8.1.1"></head>


<!--Other Pages-->


<body>
  <!-- Nav -->
  


<div class="itp-float-bar">
  <!--所有页面都显示-->
  <a class="itp-float-bar-item rounded" href="/" title="Harthali">
    
    <iconpark-icon class="navicon" name="home"></iconpark-icon>
    
  </a>
  
  <!--只在 **文章** 页面显示-->
  <a class="itp-float-bar-item rounded" onclick="scrollto(comment)" title="comment">
    
    <iconpark-icon class="navicon" name="comment"></iconpark-icon>
    
  </a>
  <a class="itp-float-bar-item rounded" id="open_toc" onclick="OpenToc()" title="Table of contents">
    
    <iconpark-icon class="navicon" name="list"></iconpark-icon>
    
  </a>
  <a class="itp-float-bar-item rounded" href="javascript:scroll(0,0)" title="to top">
    
    <iconpark-icon class="navicon" name="top"></iconpark-icon>
    
  </a>
  

  <div class="itp-float-layer itp-toc-layer">
    <div class="clost-btn" style="display: flex;">
      <a class="itp-float-layer-close-btn" id="close_btn">
        <div class="close_btn_red">
        </div>
      </a>
    </div>
    <ol class="itp-layer-toc"><li class="itp-layer-toc-item itp-layer-toc-level-2"><a class="itp-layer-toc-link" href="#top%E5%91%BD%E4%BB%A4"><span class="itp-layer-toc-text">top命令</span></a></li><li class="itp-layer-toc-item itp-layer-toc-level-2"><a class="itp-layer-toc-link" href="#%E4%BA%8C-top%E4%BA%A4%E4%BA%92%E5%91%BD%E4%BB%A4"><span class="itp-layer-toc-text">二.top交互命令</span></a></li></ol>
  </div>
  <div class="itp-float-layer-bg layer-bg-nodisplay" id="close_layer"></div>
</div>


<style>
  .navicon {
    font-size: 18px;
    padding-top: 18px;
    color: var(--main-black);
  }
</style>
  <!-- Main Content -->
  

<section class="pjax-area">
  <div class="content-area post-content-area">
    <div class=" left-area"></div>
    <div class="main-area">
      <div class="itp-m3-card post-cover">
        <div class="itp-m3-card-cover">
          <div class="itp-m3-cover-bg" style="
          background-image: url();
          background-size: cover;
          background-position: center center;
        ">
            <div class="itp-m3-card-cover-layer ">
              <div class="info-area pjax-area">
                <div class="itp-m3-cover-avatar">
                  <img src="https://lihengc.github.io/images/WechatIMG10.jpeg" class="nofancy">
                </div>
                <div class="itp-m3-cover-title" style="opacity: 1;">
                  负载排查日志记录
                </div>
                <div class="itp-m3-cover-subtitle" style="opacity: 0.8;">
                  
2021-08-17
<span> / </span>


<span> / </span>
5.4k
<style>
  .category-link {
    color: var(--main-black);
  }

  @media print {
    .itp-cover-subtitle a {
      color: var(--main-black) !important;
    }
  }

  @media screen {
    .itp-cover-subtitle a {
      color: #fff !important;
    }
  }
</style>

                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article">
          <p>下班之际，突然出现的问题，出现了mysql many connect，心塞。<br>直接上服务器</p>
<span id="more"></span>
<h2 id="top命令"><a href="#top命令" class="headerlink" title="top命令"></a>top命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">top - 10:11:18 up 45 days, 17:38,  2 <span class="built_in">users</span>,  load average: 12.14, 8.20, 4.58</span><br><span class="line">Tasks: 544 total,   1 running, 542 sleeping,   0 stopped,   1 zombie</span><br><span class="line">%Cpu(s): 15.2 us,  5.2 sy,  0.0 ni, 79.3 <span class="built_in">id</span>,  0.3 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem :  3881920 total,   278624 free,  1525840 used,  2077456 buff/cache</span><br><span class="line">KiB Swap:  1049596 total,   3 free,    1049593 used.  1844424 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                                                    </span><br><span class="line"> 8758 root      10 -10  174128  52928   5200 S   5.6  1.4 286:24.76 AliYunDun                                                                                                                                                                  </span><br><span class="line">  494 dbus      20   0   28368   4600    440 S   0.7  0.1 406:50.17 dbus-daemon                                                                                                                                                                </span><br><span class="line">10819 root      20   0  159184   3792   1596 S   0.7  0.1   0:00.10 top                                                                                                                                                                        </span><br><span class="line">11790 root      20   0  158168   2784   1580 R   0.7  0.1   0:00.05 top                                                                                                                                                                        </span><br><span class="line">    1 root      20   0  191476   2996   1228 S   0.3  0.1 293:27.53 systemd                                                                                                                                                                    </span><br><span class="line">    9 root      20   0       0      0      0 S   0.3  0.0  54:58.90 rcu_sched                                                                                                                                                                  </span><br><span class="line">  466 root      16  -4   55524    792    336 S   0.3  0.0  22:44.25 auditd                                                                                                                                                                     </span><br><span class="line">  543 root      20   0  342392  26176   1068 S   0.3  0.7  72:56.68 firewalld                                                                                                                                                                  </span><br><span class="line"> 2833 redis     20   0  159516   3376    956 S   0.3  0.1  76:19.86 redis-server                                                                                                                                                               </span><br><span class="line"> 3514 mysql     20   0 1753780 614536      0 S   0.3 15.8 115:27.34 mysqld                                                                                                                                                                     </span><br><span class="line"> 7760 root      10 -10   42152   2636    960 S   0.3  0.1   3:39.75 AliYunDunUpdate                                                                                                                                                            </span><br><span class="line">    2 root      20   0       0      0      0 S   0.0  0.0   0:01.22 kthreadd                                                                                                                                                                   </span><br><span class="line">    3 root      20   0       0      0      0 S   0.0  0.0   4:33.51 ksoftirqd/0                                                                                                                                                                </span><br><span class="line">    5 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 kworker/0:0H                                                                                                                                                               </span><br><span class="line">    7 root      rt   0       0      0      0 S   0.0  0.0   2:30.64 migration/0                                                                                                                                                                </span><br><span class="line">    8 root      20   0       0      0      0 S   0.0  0.0   0:00.00 rcu_bh                                                                                                                                                                     </span><br><span class="line">   10 root      rt   0       0      0      0 S   0.0  0.0   0:10.75 watchdog/0                                                                                                                                                                 </span><br><span class="line">   11 root      rt   0       0      0      0 S   0.0  0.0   0:09.12 watchdog/1                                                                                                                                                                 </span><br><span class="line">   12 root      rt   0       0      0      0 S   0.0  0.0   2:31.28 migration/1                                                                                                                                                                </span><br><span class="line">   13 root      20   0       0      0      0 S   0.0  0.0   4:46.43 ksoftirq</span><br></pre></td></tr></table></figure>

<h4 id="第一行：top-10-11-18-up-45-days-17-38-2-users-load-average-12-14-8-20-4-58"><a href="#第一行：top-10-11-18-up-45-days-17-38-2-users-load-average-12-14-8-20-4-58" class="headerlink" title="第一行：top - 10:11:18 up 45 days, 17:38,  2 users,  load average: 12.14, 8.20, 4.58"></a>第一行：top - 10:11:18 up 45 days, 17:38,  2 users,  load average: 12.14, 8.20, 4.58</h4><p>依次对应：系统当前时间 up 系统到目前为止i运行的时间， 当前登陆系统的用户数量， load average后面的三个数字分别表示距离现在一分钟，五分钟，十五分钟的负载情况。<br>这行信息与命令uptime显示的信息相同<br>注意：load average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了。</p>
<h4 id="top命令的第二行："><a href="#top命令的第二行：" class="headerlink" title="top命令的第二行："></a>top命令的第二行：</h4><p>Tasks: 544 total,   1 running, 542 sleeping,   0 stopped,   1 zombie<br>依次对应：tasks表示任务（进程），544 544，其中处于运行中的有1个，542（挂起），stopped状态即停止的进程数为0，zombie状态即僵尸的进程数为1个。</p>
<h4 id="top命令的第三行，cpu状态："><a href="#top命令的第三行，cpu状态：" class="headerlink" title="top命令的第三行，cpu状态："></a>top命令的第三行，cpu状态：</h4><p>%Cpu(s): 15.2 us,  5.2 sy,  0.0 ni, 79.3 id,  0.3 wa,  0.0 hi,  0.0 si,  0.0 st<br>依次对应：<br>us:user 用户空间占用cpu的百分比<br>sy:system 内核空间占用cpu的百分比<br>ni:niced 改变过优先级的进程占用cpu的百分比<br>id:空闲cpu百分比<br>wa:IO wait IO等待占用cpu的百分比<br>hi:Hardware IRQ 硬中断 占用cpu的百分比<br>si:software 软中断 占用cpu的百分比<br>st:被hypervisor偷去的时间</p>
<h4 id="top命令第四行，内存状态："><a href="#top命令第四行，内存状态：" class="headerlink" title="top命令第四行，内存状态："></a>top命令第四行，内存状态：</h4><p>KiB Mem :  3881920 total,   278624 free,  1525840 used,  2077456 buff&#x2F;cache<br>依次对应：物理内存总量（3.8G),空闲内存总量（2.7G),使用中的内存总量（1.5G),缓冲内存量<br>第四行中使用中的内存总量（used）指的是现在系统内核控制的内存数，空闲内存总量（free）是内核还未纳入其管控范围的数量。纳入内核管理的内存不见得都在使用中，还包括过去使用过的现在可以被重复利用的内存，内核并不把这些可被重新使用的内存交还到free中去，因此在linux上free内存会越来越少，但不用为此担心 </p>
<h4 id="top命令第五行，swap交换分区："><a href="#top命令第五行，swap交换分区：" class="headerlink" title="top命令第五行，swap交换分区："></a>top命令第五行，swap交换分区：</h4><p>KiB Swap:  1049596 total,   3 free,    1049593 used.  1844424 avail Mem<br>依次对应：交换区总量（1G），空闲交换区总量（0G),使用的交换区总量（1G），可用交换取总量</p>
<p>对于内存监控，在top里我们要时刻监控第五行swap交换分区的used，如果这个数值在不断的变化，说明内核在不断进行内存和swap的数据交换，这是真正的内存不够用了。</p>
<h4 id="top命令第七行，各进程的监控："><a href="#top命令第七行，各进程的监控：" class="headerlink" title="top命令第七行，各进程的监控："></a>top命令第七行，各进程的监控：</h4><p>PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND<br>依次对应： </p>
<ol>
<li>PID — 进程id </li>
<li>USER — 进程所有者 </li>
<li>PR — 进程优先级 </li>
<li>NI — nice值。负值表示高优先级，正值表示低优先级 </li>
<li>VIRT — 进程使用的虚拟内存总量，单位kb。VIRT&#x3D;SWAP+RES </li>
<li>RES — 进程使用的、未被换出的物理内存大小，单位kb。RES&#x3D;CODE+DATA </li>
<li>SHR — 共享内存大小，单位kb </li>
<li>S — 进程状态。D&#x3D;不可中断的睡眠状态 R&#x3D;运行 S&#x3D;睡眠 T&#x3D;跟踪&#x2F;停止 Z&#x3D;僵尸进程 </li>
<li>%CPU — 上次更新到现在的CPU时间占用百分比 </li>
<li>%MEM — 进程使用的物理内存百分比 </li>
<li>TIME+ — 进程使用的CPU时间总计，单位1&#x2F;100秒 </li>
<li>COMMAND — 进程名称（命令名&#x2F;命令行）</li>
</ol>
<h2 id="二-top交互命令"><a href="#二-top交互命令" class="headerlink" title="二.top交互命令"></a>二.top交互命令</h2><p>  1.1 ‘h’ 帮助<br>  top命令进入视图后，键入h会显示如下界面，显示交互命令的帮助菜单 </p>
<p>  1.2 敲ENTER或者 SPACE键: 刷新显示</p>
<p>  1.3 A’: 切换交替显示模式<br>  top命令视图下，键入‘A‘显示如下：<br>显示4个窗口：Def （默认字段组）<br>Job （任务字段组）<br>Mem （内存字段组）<br>Usr （用户字段组）<br>四组字段共有一个独立的可配置的概括区域和它自己的可配置任务区域。4个窗口中只有一个窗口是当前窗口。当前窗口的名称显示在左上方。（注：只有当前窗口才会接受你键盘交互命令）<br>我们可以用’a’和’w’在4个 窗口间切换。’a’移到后一个窗口，’w’移到前一个窗口。用’g’命令你可以输入一个数字来选择当前窗口。<br>在键入‘A‘后在键入‘a‘的显示如下： </p>
<p>1.4 ‘B’: 触发粗体显示<br>一些重要信息会以加粗字体显示。这个命令可以切换粗体显示</p>
<p>1.5 ‘d’ 或‘s’: 设置显示的刷新间隔<br>当键下’d’或’s’时，你将被提示输入一个值（以秒为单位），它会以设置的值作为刷新间隔。如果你这里输入了6.0，top将会每秒刷新<br>1.6 ‘l’、‘t’、‘m’: 切换负载、任务、内存信息的显示</p>
<p>1.7 ‘f’: 字段管理<br>用于选择你想要显示的字段。用’*’标记的是已选择的。 </p>
<p>上下光标键在字段内导航，左光标键可以选择字段，回车或右光标键确认。</p>
<p>按’&lt;’移动已排序的字段到左边，’&gt;’则移动到右边。 </p>
<p>1.8 ‘R’: 反向排序</p>
<p>1.9 ‘c’: 触发命令<br>切换是否显示进程启动时的完整路径和程序名。 </p>
<p>键入‘c’后显示：<br>2.0 ‘i’: 空闲任务<br>切换显示空闲任务 </p>
<h4 id="top中的load-average值的含义–针对的是cpu"><a href="#top中的load-average值的含义–针对的是cpu" class="headerlink" title="top中的load average值的含义–针对的是cpu"></a>top中的load average值的含义–针对的是cpu</h4><ol>
<li>单核处理器<br>假设我们的系统是单CPU单内核的，把它比喻成是一条单向马路，把CPU任务比作汽车。当车不多的时候，load &lt;1；当车占满整个马路的时候 load&#x3D;1；当马路都站满了，而且马路外还堆满了汽车的时候，load&gt;1</li>
<li>多核处理器<br>我们经常会发现服务器Load &gt; 1但是运行仍然不错，那是因为服务器是多核处理器（Multi-core）。<br>假设我们服务器CPU是2核，那么将意味我们拥有2条马路，我们的Load &#x3D; 2时，所有马路都跑满车辆。<br>注：查看cpu 核数命令：<br>grep ‘model name’ &#x2F;proc&#x2F;cpuinfo | wc -l</li>
<li>什么样的Load average值要提高警惕<br>0.7 &lt; load &lt; 1: 此时是不错的状态，如果进来更多的汽车，你的马路仍然可以应付。<br>load &#x3D; 1: 你的马路即将拥堵，而且没有更多的资源额外的任务，赶紧看看发生了什么吧。<br>load &gt; 5: 非常严重拥堵，我们的马路非常繁忙，每辆车都无法很快的运行</li>
<li>三种Load值，应该看哪个<br>通常我们先看15分钟load，如果load很高，再看1分钟和5分钟负载，查看是否有下降趋势。<br>1分钟负载值 &gt; 1，那么我们不用担心，但是如果15分钟负载都超过1，我们要赶紧看看发生了什么事情。所以我们要根据实际情况查看这三个值</li>
</ol>
<h4 id="swap和内存"><a href="#swap和内存" class="headerlink" title="swap和内存"></a>swap和内存</h4><p>swap是什么？<br>Linux系统的Swap分区，即交换区，Swap空间的作用可简单描述为：当系统的物理内存不够用的时候，就需要将物理内存中的一部分空间释放出来，以供当前运行的程序使用。那些被释放的空间可能来自一些很长时间没有什么操作的程序，这些被释放的空间被临时保存到Swap空间中，等到那些程序要运行时，再从Swap中恢复保存的数据到内存中。这样，系统总是在物理内存不够时，才进行Swap交换。其实，Swap的调整对Linux服务器，特别是Web服务器的性能至关重要。通过调整Swap，有时可以越过系统性能瓶颈，节省系统升级费用。</p>
<p>什么时候使用swap？<br>交换分区并不是等到物理内存用尽了才使用的，是否尽量的使用或不使用swap，在内核空间有一个参数控制。</p>
<p>内核空间交换区分利用参数查看命令:cat &#x2F;proc&#x2F;sys&#x2F;vm&#x2F;swappiness<br>参数说明：<br>swappiness&#x3D;0 的时候表示最大限度使用物理内存，然后才是swap空间；swappiness＝100 的时候表示积极的使用swap分区，并且把内存上的数据及时的搬运到swap空间里面。<br>考虑到以下情况：<br>1）安装系统时难以确定内存的负荷，如何设置交换分区大小。<br>2）系统中物理内存越大，所需交换分区就会越少。</p>
<p>swap大小设置<br>平时安装系统，swap默认都分内存的2倍，因为现在有硬盘空间都很大，也不在乎那几十G的空间。合理建议：</p>
<ol>
<li>内存:&lt;&#x3D;4g SWAP:4G</li>
<li>内存:4-16g SWAP:8G</li>
<li>内存:16-64g SWAP:16G</li>
<li>内存:64-256g SWAP:32G</li>
</ol>
<h4 id="wa：cpu等待磁盘写入完成时间"><a href="#wa：cpu等待磁盘写入完成时间" class="headerlink" title="wa：cpu等待磁盘写入完成时间"></a>wa：cpu等待磁盘写入完成时间</h4><p>如果一台机器看到wa特别高，那么一般说明是磁盘IO出现问题，可以使用iostat等命令继续进行详细分析。<br>iotop的命令可以看到具体是哪个进程占用 IO 高<br>如果要看具体是哪个磁盘 IO 高，则用-iostat</p>
<h3 id="查看服务器IO状态-iostat"><a href="#查看服务器IO状态-iostat" class="headerlink" title="查看服务器IO状态-iostat"></a>查看服务器IO状态-iostat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Linux 3.10.0-514.26.2.el7.x86_64 (izj6c13kpist8ckeii2xaaz)      08/18/2021      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %<span class="built_in">nice</span> %system %iowait  %steal   %idle</span><br><span class="line">          12.17    0.00    4.31    1.00    0.00   82.52</span><br><span class="line"></span><br><span class="line">Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn</span><br><span class="line">vda              39.66       131.92       218.71  521475377  864535016</span><br></pre></td></tr></table></figure>
<h4 id="cpu属性值说明"><a href="#cpu属性值说明" class="headerlink" title="cpu属性值说明"></a>cpu属性值说明</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">%user：CPU处在用户模式下的时间百分比。</span><br><span class="line"></span><br><span class="line">%<span class="built_in">nice</span>：CPU处在带NICE值的用户模式下的时间百分比。</span><br><span class="line"></span><br><span class="line">%system：CPU处在系统模式下的时间百分比。</span><br><span class="line"></span><br><span class="line">%iowait：CPU等待输入输出完成时间的百分比。</span><br><span class="line"></span><br><span class="line">%steal：管理程序维护另一个虚拟处理器时，虚拟CPU的无意识等待时间百分比。</span><br><span class="line"></span><br><span class="line">%idle：CPU空闲时间百分比。</span><br></pre></td></tr></table></figure>

<h4 id="备注"><a href="#备注" class="headerlink" title="备注:"></a>备注:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">如果%iowait的值过高，表示硬盘存在I/O瓶颈</span><br><span class="line"></span><br><span class="line">如果%idle值高，表示CPU较空闲</span><br><span class="line"></span><br><span class="line">如果%idle值高但系统响应慢时，可能是CPU等待分配内存，应加大内存容量。</span><br><span class="line"></span><br><span class="line">如果%idle值持续低于10，表明CPU处理能力相对较低，系统中最需要解决的资源是CPU。</span><br></pre></td></tr></table></figure>

        </div>
        <div class="itp-m3-post-info_area">
          <div class="info_area-category">
            
            
            <div class="itp-m3-chip-normal-list">
              <a class="tag-none-link" href="/tags/linux/" rel="tag">linux</a>
            </div>
            
          </div>
          <div class="info_area-copyright">
            <p>本文著作权归作者&nbsp李恒&nbsp所有，转载或引用请联系作者获得授权。</p>
          </div>
        </div>
      </div>
      
      <div class="itp-m3-card itp-m3-post-comment_area" id="comment">
        
<div id="waline"></div>
<script>
  function startWaline() {
    Waline.init({
      el: '#waline',
      serverURL: 'https://comment.tripper.press/',
      path: '/2021/08/17/%E8%B4%9F%E8%BD%BD%E6%8E%92%E6%9F%A5%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/',
      dark: 'auto',
      search: false,
      imageUploader: false,
      wordLimit: [5, 200],
      emoji: [
        'https://imgur.lzmun.com/press_assets/emojis/bili'
      ],
    })
  };
  document.addEventListener("DOMContentLoaded", startWaline);
</script>
<style>
  button[title="表情包"] {
    display: none;
  }

  .wl-panel {
    border-radius: 3px !important;
  }

  .wl-btn {
    border-radius: 3px !important;
  }

  .wl-power {
    text-align: center;
    opacity: 0.3;
  }
</style>

      </div>
      
    </div>
    <div class="right-area">
      
      

<div id="column-toc-m3" class="noprn column-toc-m3 itp-toc-m3-sidetop">
  <ol class="itp-toc"><li class="itp-toc-item itp-toc-level-2"><a class="itp-toc-link" href="#top%E5%91%BD%E4%BB%A4"><span class="itp-toc-text">top命令</span></a></li><li class="itp-toc-item itp-toc-level-2"><a class="itp-toc-link" href="#%E4%BA%8C-top%E4%BA%A4%E4%BA%92%E5%91%BD%E4%BB%A4"><span class="itp-toc-text">二.top交互命令</span></a><ol class="itp-toc-child"><li class="itp-toc-item itp-toc-level-3"><a class="itp-toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E5%99%A8IO%E7%8A%B6%E6%80%81-iostat"><span class="itp-toc-text">查看服务器IO状态-iostat</span></a></li></ol></li></ol>
</div>

      
    </div>
  </div>
  
  <!--
<div class="mdui-dialog" id="shareDialogText" style="text-align: center;">
  <div class="itp-share-card" id="shareInfo">
    <div class="itp-share-cover" style="background: url('');">
      <div class="itp-share-layer">
        <div class="itp-share-info">
          <div class="itp-share-avatar">
            <img src="https://lihengc.github.io/images/WechatIMG10.jpeg" class="nofancy">
          </div>
          <div class="itp-share-title">负载排查日志记录</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="mdui-dialog" id="shareDialogImg" style="text-align: center;">
  分享图已生成
</div>-->
</section>
  <!-- Footer -->
  <!-- Footer -->
<footer class="itp-footer text-center">
  <section class="footer-info">
    Harthali &copy; 2016 - 2025
    
    <span> / </span>
    65k
    
    
    
    <span> / Theme</span>
    <a href="https://github.com/aiokr/hexo-theme-type" target="_blank">Type
    </a>
  </section>
  
    <a href="../about/" target="_blank">
      <img width="80px" height="80px" style="padding-top: 12px; display: block; margin: 0 auto;" src="https://imgur.lzmun.com/picgo/after2022/tripper2whitefull.png_avatar" alt="footer logo"></a>
  
</footer>
  <!-- After footer scripts -->
  <!-- fancybox -->

<script src="/js/fancybox.umd.js" defer></script>
<link rel="stylesheet" href="/css/fancybox.css" />

<!-- mdui -->

<!-- busuanzi -->

<!-- highlightjs -->


<script src="/js/highlight.min.js" async></script>

<script>window.addEventListener('load', () => hljs.initHighlighting());</script>
<script>
  $("pre.code").each(function() {
    $(this).html("<ol><li>" + $(this).html().replace(/\n/g, "\n</li><li>") + "\n</li></ol>");
  });
</script>



<script src="/js/app.js"></script>



<!--

<script src="/js/canvas2image.js"></script>


<script src="/js/shareimg.js"></script>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.js" defer></script>
-->
<!--lazyload-->


<script src="/js/lazyload.js"></script>


<!--PJAX-->
<!--Pjax from https://github.com/MoOx/pjax-->

<!--<script src="https://cdn.jsdelivr.net/npm/pjax/pjax.js"></script>-->
<!---->
<!---->
<!---->
<!---->
<!--首页键盘快捷键-->

  <style>
  :root {
    --main-color: #71AFDD;
    --sub-color: #6CD9CE;
    --main-black: #222831;
  }
</style>
</body>




</html>
