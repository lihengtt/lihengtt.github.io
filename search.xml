<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>李恒 · 个人简历</title>
      <link href="/2025/12/05/%E6%9D%8E%E6%81%92-%E4%B8%AA%E4%BA%BA%E7%AE%80%E5%8E%86/"/>
      <url>/2025/12/05/%E6%9D%8E%E6%81%92-%E4%B8%AA%E4%BA%BA%E7%AE%80%E5%8E%86/</url>
      
        <content type="html"><![CDATA[<h1 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h1><ul><li>姓名：李恒</li><li>职位：软件工程师</li><li>地点：中国 · 四川省</li></ul><h1 id="个人简介"><a href="#个人简介" class="headerlink" title="个人简介"></a>个人简介</h1><ul><li>擅长 Laravel、ThinkPHP、Yii 等 PHP 框架</li><li>熟练掌握 Swoole、Hyperf 协程框架，熟练使用 Workerman</li><li>对系统架构、分布式部署、微服务架构有实践经验与方法论</li><li>注重代码可读性与优雅设计，重视规范化与高质量注释</li></ul><h1 id="技能栈"><a href="#技能栈" class="headerlink" title="技能栈"></a>技能栈</h1><ul><li>后端：PHP（Laravel&#x2F;TP&#x2F;Yii&#x2F;Hyperf&#x2F;Swoole&#x2F;Workerman）、Node.js</li><li>前端：React、Vue、Uni-app、Electron、JavaScript、TypeScript、CSS、Sass</li><li>其他：Python、C++、Java、Shell</li></ul><h1 id="框架与架构经验"><a href="#框架与架构经验" class="headerlink" title="框架与架构经验"></a>框架与架构经验</h1><p>– 高并发与协程：基于 Swoole&#x2F;Hyperf 的协程服务与 IO 密集型任务优化<br>– 微服务与分布式：服务拆分、接口治理、配置中心、熔断限流与灰度发布<br>– 系统工程：日志链路、性能分析、可观测性与故障排查流程建设</p><h1 id="价值观与习惯"><a href="#价值观与习惯" class="headerlink" title="价值观与习惯"></a>价值观与习惯</h1><p>– 重视注释与命名，追求可维护的架构与清晰的边界<br>– 偏好自动化与工程化实践（CI&#x2F;CD、监控告警）<br>– 在复杂系统中坚持“简化、拆分、分层”的设计原则<br>– 不倾向“屎山代码”，尽可能减少冗余，追求积木式开发与高复用性</p><h1 id="技术主张"><a href="#技术主张" class="headerlink" title="技术主张"></a>技术主张</h1><ul><li>语言选择务实：在飞速迭代的时代，没有“最好的语言”，应基于业务场景选型</li><li>接口开发首选 PHP：快速便捷、交付效率高，作为接口层是我的最优选择</li><li>安全取决于工程实践：安全问题多源于开发与规范，重视工程化与流程保障</li><li>性能与扩展性：通过分发&#x2F;分片&#x2F;队列等手段扩展系统性能与吞吐</li><li>底层服务选型：对性能敏感的底层模块使用更适合的语言实现</li></ul><h1 id="联系方式"><a href="#联系方式" class="headerlink" title="联系方式"></a>联系方式</h1><p>– GitHub：<code>https://github.com/lihengtt</code><br>– 邮箱：<code>138868082@qq.com</code></p><h1 id="教育经历"><a href="#教育经历" class="headerlink" title="教育经历"></a>教育经历</h1><ul><li>南京科技职业学院（中专）<ul><li>时间：2013–2015</li></ul></li></ul><h1 id="工作经历"><a href="#工作经历" class="headerlink" title="工作经历"></a>工作经历</h1><ul><li><p>绵阳兴信网络科技公司</p><ul><li>时间：2016–2018</li><li>职责：负责外包项目的设计与开发</li></ul></li><li><p>四川木雀科技有限公司</p><ul><li>时间：2018–至今</li></ul></li></ul><h1 id="项目经历"><a href="#项目经历" class="headerlink" title="项目经历"></a>项目经历</h1><details><summary><strong>LINKWIFI · 本地商家与 WiFi 运营平台</strong> — 小程序 + 后台一体化</summary><ul><li>概述：基于微信小程序的本地商家与 WiFi 运营平台，覆盖商家管理、WiFi 配置、订单支付与收益结算全流程</li><li>技术栈：Uni-app、Vue&#x2F;Vuex；Laravel 8、Sanctum、laravel-admin、MySQL；RESTful API（统一响应）</li><li>核心功能：商家&#x2F;分类管理、附近检索；WiFi 配网与二维码；订单&#x2F;钱包&#x2F;提现；邀请与团队；地图与帮助中心</li><li>职责：后端分层实现（仓储&#x2F;服务&#x2F;控制器）、数据库迁移与数据填充、前端分类选择器与表单校验、联调与文档</li><li>亮点：分类系统打通、批量任务队列分批处理、统一响应与异常封装（api-docs）</li><li>成果：打通业务闭环、提升连接体验；接口与数据结构规范化，降低联调成本</li></ul></details><details><summary><strong>Rsync Deployment · VSCode 文件同步插件</strong> — rsync 驱动的高效部署</summary><ul><li>概述：面向 Web 开发与运维的 VSCode 插件，rsync + SSH 提供稳定高效的文件同步，减少手动上传错误，保障多环境一致</li><li>功能：服务器&#x2F;路径&#x2F;规则配置；本地&#x2F;远程文件树；手动&#x2F;自动同步；日志与性能统计</li><li>技术：VSCode Extension API、TypeScript、Node.js（fs&#x2F;child_process）、chokidar、WebView；Workspace Settings + JSON</li><li>亮点：Profile 化多环境配置、增量&#x2F;断点续传、完整审计与错误链路</li><li>成果：一键式同步替代手工发布，交付效率显著提升，环境一致性稳定</li></ul></details><details><summary><strong>mologin 浏览器 · 指纹与环境隔离</strong> — Chromium 二次开发</summary><ul><li>定位：虚拟浏览器技术生成可控指纹，替代 VPS&#x2F;虚拟机多账号管理，面向防关联与大规模运营</li><li>技术：PHP + MySQL 后端；Electron 客户端；Chromium 内核二次开发</li><li>职责：后端账号&#x2F;环境&#x2F;策略服务；环境配置与状态同步；策略下发与高可用保障</li><li>亮点：指纹伪装（分辨率&#x2F;字体&#x2F;语言&#x2F;UA 等）与噪声注入；虚拟环境隔离单机规模化（百&#x2F;千级），独立代理&#x2F;分辨率&#x2F;语言策略</li><li>成果：稳定隔离与可控指纹，安全可靠；降低运维成本，规模化管理更轻量</li></ul></details><details><summary><strong>域名搜索服务平台</strong> — 智能生成与批量检测</summary><ul><li>概述：关键词&#x2F;AI 生成、批量可用性与 WHOIS 查询；分层订阅（游客&#x2F;免费&#x2F;基础&#x2F;专业&#x2F;企业）、配额与速率限制；中英双语与动态语言包</li><li>技术栈：Vue3&#x2F;TS&#x2F;Vite&#x2F;AntD&#x2F;I18n；Laravel10&#x2F;Sanctum&#x2F;Mail；MySQL&#x2F;Redis；Python(FastAPI&#x2F;asyncio&#x2F;aiohttp)；Stripe、Name.com；Docker&#x2F;Nginx&#x2F;PM2；AI 抽象层（OpenAI&#x2F;Claude&#x2F;通义）</li><li>架构：分层（Controller→Service→Repository→Clients）；端到端任务编排（前端→入队→Python 执行→状态回写→导出）；多语言后端+前端 I18n</li><li>核心功能：生成策略（前后缀&#x2F;组合&#x2F;正则&#x2F;AI 思考过程）；批量检测（≤500&#x2F;次，文本&#x2F;文件导入）；WHOIS 批量与详情；用户中心与导出；计费与配额</li><li>任务流程：提交→校验→入队→进行中→完成&#x2F;失败；支持重试&#x2F;删除&#x2F;导出与筛选统计</li><li>安全与合规：Sanctum 认证、邮箱验证、节流；Nginx CORS、语言头；Stripe Webhooks 安全处理</li><li>运维：Docker 编排、Nginx 反代；Redis 队列与 Python 并行；诊断工具与环境切换</li></ul></details><details><summary><strong>虚拟卡平台</strong> — 微服务支付发行与授权</summary><ul><li>概述：微服务架构，目标安全&#x2F;高可用&#x2F;低延迟，覆盖虚拟卡发行、账户资金管理与交易授权</li><li>分层：API 网关；应用服务层（编排与策略）；核心业务层（授权&#x2F;账户&#x2F;发卡）；数据层（MySQL&#x2F;Redis&#x2F;审计）</li><li>核心业务：授权毫秒级（PHP8 + Swoole&#x2F;Hyperf + Redis）；账户强一致事务与对账；发卡生命周期&#x2F;风控&#x2F;限额</li><li>关键技术：协程化服务、连接池、异步批处理；Docker + K8s 滚动升级&#x2F;健康检查&#x2F;熔断限流；HSM&#x2F;KMS 令牌化符合 PCI DSS；外部对接银行&#x2F;卡组织&#x2F;KYC</li><li>成果：合规前提下低延迟授权与高稳定资金服务；架构可扩展，便于多机构对接与业务扩张</li></ul></details>]]></content>
      
      
      <categories>
          
          <category> 关于 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 简历 </tag>
            
            <tag> 关于我 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ssh2提示无法交换加密密钥</title>
      <link href="/2023/11/01/ssh2%E6%8F%90%E7%A4%BA%E6%97%A0%E6%B3%95%E4%BA%A4%E6%8D%A2%E5%8A%A0%E5%AF%86%E5%AF%86%E9%92%A5/"/>
      <url>/2023/11/01/ssh2%E6%8F%90%E7%A4%BA%E6%97%A0%E6%B3%95%E4%BA%A4%E6%8D%A2%E5%8A%A0%E5%AF%86%E5%AF%86%E9%92%A5/</url>
      
        <content type="html"><![CDATA[<p>给客户在很早之前就通过宝塔安装了ssh2的扩展，但是一年后突然报出了错误<code>Unable to exchange encryption keys</code>，发现是因为libssh2和扩展版本太老的原因，以下记录手动更新扩展的过程。</p><span id="more"></span><h3 id="首先下载安装包"><a href="#首先下载安装包" class="headerlink" title="首先下载安装包"></a>首先下载安装包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://www.libssh2.org/download/libssh2-1.10.0.tar.gz</span><br><span class="line">$ wget http://pecl.php.net/get/ssh2-1.3.1.tgz</span><br></pre></td></tr></table></figure><h3 id="先安装-libssh2，会将libssh2安装到-usr-local-libssh2"><a href="#先安装-libssh2，会将libssh2安装到-usr-local-libssh2" class="headerlink" title="先安装 libssh2，会将libssh2安装到&#x2F;usr&#x2F;local&#x2F;libssh2"></a>先安装 libssh2，会将libssh2安装到&#x2F;usr&#x2F;local&#x2F;libssh2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf libssh2-1.10.0.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> libssh2-1.10.0/</span><br><span class="line">$ ./configure --prefix=/usr/local/libssh2</span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="再安装ssh2扩展"><a href="#再安装ssh2扩展" class="headerlink" title="再安装ssh2扩展"></a>再安装ssh2扩展</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf ssh2-1.3.1.tgz </span><br><span class="line">$ <span class="built_in">cd</span> ssh2-1.3.1/</span><br><span class="line">$ /www/server/php/74/bin/phpize</span><br><span class="line">$ ./configure --prefix=/usr/local/ssh2 --with-ssh2=/usr/local/libssh2 --with-php-config=/www/server/php/74/bin/php-config</span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="php-ini写入扩展"><a href="#php-ini写入扩展" class="headerlink" title="php.ini写入扩展"></a>php.ini写入扩展</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extension=ssh2.so</span><br></pre></td></tr></table></figure><p>重载php，查看phpinfo();，看到对应你刚才安装的版本就行了</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>负载排查日志记录</title>
      <link href="/2021/08/17/%E8%B4%9F%E8%BD%BD%E6%8E%92%E6%9F%A5%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/"/>
      <url>/2021/08/17/%E8%B4%9F%E8%BD%BD%E6%8E%92%E6%9F%A5%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>下班之际，突然出现的问题，出现了mysql many connect，心塞。<br>直接上服务器</p><span id="more"></span><h2 id="top命令"><a href="#top命令" class="headerlink" title="top命令"></a>top命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">top - 10:11:18 up 45 days, 17:38,  2 <span class="built_in">users</span>,  load average: 12.14, 8.20, 4.58</span><br><span class="line">Tasks: 544 total,   1 running, 542 sleeping,   0 stopped,   1 zombie</span><br><span class="line">%Cpu(s): 15.2 us,  5.2 sy,  0.0 ni, 79.3 <span class="built_in">id</span>,  0.3 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem :  3881920 total,   278624 free,  1525840 used,  2077456 buff/cache</span><br><span class="line">KiB Swap:  1049596 total,   3 free,    1049593 used.  1844424 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                                                    </span><br><span class="line"> 8758 root      10 -10  174128  52928   5200 S   5.6  1.4 286:24.76 AliYunDun                                                                                                                                                                  </span><br><span class="line">  494 dbus      20   0   28368   4600    440 S   0.7  0.1 406:50.17 dbus-daemon                                                                                                                                                                </span><br><span class="line">10819 root      20   0  159184   3792   1596 S   0.7  0.1   0:00.10 top                                                                                                                                                                        </span><br><span class="line">11790 root      20   0  158168   2784   1580 R   0.7  0.1   0:00.05 top                                                                                                                                                                        </span><br><span class="line">    1 root      20   0  191476   2996   1228 S   0.3  0.1 293:27.53 systemd                                                                                                                                                                    </span><br><span class="line">    9 root      20   0       0      0      0 S   0.3  0.0  54:58.90 rcu_sched                                                                                                                                                                  </span><br><span class="line">  466 root      16  -4   55524    792    336 S   0.3  0.0  22:44.25 auditd                                                                                                                                                                     </span><br><span class="line">  543 root      20   0  342392  26176   1068 S   0.3  0.7  72:56.68 firewalld                                                                                                                                                                  </span><br><span class="line"> 2833 redis     20   0  159516   3376    956 S   0.3  0.1  76:19.86 redis-server                                                                                                                                                               </span><br><span class="line"> 3514 mysql     20   0 1753780 614536      0 S   0.3 15.8 115:27.34 mysqld                                                                                                                                                                     </span><br><span class="line"> 7760 root      10 -10   42152   2636    960 S   0.3  0.1   3:39.75 AliYunDunUpdate                                                                                                                                                            </span><br><span class="line">    2 root      20   0       0      0      0 S   0.0  0.0   0:01.22 kthreadd                                                                                                                                                                   </span><br><span class="line">    3 root      20   0       0      0      0 S   0.0  0.0   4:33.51 ksoftirqd/0                                                                                                                                                                </span><br><span class="line">    5 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 kworker/0:0H                                                                                                                                                               </span><br><span class="line">    7 root      rt   0       0      0      0 S   0.0  0.0   2:30.64 migration/0                                                                                                                                                                </span><br><span class="line">    8 root      20   0       0      0      0 S   0.0  0.0   0:00.00 rcu_bh                                                                                                                                                                     </span><br><span class="line">   10 root      rt   0       0      0      0 S   0.0  0.0   0:10.75 watchdog/0                                                                                                                                                                 </span><br><span class="line">   11 root      rt   0       0      0      0 S   0.0  0.0   0:09.12 watchdog/1                                                                                                                                                                 </span><br><span class="line">   12 root      rt   0       0      0      0 S   0.0  0.0   2:31.28 migration/1                                                                                                                                                                </span><br><span class="line">   13 root      20   0       0      0      0 S   0.0  0.0   4:46.43 ksoftirq</span><br></pre></td></tr></table></figure><h4 id="第一行：top-10-11-18-up-45-days-17-38-2-users-load-average-12-14-8-20-4-58"><a href="#第一行：top-10-11-18-up-45-days-17-38-2-users-load-average-12-14-8-20-4-58" class="headerlink" title="第一行：top - 10:11:18 up 45 days, 17:38,  2 users,  load average: 12.14, 8.20, 4.58"></a>第一行：top - 10:11:18 up 45 days, 17:38,  2 users,  load average: 12.14, 8.20, 4.58</h4><p>依次对应：系统当前时间 up 系统到目前为止i运行的时间， 当前登陆系统的用户数量， load average后面的三个数字分别表示距离现在一分钟，五分钟，十五分钟的负载情况。<br>这行信息与命令uptime显示的信息相同<br>注意：load average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了。</p><h4 id="top命令的第二行："><a href="#top命令的第二行：" class="headerlink" title="top命令的第二行："></a>top命令的第二行：</h4><p>Tasks: 544 total,   1 running, 542 sleeping,   0 stopped,   1 zombie<br>依次对应：tasks表示任务（进程），544 544，其中处于运行中的有1个，542（挂起），stopped状态即停止的进程数为0，zombie状态即僵尸的进程数为1个。</p><h4 id="top命令的第三行，cpu状态："><a href="#top命令的第三行，cpu状态：" class="headerlink" title="top命令的第三行，cpu状态："></a>top命令的第三行，cpu状态：</h4><p>%Cpu(s): 15.2 us,  5.2 sy,  0.0 ni, 79.3 id,  0.3 wa,  0.0 hi,  0.0 si,  0.0 st<br>依次对应：<br>us:user 用户空间占用cpu的百分比<br>sy:system 内核空间占用cpu的百分比<br>ni:niced 改变过优先级的进程占用cpu的百分比<br>id:空闲cpu百分比<br>wa:IO wait IO等待占用cpu的百分比<br>hi:Hardware IRQ 硬中断 占用cpu的百分比<br>si:software 软中断 占用cpu的百分比<br>st:被hypervisor偷去的时间</p><h4 id="top命令第四行，内存状态："><a href="#top命令第四行，内存状态：" class="headerlink" title="top命令第四行，内存状态："></a>top命令第四行，内存状态：</h4><p>KiB Mem :  3881920 total,   278624 free,  1525840 used,  2077456 buff&#x2F;cache<br>依次对应：物理内存总量（3.8G),空闲内存总量（2.7G),使用中的内存总量（1.5G),缓冲内存量<br>第四行中使用中的内存总量（used）指的是现在系统内核控制的内存数，空闲内存总量（free）是内核还未纳入其管控范围的数量。纳入内核管理的内存不见得都在使用中，还包括过去使用过的现在可以被重复利用的内存，内核并不把这些可被重新使用的内存交还到free中去，因此在linux上free内存会越来越少，但不用为此担心 </p><h4 id="top命令第五行，swap交换分区："><a href="#top命令第五行，swap交换分区：" class="headerlink" title="top命令第五行，swap交换分区："></a>top命令第五行，swap交换分区：</h4><p>KiB Swap:  1049596 total,   3 free,    1049593 used.  1844424 avail Mem<br>依次对应：交换区总量（1G），空闲交换区总量（0G),使用的交换区总量（1G），可用交换取总量</p><p>对于内存监控，在top里我们要时刻监控第五行swap交换分区的used，如果这个数值在不断的变化，说明内核在不断进行内存和swap的数据交换，这是真正的内存不够用了。</p><h4 id="top命令第七行，各进程的监控："><a href="#top命令第七行，各进程的监控：" class="headerlink" title="top命令第七行，各进程的监控："></a>top命令第七行，各进程的监控：</h4><p>PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND<br>依次对应： </p><ol><li>PID — 进程id </li><li>USER — 进程所有者 </li><li>PR — 进程优先级 </li><li>NI — nice值。负值表示高优先级，正值表示低优先级 </li><li>VIRT — 进程使用的虚拟内存总量，单位kb。VIRT&#x3D;SWAP+RES </li><li>RES — 进程使用的、未被换出的物理内存大小，单位kb。RES&#x3D;CODE+DATA </li><li>SHR — 共享内存大小，单位kb </li><li>S — 进程状态。D&#x3D;不可中断的睡眠状态 R&#x3D;运行 S&#x3D;睡眠 T&#x3D;跟踪&#x2F;停止 Z&#x3D;僵尸进程 </li><li>%CPU — 上次更新到现在的CPU时间占用百分比 </li><li>%MEM — 进程使用的物理内存百分比 </li><li>TIME+ — 进程使用的CPU时间总计，单位1&#x2F;100秒 </li><li>COMMAND — 进程名称（命令名&#x2F;命令行）</li></ol><h2 id="二-top交互命令"><a href="#二-top交互命令" class="headerlink" title="二.top交互命令"></a>二.top交互命令</h2><p>  1.1 ‘h’ 帮助<br>  top命令进入视图后，键入h会显示如下界面，显示交互命令的帮助菜单 </p><p>  1.2 敲ENTER或者 SPACE键: 刷新显示</p><p>  1.3 A’: 切换交替显示模式<br>  top命令视图下，键入‘A‘显示如下：<br>显示4个窗口：Def （默认字段组）<br>Job （任务字段组）<br>Mem （内存字段组）<br>Usr （用户字段组）<br>四组字段共有一个独立的可配置的概括区域和它自己的可配置任务区域。4个窗口中只有一个窗口是当前窗口。当前窗口的名称显示在左上方。（注：只有当前窗口才会接受你键盘交互命令）<br>我们可以用’a’和’w’在4个 窗口间切换。’a’移到后一个窗口，’w’移到前一个窗口。用’g’命令你可以输入一个数字来选择当前窗口。<br>在键入‘A‘后在键入‘a‘的显示如下： </p><p>1.4 ‘B’: 触发粗体显示<br>一些重要信息会以加粗字体显示。这个命令可以切换粗体显示</p><p>1.5 ‘d’ 或‘s’: 设置显示的刷新间隔<br>当键下’d’或’s’时，你将被提示输入一个值（以秒为单位），它会以设置的值作为刷新间隔。如果你这里输入了6.0，top将会每秒刷新<br>1.6 ‘l’、‘t’、‘m’: 切换负载、任务、内存信息的显示</p><p>1.7 ‘f’: 字段管理<br>用于选择你想要显示的字段。用’*’标记的是已选择的。 </p><p>上下光标键在字段内导航，左光标键可以选择字段，回车或右光标键确认。</p><p>按’&lt;’移动已排序的字段到左边，’&gt;’则移动到右边。 </p><p>1.8 ‘R’: 反向排序</p><p>1.9 ‘c’: 触发命令<br>切换是否显示进程启动时的完整路径和程序名。 </p><p>键入‘c’后显示：<br>2.0 ‘i’: 空闲任务<br>切换显示空闲任务 </p><h4 id="top中的load-average值的含义–针对的是cpu"><a href="#top中的load-average值的含义–针对的是cpu" class="headerlink" title="top中的load average值的含义–针对的是cpu"></a>top中的load average值的含义–针对的是cpu</h4><ol><li>单核处理器<br>假设我们的系统是单CPU单内核的，把它比喻成是一条单向马路，把CPU任务比作汽车。当车不多的时候，load &lt;1；当车占满整个马路的时候 load&#x3D;1；当马路都站满了，而且马路外还堆满了汽车的时候，load&gt;1</li><li>多核处理器<br>我们经常会发现服务器Load &gt; 1但是运行仍然不错，那是因为服务器是多核处理器（Multi-core）。<br>假设我们服务器CPU是2核，那么将意味我们拥有2条马路，我们的Load &#x3D; 2时，所有马路都跑满车辆。<br>注：查看cpu 核数命令：<br>grep ‘model name’ &#x2F;proc&#x2F;cpuinfo | wc -l</li><li>什么样的Load average值要提高警惕<br>0.7 &lt; load &lt; 1: 此时是不错的状态，如果进来更多的汽车，你的马路仍然可以应付。<br>load &#x3D; 1: 你的马路即将拥堵，而且没有更多的资源额外的任务，赶紧看看发生了什么吧。<br>load &gt; 5: 非常严重拥堵，我们的马路非常繁忙，每辆车都无法很快的运行</li><li>三种Load值，应该看哪个<br>通常我们先看15分钟load，如果load很高，再看1分钟和5分钟负载，查看是否有下降趋势。<br>1分钟负载值 &gt; 1，那么我们不用担心，但是如果15分钟负载都超过1，我们要赶紧看看发生了什么事情。所以我们要根据实际情况查看这三个值</li></ol><h4 id="swap和内存"><a href="#swap和内存" class="headerlink" title="swap和内存"></a>swap和内存</h4><p>swap是什么？<br>Linux系统的Swap分区，即交换区，Swap空间的作用可简单描述为：当系统的物理内存不够用的时候，就需要将物理内存中的一部分空间释放出来，以供当前运行的程序使用。那些被释放的空间可能来自一些很长时间没有什么操作的程序，这些被释放的空间被临时保存到Swap空间中，等到那些程序要运行时，再从Swap中恢复保存的数据到内存中。这样，系统总是在物理内存不够时，才进行Swap交换。其实，Swap的调整对Linux服务器，特别是Web服务器的性能至关重要。通过调整Swap，有时可以越过系统性能瓶颈，节省系统升级费用。</p><p>什么时候使用swap？<br>交换分区并不是等到物理内存用尽了才使用的，是否尽量的使用或不使用swap，在内核空间有一个参数控制。</p><p>内核空间交换区分利用参数查看命令:cat &#x2F;proc&#x2F;sys&#x2F;vm&#x2F;swappiness<br>参数说明：<br>swappiness&#x3D;0 的时候表示最大限度使用物理内存，然后才是swap空间；swappiness＝100 的时候表示积极的使用swap分区，并且把内存上的数据及时的搬运到swap空间里面。<br>考虑到以下情况：<br>1）安装系统时难以确定内存的负荷，如何设置交换分区大小。<br>2）系统中物理内存越大，所需交换分区就会越少。</p><p>swap大小设置<br>平时安装系统，swap默认都分内存的2倍，因为现在有硬盘空间都很大，也不在乎那几十G的空间。合理建议：</p><ol><li>内存:&lt;&#x3D;4g SWAP:4G</li><li>内存:4-16g SWAP:8G</li><li>内存:16-64g SWAP:16G</li><li>内存:64-256g SWAP:32G</li></ol><h4 id="wa：cpu等待磁盘写入完成时间"><a href="#wa：cpu等待磁盘写入完成时间" class="headerlink" title="wa：cpu等待磁盘写入完成时间"></a>wa：cpu等待磁盘写入完成时间</h4><p>如果一台机器看到wa特别高，那么一般说明是磁盘IO出现问题，可以使用iostat等命令继续进行详细分析。<br>iotop的命令可以看到具体是哪个进程占用 IO 高<br>如果要看具体是哪个磁盘 IO 高，则用-iostat</p><h3 id="查看服务器IO状态-iostat"><a href="#查看服务器IO状态-iostat" class="headerlink" title="查看服务器IO状态-iostat"></a>查看服务器IO状态-iostat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Linux 3.10.0-514.26.2.el7.x86_64 (izj6c13kpist8ckeii2xaaz)      08/18/2021      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %<span class="built_in">nice</span> %system %iowait  %steal   %idle</span><br><span class="line">          12.17    0.00    4.31    1.00    0.00   82.52</span><br><span class="line"></span><br><span class="line">Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn</span><br><span class="line">vda              39.66       131.92       218.71  521475377  864535016</span><br></pre></td></tr></table></figure><h4 id="cpu属性值说明"><a href="#cpu属性值说明" class="headerlink" title="cpu属性值说明"></a>cpu属性值说明</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">%user：CPU处在用户模式下的时间百分比。</span><br><span class="line"></span><br><span class="line">%<span class="built_in">nice</span>：CPU处在带NICE值的用户模式下的时间百分比。</span><br><span class="line"></span><br><span class="line">%system：CPU处在系统模式下的时间百分比。</span><br><span class="line"></span><br><span class="line">%iowait：CPU等待输入输出完成时间的百分比。</span><br><span class="line"></span><br><span class="line">%steal：管理程序维护另一个虚拟处理器时，虚拟CPU的无意识等待时间百分比。</span><br><span class="line"></span><br><span class="line">%idle：CPU空闲时间百分比。</span><br></pre></td></tr></table></figure><h4 id="备注"><a href="#备注" class="headerlink" title="备注:"></a>备注:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">如果%iowait的值过高，表示硬盘存在I/O瓶颈</span><br><span class="line"></span><br><span class="line">如果%idle值高，表示CPU较空闲</span><br><span class="line"></span><br><span class="line">如果%idle值高但系统响应慢时，可能是CPU等待分配内存，应加大内存容量。</span><br><span class="line"></span><br><span class="line">如果%idle值持续低于10，表明CPU处理能力相对较低，系统中最需要解决的资源是CPU。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Laravel-Vue-api数据加密解密</title>
      <link href="/2021/07/02/Laravel-Vue-api%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/"/>
      <url>/2021/07/02/Laravel-Vue-api%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<p>很多app已经应用了这个场景，为了使前后端的交互更加安全，我们让前后端的交互数据都进行了加密和解密，为此我这里只是提供一个思路，Laravel和Vue交互的一个加密和解密案例。</p><span id="more"></span><h2 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h2><p>laravel的中间件刚好应用于我这个需求，即请求前中间件（request）和请求后中间件（response），在前端数据传过来的时候，我通过request拿到数据进行解密，并且交给我的后端程序，最后再把我需要返回的数据交给response进行加密。</p><h3 id="创建中间件"><a href="#创建中间件" class="headerlink" title="创建中间件"></a>创建中间件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:middleware SecretMiddleware</span><br></pre></td></tr></table></figure><h3 id="再Kernel-php进行注册别名"><a href="#再Kernel-php进行注册别名" class="headerlink" title="再Kernel.php进行注册别名"></a>再Kernel.php进行注册别名</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$routeMiddleware</span> = [</span><br><span class="line">       <span class="string">&#x27;secret&#x27;</span> =&gt; <span class="title class_">\App\Http\Middleware\SecretMiddleware</span>::<span class="variable language_">class</span>,</span><br><span class="line">   ];</span><br></pre></td></tr></table></figure><h3 id="添加到apiGroups中，这样就可以让我们所有的api路由就调用该中间件"><a href="#添加到apiGroups中，这样就可以让我们所有的api路由就调用该中间件" class="headerlink" title="添加到apiGroups中，这样就可以让我们所有的api路由就调用该中间件"></a>添加到apiGroups中，这样就可以让我们所有的api路由就调用该中间件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$middlewareGroups</span> = [</span><br><span class="line">        <span class="string">&#x27;web&#x27;</span> =&gt; [</span><br><span class="line">            <span class="title class_">\App\Http\Middleware\EncryptCookies</span>::<span class="variable language_">class</span>,</span><br><span class="line">            <span class="title class_">\Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse</span>::<span class="variable language_">class</span>,</span><br><span class="line">            <span class="title class_">\Illuminate\Session\Middleware\StartSession</span>::<span class="variable language_">class</span>,</span><br><span class="line">            <span class="comment">// \Illuminate\Session\Middleware\AuthenticateSession::class,</span></span><br><span class="line">            <span class="title class_">\Illuminate\View\Middleware\ShareErrorsFromSession</span>::<span class="variable language_">class</span>,</span><br><span class="line"><span class="comment">//            \App\Http\Middleware\VerifyCsrfToken::class,</span></span><br><span class="line">            <span class="title class_">\Illuminate\Routing\Middleware\SubstituteBindings</span>::<span class="variable language_">class</span>,</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;api&#x27;</span> =&gt; [</span><br><span class="line">            <span class="string">&#x27;throttle:api&#x27;</span>,</span><br><span class="line">            <span class="title class_">\Illuminate\Routing\Middleware\SubstituteBindings</span>::<span class="variable language_">class</span>,</span><br><span class="line">            <span class="title class_">EnsureFrontendRequestsAreStateful</span>::<span class="variable language_">class</span>,</span><br><span class="line">            <span class="string">&#x27;secret&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">    ];</span><br></pre></td></tr></table></figure><h3 id="SecretMiddleware-php"><a href="#SecretMiddleware-php" class="headerlink" title="SecretMiddleware.php"></a>SecretMiddleware.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">Request <span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">count</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>()) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable">$body</span> = <span class="title class_">\Arr</span>::<span class="title function_ invoke__">first</span>(<span class="title function_ invoke__">array_keys</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>()));</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$body</span>) &#123;</span><br><span class="line">                <span class="variable">$body</span> = <span class="title class_">Functions</span>::<span class="title function_ invoke__">decrypt_pass</span>(<span class="variable">$body</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$body</span>)&#123;</span><br><span class="line">                    <span class="title function_ invoke__">parse_str</span>(<span class="title function_ invoke__">http_build_query</span>(<span class="variable">$body</span>), <span class="variable">$input</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">merge</span>(<span class="variable">$input</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$response</span> =  <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$content</span> = <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">getContent</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$content</span>) &#123;</span><br><span class="line">            <span class="variable">$content</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$content</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="comment"># 对 content 进行加密处理</span></span><br><span class="line">            <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">setContent</span>(<span class="title class_">Functions</span>::<span class="title function_ invoke__">encrypt_pass</span>(<span class="variable">$content</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><p>Vue这里我们用axios的request拦截器和response拦截器，分别进行了加密和解密，代码如下:</p><h3 id="请求拦截器"><a href="#请求拦截器" class="headerlink" title="请求拦截器"></a>请求拦截器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// request interceptor</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">token</span>) &#123;</span><br><span class="line">      config.<span class="property">headers</span>[<span class="string">&#x27;Authorization&#x27;</span>] = <span class="string">&#x27;Bearer &#x27;</span> + <span class="title function_">getToken</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> aesEncryptData = aes.<span class="title function_">encrypt</span>(config.<span class="property">data</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (aesEncryptData) &#123;</span><br><span class="line">      </span><br><span class="line">      config.<span class="property">data</span> = aesEncryptData</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error) <span class="comment">// for debug</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="相应拦截器"><a href="#相应拦截器" class="headerlink" title="相应拦截器"></a>相应拦截器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * If you want to get http information such as headers or status</span></span><br><span class="line"><span class="comment">   * Please return  response =&gt; response</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Determine the request status by custom code</span></span><br><span class="line"><span class="comment">   * Here is just an example</span></span><br><span class="line"><span class="comment">   * You can also judge the status by HTTP Status Code</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(aes.<span class="title function_">decrypt</span>(response.<span class="property">data</span>))</span><br><span class="line">    <span class="comment">// if the custom code is not 20000, it is judged as an error.</span></span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">code</span> !== <span class="number">200</span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">500</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">msg</span> === <span class="string">&#x27;validation.required&#x27;</span>)&#123;</span><br><span class="line">          res.<span class="property">msg</span> = <span class="string">&#x27;验证失败&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Message</span>.<span class="title function_">error</span>(&#123;</span><br><span class="line">          <span class="attr">content</span>: res.<span class="property">msg</span> || <span class="string">&#x27;Error&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">401</span>) &#123;</span><br><span class="line">        <span class="title class_">Message</span>.<span class="title function_">error</span>(&#123;</span><br><span class="line">          <span class="attr">content</span>: <span class="string">&#x27;登录状态不正确&#x27;</span> || <span class="string">&#x27;Error&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(res.<span class="property">msg</span> || <span class="string">&#x27;Error&#x27;</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error.<span class="property">response</span>) <span class="comment">// for debug</span></span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">response</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (error.<span class="property">response</span>.<span class="property">status</span> === <span class="number">401</span>) &#123;</span><br><span class="line">        <span class="comment">// store.dispatch(&#x27;login/qzlogout&#x27;)</span></span><br><span class="line">        <span class="title class_">Message</span>.<span class="title function_">error</span>(&#123;</span><br><span class="line">          <span class="attr">content</span>: <span class="string">&#x27;登录状态不正确，请重新登录&#x27;</span> || <span class="string">&#x27;Error&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="最后关于前后端加密和解密的文件我就不展示了，有需要探讨的可以加我联系方式～"><a href="#最后关于前后端加密和解密的文件我就不展示了，有需要探讨的可以加我联系方式～" class="headerlink" title="最后关于前后端加密和解密的文件我就不展示了，有需要探讨的可以加我联系方式～"></a>最后关于前后端加密和解密的文件我就不展示了，有需要探讨的可以加我联系方式～</h3><p><img src="/pexels-%D0%BC%D0%B0%D0%BA%D1%81%D0%B8%D0%BC-%D0%B8%D1%81%D1%82%D0%BE%D0%BC%D0%B8%D0%BD-8545950.jpg" alt="Laravel-Vue-api数据加密解密" title="Laravel-Vue-api数据加密解密"></p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> Laravel </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SOCKS5一键脚本</title>
      <link href="/2021/06/09/SOCKS5%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC/"/>
      <url>/2021/06/09/SOCKS5%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<p>抄袭来的哈哈哈</p><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Dante Socks5 Server AutoInstall</span></span><br><span class="line"><span class="comment">#   -- Owner:       https://www.inet.no/dante</span></span><br><span class="line"><span class="comment">#   -- Provider:    https://sockd.info</span></span><br><span class="line"><span class="comment">#   -- Author:      Lozy</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if user is root</span></span><br><span class="line"><span class="keyword">if</span> [ $(<span class="built_in">id</span> -u) != <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Error: You must be root to run this script, please use root to install&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">REQUEST_SERVER=<span class="string">&quot;https://raw.github.com/Lozy/danted/master&quot;</span></span><br><span class="line">SCRIPT_SERVER=<span class="string">&quot;https://public.sockd.info&quot;</span></span><br><span class="line">SYSTEM_RECOGNIZE=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">[ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == <span class="string">&quot;--no-github&quot;</span> ] &amp;&amp; REQUEST_SERVER=<span class="variable">$&#123;SCRIPT_SERVER&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -s <span class="string">&quot;/etc/os-release&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    os_name=$(sed -n <span class="string">&#x27;s/PRETTY_NAME=&quot;\(.*\)&quot;/\1/p&#x27;</span> /etc/os-release)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="subst">$(echo $&#123;os_name&#125; | grep -Ei &#x27;Debian|Ubuntu&#x27; )</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;Current OS: %s\n&quot;</span> <span class="string">&quot;<span class="variable">$&#123;os_name&#125;</span>&quot;</span></span><br><span class="line">        SYSTEM_RECOGNIZE=<span class="string">&quot;debian&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> [ -n <span class="string">&quot;<span class="subst">$(echo $&#123;os_name&#125; | grep -Ei &#x27;CentOS&#x27;)</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;Current OS: %s\n&quot;</span> <span class="string">&quot;<span class="variable">$&#123;os_name&#125;</span>&quot;</span></span><br><span class="line">        SYSTEM_RECOGNIZE=<span class="string">&quot;centos&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;Current OS: %s is not support.\n&quot;</span> <span class="string">&quot;<span class="variable">$&#123;os_name&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ -s <span class="string">&quot;/etc/issue&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="subst">$(grep -Ei &#x27;CentOS&#x27; /etc/issue)</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;Current OS: %s\n&quot;</span> <span class="string">&quot;<span class="subst">$(grep -Ei &#x27;CentOS&#x27; /etc/issue)</span>&quot;</span></span><br><span class="line">        SYSTEM_RECOGNIZE=<span class="string">&quot;centos&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;+++++++++++++++++++++++\n&quot;</span></span><br><span class="line">        <span class="built_in">cat</span> /etc/issue</span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;+++++++++++++++++++++++\n&quot;</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;[Error] Current OS: is not available to support.\n&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;[Error] (/etc/os-release) OR (/etc/issue) not exist!\n&quot;</span></span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;[Error] Current OS: is not available to support.\n&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$SYSTEM_RECOGNIZE</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    wget -qO- --no-check-certificate <span class="variable">$&#123;REQUEST_SERVER&#125;</span>/install_<span class="variable">$&#123;SYSTEM_RECOGNIZE&#125;</span>.sh | \</span><br><span class="line">        bash -s -- $*</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;[Error] Installing terminated&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash install.sh --port=端口 --user=用户名 --passwd=密码</span><br></pre></td></tr></table></figure><h3 id="安装后使用说明"><a href="#安装后使用说明" class="headerlink" title="安装后使用说明"></a>安装后使用说明</h3><table><thead><tr><th align="left">command</th><th align="left">option</th><th>description</th></tr></thead><tbody><tr><td align="left">service sockd start</td><td align="left">/etc/init.d/sockd start</td><td>start socks5 server daemon</td></tr><tr><td align="left">service sockd stop</td><td align="left">/etc/init.d/sockd stop</td><td>stop socks5 server daemon</td></tr><tr><td align="left">service sockd restart</td><td align="left">/etc/init.d/sockd restart</td><td>restart socks5 server daemon</td></tr><tr><td align="left">service sockd reload</td><td align="left">/etc/init.d/sockd reload</td><td>reload socks5 server daemon</td></tr><tr><td align="left">service sockd restart</td><td align="left">/etc/init.d/sockd restart</td><td>restart socks5 server daemon</td></tr><tr><td align="left">service sockd status</td><td align="left"></td><td>systemd process status</td></tr><tr><td align="left">service sockd state</td><td align="left">/etc/init.d/sockd state</td><td>running state</td></tr><tr><td align="left">service sockd tail</td><td align="left">/etc/init.d/sockd tail</td><td>sock log tail</td></tr><tr><td align="left">service sockd adduser</td><td align="left">/etc/init.d/sockd adduser</td><td>add pam-auth user: service sockd adduser NAME PASSWORD</td></tr><tr><td align="left">service sockd deluser</td><td align="left">/etc/init.d/sockd deluser</td><td>delete pam-auth user: service sockd deluser NAME</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> Centos </tag>
            
            <tag> SOCKS5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MACPHP7.4安装SSH2</title>
      <link href="/2021/04/28/MACPHP7-4%E5%AE%89%E8%A3%85SSH2/"/>
      <url>/2021/04/28/MACPHP7-4%E5%AE%89%E8%A3%85SSH2/</url>
      
        <content type="html"><![CDATA[<p>记录一下在mac上面安装php7.4的ssh2扩展</p><span id="more"></span><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget http://pecl.php.net/get/ssh2-1.2.tgz</span><br><span class="line">tar -zxvf ssh2-1.2.tgz</span><br><span class="line">cd ssh2-1.2</span><br><span class="line">phpize //注意使用自己对应版本的phpize</span><br><span class="line">./configure --with-php-config=/usr/local/bin/php-config //注意使用自己对应版本的php-config</span><br><span class="line">sudo make &amp;&amp; make install</span><br><span class="line">//完成过后修改php.ini 添加</span><br><span class="line">extension=ssh2.so</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> SSH2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos扩容Swap分区</title>
      <link href="/2021/01/07/centos%E6%89%A9%E5%AE%B9Swap%E5%88%86%E5%8C%BA/"/>
      <url>/2021/01/07/centos%E6%89%A9%E5%AE%B9Swap%E5%88%86%E5%8C%BA/</url>
      
        <content type="html"><![CDATA[<p>Linux中Swap（即：交换分区），类似于Windows的虚拟内存，就是当内存不足的时候，把一部分硬盘空间虚拟成内存使用,从而解决内存容量不足的情况。</p><span id="more"></span><br>### 1.查看当前的swap容量<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1.0G        216M        556M         13M        235M        628M</span><br><span class="line">Swap:          259M          0B        259M</span><br></pre></td></tr></table></figure><br>### 2.创建一个空文件 大小自己定，一般swap大小是内存的两倍，我的内存1G，swap给2G也是可以的<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# dd if=/dev/zero of=/swapfile bs=1024 count=2048000</span><br><span class="line"></span><br><span class="line">2048000+0 records in</span><br><span class="line">2048000+0 records out</span><br><span class="line">2097152000 bytes (2.1 GB) copied, 13.6397 s, 154 MB/s</span><br></pre></td></tr></table></figure><h4 id="dd命令"><a href="#dd命令" class="headerlink" title="dd命令"></a>dd命令</h4><p>dd：用指定大小的块拷贝一个文件，并在拷贝的同时进行指定的转换。</p><p>注意：指定数字的地方若以下列字符结尾，则乘以相应的数字：b&#x3D;512；c&#x3D;1；k&#x3D;1024；w&#x3D;2</p><p>参数注释：<br>1. if&#x3D;文件名：输入文件名，缺省为标准输入。即指定源文件。&lt; if&#x3D;input file &gt;<br>2. of&#x3D;文件名：输出文件名，缺省为标准输出。即指定目的文件。&lt; of&#x3D;output file &gt;<br>3. count&#x3D;blocks：仅拷贝blocks个块，块大小等于ibs指定的字节数。<br>4. bs&#x3D;bytes：同时设置读入&#x2F;输出的块大小为bytes个字节。<br><br></p><h3 id="3-将创建的文件夹转换为Swap分区"><a href="#3-将创建的文件夹转换为Swap分区" class="headerlink" title="3.将创建的文件夹转换为Swap分区"></a>3.将创建的文件夹转换为Swap分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# mkswap /swapfile</span><br><span class="line">Setting up swapspace version 1, size = 2047996 KiB</span><br><span class="line">no label, UUID=bd10f3bb-e0c9-4d03-b84b-9c8c47a2a02a</span><br></pre></td></tr></table></figure><br><h3 id="4-将刚才转换的Swap分区加入Swap"><a href="#4-将刚才转换的Swap分区加入Swap" class="headerlink" title="4.将刚才转换的Swap分区加入Swap"></a>4.将刚才转换的Swap分区加入Swap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# swapon /swapfile</span><br><span class="line">swapon: /swapfile: insecure permissions 0644, 0600 suggested.</span><br></pre></td></tr></table></figure><br><h3 id="5-查看一下"><a href="#5-查看一下" class="headerlink" title="5. 查看一下"></a>5. 查看一下</h3><figure class="highlight plaintext"><figcaption><span>~]# swapon -s</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Filename                                Type            Size    Used    Priority</span><br><span class="line">/swap                                   file    266236  0       -1</span><br><span class="line">/swapfile                               file    2047996 0       -2</span><br><span class="line">[root@www ~]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1.0G        219M         68M         13M        719M        615M</span><br><span class="line">Swap:          2.2G          0B        2.2G</span><br></pre></td></tr></table></figure><blockquote><p>见识略薄，也希望你们在使用的过程中能有所帮助！<br>原创不易，转载请附上原文出处链接,谢谢<br>原文链接：<a href="https://lihengc.github.io/2021/01/07/centos%E6%89%A9%E5%AE%B9Swap%E5%88%86%E5%8C%BA/">lihengc.github.io</a> </p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpstorm断点调试php代码+XDEBUG断点</title>
      <link href="/2020/12/02/%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95php%E4%BB%A3%E7%A0%81/"/>
      <url>/2020/12/02/%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95php%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>今天记录一下使用在phpstorm中使用xdebug进行代码的调试，作用嘛就不用多说了，不管你是用于开发或者代码审计无疑都是利器。</p><span id="more"></span><h3 id="安装XDEBUG（如果你已安装则直接跳过该步骤）"><a href="#安装XDEBUG（如果你已安装则直接跳过该步骤）" class="headerlink" title="安装XDEBUG（如果你已安装则直接跳过该步骤）"></a>安装XDEBUG（如果你已安装则直接跳过该步骤）</h3><p>1.pecl安装</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pecl install xdebug</span><br></pre></td></tr></table></figure><p>2.下载 Xdebug <a href="http://xdebug.org/download.php%EF%BC%88%E6%B3%A8%E6%84%8F%E4%B8%8B%E8%BD%BD%E5%AF%B9%E5%BA%94%E7%9A%84%E7%89%88%E6%9C%AC%EF%BC%89">http://xdebug.org/download.php（注意下载对应的版本）</a><br>3.编译安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget http://pecl.php.net/get/xdebug-2.5.5.tgz \</span><br><span class="line"></span><br><span class="line">  &amp;&amp; tar xzf xdebug-2.5.5.tgz &amp;&amp; cd xdebug-2.5.5/ \</span><br><span class="line"></span><br><span class="line">  &amp;&amp; phpize \</span><br><span class="line"></span><br><span class="line">  &amp;&amp; ./configure \</span><br><span class="line"></span><br><span class="line">  &amp;&amp; make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>注意：php5.6只能使用2.5及以下版本xdebug。</p><h3 id="php-ini配置解释"><a href="#php-ini配置解释" class="headerlink" title="php.ini配置解释"></a>php.ini配置解释</h3><p>我这里只介绍我用到的配置，本地调试。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">zend_extension = &quot;/Applications/bin/php/ext/xdebug.so&quot;</span><br><span class="line">xdebug.remote_enable=1</span><br><span class="line">xdebug.var_display_max_depth = 512</span><br><span class="line">xdebug.profiler_append = 1</span><br><span class="line">xdebug.profiler_enable_trigger = 1</span><br><span class="line">xdebug.max_nesting_level = 200</span><br><span class="line">xdebug.profiler_output_dir = &quot;/Applications/logs/xdebug&quot;</span><br><span class="line">xdebug.profiler_output_name = &quot;cachegrind.out.%t.%p&quot;</span><br><span class="line">xdebug.remote_autostart = 1 //开启自动调试</span><br><span class="line">xdebug.remote_host = 127.0.0.1</span><br><span class="line">xdebug.remote_port = 9000</span><br></pre></td></tr></table></figure><p>关键参数也就那么几个，<code>remote_enable</code>,<code>zend_extension</code>,<code>remote_autostart</code>,<code>remote_host</code>,<code>remote_port</code>,其他参数无所谓，你想开写的话那么自行去了解作用。<br><br ><br>记得配置完成过后重启<code>php-fpm</code></p><h3 id="配置phpstorm"><a href="#配置phpstorm" class="headerlink" title="配置phpstorm"></a>配置phpstorm</h3><p><img src="/screely-1606881744877.png" alt="screely-1606881744877.png"></p><p>这里<code>DEBUG PORT</code>和上面<code>php.ini</code>配置的port一样即可</p><p><img src="/screely-1606881737410.png" alt="screely-1606881737410.png"></p><p>这里<code>IDE KEY</code>和上面<code>php.ini</code>配置的<code>xdebug.idekey</code>一样即可</p><p>然后打开监听<br><img src="/screely-1606881706317.png" alt="screely-1606881706317.png"></p><blockquote><p>见识略薄，也希望你们在使用的过程中能有所帮助！<br>原创不易，转载请附上原文出处链接,谢谢<br>原文链接：<a href="https://lihengc.github.io/2020/12/02/%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95php%E4%BB%A3%E7%A0%81/">lihengc.github.io</a> </p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> PHPSTORM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ERR_INCOMPLETE_CHUNKED_ENCODING</title>
      <link href="/2020/11/18/ERR-INCOMPLETE-CHUNKED-ENCODING/"/>
      <url>/2020/11/18/ERR-INCOMPLETE-CHUNKED-ENCODING/</url>
      
        <content type="html"><![CDATA[<p>前几天安装的环境运行<code>laravel-admin</code>提交表单的时候莫名奇妙出现页面500，于是排查代码问题，找了几遍都没有问题，于是我想到去看看nginx的错误日志，果然看到了一个错误，输入代理文件大小超过配置<code>proxy_temp_file_write_size</code>的时候，nginx会将文件写到临时目录下面，如果没有权限，就会出现这个错误</p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open() &quot;/var/lib/nginx/tmp/fastcgi/3/00/0000000003&quot; failed (13: Permission denied) while reading upstream</span><br></pre></td></tr></table></figure><p>解决方法特别简单，查询到nginx到运行用户,再这是目录到所有者</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[root]# </span><span class="language-bash">ps -ef | grep nginx</span></span><br><span class="line">phpuser   1790 21211  0 Nov17 ?        00:00:00 nginx: worker process</span><br><span class="line">phpuser   1791 21211  0 Nov17 ?        00:00:00 nginx: worker process</span><br><span class="line">root     21211     1  0 Nov17 ?        00:00:00 nginx: master process nginx</span><br><span class="line"><span class="meta prompt_">[root]# </span><span class="language-bash"><span class="built_in">chown</span> -R phpuser:phpuser /var/lib/nginx</span></span><br></pre></td></tr></table></figure><blockquote><p>见识略薄，也希望你们在使用的过程中能有所帮助！<br>原创不易，转载请附上原文出处链接,谢谢<br>原文链接：<a href="https://lihengc.github.io/2020/11/18/ERR-INCOMPLETE-CHUNKED-ENCODING/">lihengc.github.io</a> </p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx File not Found</title>
      <link href="/2020/11/16/Nginx-File-not-Found/"/>
      <url>/2020/11/16/Nginx-File-not-Found/</url>
      
        <content type="html"><![CDATA[<p>搭建php-fpm+nginx环境的时候遇到一个问题，File not Found，这个错误并不是nginx返回的，是php-fpm返回给我们的。<br>错误日志就像这样</p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020/11/16 06:56:19 [error] 779#0: *1 FastCGI sent in stderr: &quot;Primary script unknown&quot; while reading response header from upstream, client: 125.67.11.11, server: account80.com, request: &quot;GET / HTTP/1.1&quot;, upstream: &quot;fastcgi://127.0.0.1:9000&quot;, host: &quot;18.2.246.3&quot;</span><br><span class="line">2020/11/16 06:56:20 [error] 779#0: *1 FastCGI sent in stderr: &quot;Primary script unknown&quot; while reading response header from upstream, client: 125.67.11.11, server: account80.com, request: &quot;GET / HTTP/1.1&quot;, upstream: &quot;fastcgi://127.0.0.1:9000&quot;, host: &quot;18.2.246.3&quot;</span><br></pre></td></tr></table></figure><p>网上的回答什么都有，众说纷纭，以下是我的总结</p><h2 id="1-nginx配置文件问题，找不到脚本文件"><a href="#1-nginx配置文件问题，找不到脚本文件" class="headerlink" title="1. nginx配置文件问题，找不到脚本文件"></a>1. nginx配置文件问题，找不到脚本文件</h2><p>以下配置正确，你不需要管其他的</p><p><code>SCRIPT_FILENAME  $document_root$fastcgi_script_name</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.php$ &#123;</span><br><span class="line">        fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        fastcgi_index  index.php;</span><br><span class="line"></span><br><span class="line">        #SCRIPT_FILENAME用$document_root，而不是具体路径</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">        include        fastcgi_params;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="2-权限问题（这个相对来说比较复杂一点）"><a href="#2-权限问题（这个相对来说比较复杂一点）" class="headerlink" title="2. 权限问题（这个相对来说比较复杂一点）"></a>2. 权限问题（这个相对来说比较复杂一点）</h2><p>确保nginx用户和php用户是统一用户，当然你不考虑安全问题的话root也行<br>找配置的话可以这样，以下shell只是推荐使用。。。。</p><p><code>vim $(find / -name php-fpm.d/www.conf)</code></p><p><code>vim $(find / -name nginx.conf)</code><br>修改用户和用户组，然后重启nginx和php-fpm，如果出现报错建议关机砸掉！</p><p>这一步是nginx日志的操作者<br><code>vim $(find / -name logrotate.d)/nginx</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create 640 root adm</span><br></pre></td></tr></table></figure><p>如果你修改的非不是root用户的话记得给予权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chown -R nginxuser:nginxuser (日志目录)</span><br><span class="line">chown -R nginxuser:nginxuser (缓存目录)</span><br><span class="line">chown -R nginxuser:nginxuser (程序目录)</span><br></pre></td></tr></table></figure><h2 id="3-SELINUX-关键来了记好笔记"><a href="#3-SELINUX-关键来了记好笔记" class="headerlink" title="3. SELINUX (关键来了记好笔记)"></a>3. SELINUX (关键来了记好笔记)</h2><p>当你确定你目录和权限没有问题的情况下，然后还一直反复出现file not found，<br>那么可以确定就是selinux的问题无疑了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chcon -R -t httpd_sys_content_t /var/www/show</span><br></pre></td></tr></table></figure><p>或者临时关闭selinux</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo setenforce 0</span><br></pre></td></tr></table></figure><p>又或者永久关闭，需要重启</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config set SELINUX to disabled</span><br></pre></td></tr></table></figure><blockquote><p>见识略薄，也希望你们在使用的过程中能有所帮助！<br>原创不易，转载请附上原文出处链接,谢谢<br>原文链接：<a href="https://lihengc.github.io/2020/11/16/Nginx-File-not-Found/">lihengc.github.io</a> </p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP-IOC容器</title>
      <link href="/2020/10/31/PHP-IOC%E5%AE%B9%E5%99%A8/"/>
      <url>/2020/10/31/PHP-IOC%E5%AE%B9%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>###容器是什么？</p><p>相信很多人听说过依赖注入，依赖注入实现的基础条件离不开容器，容器就是用来管理类依赖和注入的，负责服务的管理和解耦组件，最简单的理解我们可以把容器理解成一个超级大、专门存对象的数组。</p><span id="more"></span><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Container</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 当前容器对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$instance</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 存放在容器里面到实例</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$instances</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">self</span>::<span class="variable">$instance</span>) &#123;</span><br><span class="line">            <span class="built_in">self</span>::<span class="variable">$instance</span> = <span class="keyword">new</span> <span class="built_in">static</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$instance</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取对象实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ReflectionException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;instances[<span class="variable">$key</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;instances[<span class="variable">$key</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定对象、闭包、类到容器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> null $concrete</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Container</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ReflectionException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bind</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$concrete</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$concrete</span> <span class="keyword">instanceof</span> <span class="built_in">Closure</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;instances[<span class="variable">$key</span>] = <span class="variable">$concrete</span>;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">is_object</span>(<span class="variable">$concrete</span>)) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;instances[<span class="variable">$key</span>] = <span class="variable">$concrete</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="variable">$key</span>, <span class="variable">$concrete</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建类绑定到类实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $abstract</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> null $atgs</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ReflectionException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">make</span>(<span class="params"><span class="variable">$abstract</span>, <span class="variable">$atgs</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;instances[<span class="variable">$abstract</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;instances[<span class="variable">$abstract</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$object</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invokeClass</span>(<span class="variable">$abstract</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;instances[<span class="variable">$abstract</span>] = <span class="variable">$object</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$object</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 反射解析类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $abstract</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ReflectionException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">invokeClass</span>(<span class="params"><span class="variable">$abstract</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="variable">$reflectionClass</span> = <span class="keyword">new</span> <span class="title class_">\ReflectionClass</span>(<span class="variable">$abstract</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取构造方法</span></span><br><span class="line">        <span class="variable">$construct</span> = <span class="variable">$reflectionClass</span>-&gt;<span class="title function_ invoke__">getConstructor</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取参数得到实例</span></span><br><span class="line">        <span class="variable">$params</span> = <span class="variable">$construct</span> ? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">parserParams</span>(<span class="variable">$construct</span>) : [];</span><br><span class="line">        <span class="variable">$object</span> = <span class="variable">$reflectionClass</span>-&gt;<span class="title function_ invoke__">newInstanceArgs</span>(<span class="variable">$params</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$object</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析构造方法参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $reflect</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ReflectionException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parserParams</span>(<span class="params">ReflectionMethod <span class="variable">$reflect</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="variable">$args</span> = [];</span><br><span class="line">        <span class="variable">$params</span> = <span class="variable">$reflect</span>-&gt;<span class="title function_ invoke__">getParameters</span>();</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$params</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$args</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">count</span>(<span class="variable">$params</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$params</span> <span class="keyword">as</span> <span class="variable">$param</span>) &#123;</span><br><span class="line">                <span class="variable">$class</span> = <span class="variable">$param</span>-&gt;<span class="title function_ invoke__">getClass</span>();</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$class</span>) &#123;</span><br><span class="line">                    <span class="variable">$args</span>[] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="variable">$class</span>-&gt;<span class="title function_ invoke__">getName</span>());</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 获取变量的名称</span></span><br><span class="line">                <span class="variable">$name</span> = <span class="variable">$param</span>-&gt;<span class="title function_ invoke__">getName</span>();</span><br><span class="line">                <span class="comment">// 默认值</span></span><br><span class="line">                <span class="variable">$def</span> = <span class="literal">null</span>;</span><br><span class="line">                <span class="comment">// 如果有默认值，从默认值获取类型</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$param</span>-&gt;<span class="title function_ invoke__">isOptional</span>()) &#123;</span><br><span class="line">                    <span class="variable">$def</span> = <span class="variable">$param</span>-&gt;<span class="title function_ invoke__">getDefaultValue</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$args</span>[] = <span class="variable">$_REQUEST</span>[<span class="variable">$name</span>] ?? <span class="variable">$def</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$args</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于mysql的http插件</title>
      <link href="/2020/03/31/%E5%9F%BA%E4%BA%8Emysql%E7%9A%84http%E6%8F%92%E4%BB%B6/"/>
      <url>/2020/03/31/%E5%9F%BA%E4%BA%8Emysql%E7%9A%84http%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>####环境</p><ol><li>系统：centos</li><li>宝塔：7.1.1</li><li>mysq：l5.5.62</li></ol><h4 id="适用业务"><a href="#适用业务" class="headerlink" title="适用业务"></a>适用业务</h4><p>某某公司遇到的业务是用户余额变化需要时时变化并且通知到用户，那么所存在到问题是系统里面用户资金操作特别多，不可能在每一个操作上面都去添加业务通知，那么所带来的代码量也比较大，<br>并且也可能改漏遗忘，以及代码耦合特别高。在这个时候找到来mysql-udf-http这个插件，前辈写咱们只管用。（业务类似都可适用）</p><span id="more"></span><h4 id="安装以及使用"><a href="#安装以及使用" class="headerlink" title="安装以及使用"></a>安装以及使用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/mysql-udf-http/mysql-udf-http-1.0.tar.gz</span><br><span class="line">echo &quot;/www/server/mysql/lib&quot; &gt; /etc/ld.so.conf.d/mysql.conf</span><br><span class="line">/sbin/ldconfig</span><br><span class="line">tar zxvf mysql-udf-http-1.0.tar.gz</span><br><span class="line">cd ./mysql-udf-http-1.0/</span><br><span class="line">./configure --prefix=/www/server/mysql --with-mysql=/www/server/mysql/bin/mysql_config</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">ln -s /www/server/mysql/lib/mysql-udf-http.so.0.0.0 /www/server/mysql/lib/plugin/mysql-udf-http.so</span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure><p>这里需要注意的是把<code>/www/server/mysql</code>数据库的目录替换成自己的目录就好</p><p>最后进入数据库创建函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create function http_get returns string soname &#x27;mysql-udf-http.so&#x27;;  </span><br><span class="line">create function http_post returns string soname &#x27;mysql-udf-http.so&#x27;;  </span><br><span class="line">create function http_put returns string soname &#x27;mysql-udf-http.so&#x27;;  </span><br><span class="line">create function http_delete returns string soname &#x27;mysql-udf-http.so&#x27;;  </span><br></pre></td></tr></table></figure><p>使用该函数通知自己的业务,创建触发器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DROP TRIGGER IF EXISTS `BalanceChange`;</span><br><span class="line">DELIMITER  ;;</span><br><span class="line">CREATE DEFINER=`root`@`127.0.0.1` TRIGGER `BalanceChange` AFTER UPDATE ON `account` FOR EACH ROW </span><br><span class="line">begin</span><br><span class="line">  SET @tt_resu = (SELECT http_post(&#x27;http://173.0.2.1/putMessage&#x27;,CONCAT(&#x27;uid=&#x27;,NEW.uid,&#x27;&amp;balance=&#x27;,NEW.balance,&#x27;&amp;site=&#x27;,NEW.site_id)));  </span><br><span class="line">end;;</span><br></pre></td></tr></table></figure><p>需要注意的仅仅只是参数的格式</p><blockquote><p>见识略薄，也希望你们在使用的过程中能有所帮助！<br>原创不易，转载请附上原文出处链接,谢谢<br>原文链接：<a href="https://lihengc.coding.me/2020/03/31/%E5%9F%BA%E4%BA%8Emysql%E7%9A%84http%E6%8F%92%E4%BB%B6/">lihengc.coding.me</a> </p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> http </tag>
            
            <tag> tcp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>thinkphp调用sqlserver储存过程返回多个结果集</title>
      <link href="/2020/01/06/thinkphp%E8%B0%83%E7%94%A8sqlserver%E5%82%A8%E5%AD%98%E8%BF%87%E7%A8%8B%E8%BF%94%E5%9B%9E%E5%A4%9A%E4%B8%AA%E7%BB%93%E6%9E%9C%E9%9B%86/"/>
      <url>/2020/01/06/thinkphp%E8%B0%83%E7%94%A8sqlserver%E5%82%A8%E5%AD%98%E8%BF%87%E7%A8%8B%E8%BF%94%E5%9B%9E%E5%A4%9A%E4%B8%AA%E7%BB%93%E6%9E%9C%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h3 id="首先安装扩展"><a href="#首先安装扩展" class="headerlink" title="首先安装扩展"></a>首先安装扩展</h3><span id="more"></span><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><p>分为两个步骤</p><ol><li>找到对应自己PHP版本的pdo扩展，下载解压出来，并且在<code>php.ini</code>里面启用扩展,需要注意的问题是php版本以及是否为安全版本</li><li>下载 <code>ODBC Driver</code>  <a href="https://docs.microsoft.com/zh-cn/sql/connect/odbc/download-odbc-driver-for-sql-server?view=sql-server-2017,%E8%BF%99%E4%B8%AA%E6%B2%A1%E5%95%A5%E6%B3%A8%E6%84%8F%E7%9A%84%EF%BC%8C%E4%BD%A0%E6%98%AF%E5%95%A5%E7%B3%BB%E7%BB%9F%E5%B0%B1%E4%B8%8B%E8%BD%BD%E5%95%A5%E5%AE%89%E8%A3%85%E5%8C%85%E5%B0%B1%E8%A1%8C">https://docs.microsoft.com/zh-cn/sql/connect/odbc/download-odbc-driver-for-sql-server?view=sql-server-2017,这个没啥注意的，你是啥系统就下载啥安装包就行</a></li></ol><p>linux 和 windows差不多，安装扩展的话直接可以用pecl</p><p>当你成功加载了可以在<code>phpinfo()</code>里面看到，当然了，如果你安装扩展这些都有诸多问题都话，～你可真拉稀。</p><hr /><h3 id="thinkphp操作sqlsrv储存过程"><a href="#thinkphp操作sqlsrv储存过程" class="headerlink" title="thinkphp操作sqlsrv储存过程"></a>thinkphp操作sqlsrv储存过程</h3><blockquote><p>我使用的tp版本是5.0和操作多个数据库，希望能对你有所帮助</p></blockquote><h4 id="配置config文件"><a href="#配置config文件" class="headerlink" title="配置config文件"></a>配置config文件</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 账号数据库</span></span><br><span class="line">   <span class="string">&#x27;UserDBConn&#x27;</span> =&gt;  [</span><br><span class="line">       <span class="string">&#x27;type&#x27;</span>            =&gt; <span class="string">&#x27;sqlsrv&#x27;</span>,</span><br><span class="line">       <span class="comment">// 服务器地址</span></span><br><span class="line">       <span class="string">&#x27;hostname&#x27;</span>        =&gt; <span class="string">&#x27;139.129.1.1&#x27;</span>,</span><br><span class="line">       <span class="comment">// 数据库名</span></span><br><span class="line">       <span class="string">&#x27;database&#x27;</span>        =&gt; <span class="string">&#x27;DB3&#x27;</span>,</span><br><span class="line">       <span class="comment">// 用户名</span></span><br><span class="line">       <span class="string">&#x27;username&#x27;</span>        =&gt; <span class="string">&#x27;xxxx&#x27;</span>,</span><br><span class="line">       <span class="comment">// 密码</span></span><br><span class="line">       <span class="string">&#x27;password&#x27;</span>        =&gt; <span class="string">&#x27;tt123!@#&#x27;</span>,</span><br><span class="line">       <span class="comment">// 端口</span></span><br><span class="line">       <span class="string">&#x27;hostport&#x27;</span>        =&gt; <span class="string">&#x27;5188&#x27;</span></span><br><span class="line">   ],</span><br><span class="line">   <span class="comment">// 金币数据库</span></span><br><span class="line">   <span class="string">&#x27;ScoreDBConn&#x27;</span> =&gt;  [</span><br><span class="line">       <span class="string">&#x27;type&#x27;</span>            =&gt; <span class="string">&#x27;sqlsrv&#x27;</span>,</span><br><span class="line">       <span class="comment">// 服务器地址</span></span><br><span class="line">       <span class="string">&#x27;hostname&#x27;</span>        =&gt; <span class="string">&#x27;139.129.1.1&#x27;</span>,</span><br><span class="line">       <span class="comment">// 数据库名</span></span><br><span class="line">       <span class="string">&#x27;database&#x27;</span>        =&gt; <span class="string">&#x27;DB2&#x27;</span>,</span><br><span class="line">       <span class="comment">// 用户名</span></span><br><span class="line">       <span class="string">&#x27;username&#x27;</span>        =&gt; <span class="string">&#x27;xxxx&#x27;</span>,</span><br><span class="line">       <span class="comment">// 密码</span></span><br><span class="line">       <span class="string">&#x27;password&#x27;</span>        =&gt; <span class="string">&#x27;tt123!@#&#x27;</span>,</span><br><span class="line">       <span class="comment">// 端口</span></span><br><span class="line">       <span class="string">&#x27;hostport&#x27;</span>        =&gt; <span class="string">&#x27;5188&#x27;</span></span><br><span class="line">   ],</span><br><span class="line">   <span class="comment">// 记录数据库</span></span><br><span class="line">   <span class="string">&#x27;RecordDBConn&#x27;</span> =&gt;  [</span><br><span class="line">       <span class="string">&#x27;type&#x27;</span>            =&gt; <span class="string">&#x27;sqlsrv&#x27;</span>,</span><br><span class="line">       <span class="comment">// 服务器地址</span></span><br><span class="line">       <span class="string">&#x27;hostname&#x27;</span>        =&gt; <span class="string">&#x27;139.129.1.1&#x27;</span>,</span><br><span class="line">       <span class="comment">// 数据库名</span></span><br><span class="line">       <span class="string">&#x27;database&#x27;</span>        =&gt; <span class="string">&#x27;DB1&#x27;</span>,</span><br><span class="line">       <span class="comment">// 用户名</span></span><br><span class="line">       <span class="string">&#x27;username&#x27;</span>        =&gt; <span class="string">&#x27;xxxx&#x27;</span>,</span><br><span class="line">       <span class="comment">// 密码</span></span><br><span class="line">       <span class="string">&#x27;password&#x27;</span>        =&gt; <span class="string">&#x27;tt123!@#&#x27;</span>,</span><br><span class="line">       <span class="comment">// 端口</span></span><br><span class="line">       <span class="string">&#x27;hostport&#x27;</span>        =&gt; <span class="string">&#x27;5188&#x27;</span></span><br><span class="line">   ],</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="修改thinkphp-library-think-Model-php"><a href="#修改thinkphp-library-think-Model-php" class="headerlink" title="修改thinkphp&#x2F;library&#x2F;think&#x2F;Model.php"></a>修改thinkphp&#x2F;library&#x2F;think&#x2F;Model.php</h4><p>在末尾追加</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> $DbconnName</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">Dbconn</span>(<span class="params"><span class="variable">$DbconnName</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span>&#123;</span><br><span class="line">           <span class="variable">$conn</span> = <span class="title class_">Db</span>::<span class="title function_ invoke__">connect</span>(<span class="variable">$DbconnName</span>);</span><br><span class="line">       &#125;<span class="keyword">catch</span> (\<span class="built_in">InvalidArgumentException</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&#x27;连接异常&#x27;</span>;</span><br><span class="line">           <span class="keyword">die</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable">$conn</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="添加模型"><a href="#添加模型" class="headerlink" title="添加模型"></a>添加模型</h4><h5 id="Agent-php"><a href="#Agent-php" class="headerlink" title="Agent.php"></a>Agent.php</h5><p>查询和增删改都可以调用query，如果你没有想要获取的结果集的话可以调用<code>execute()</code>。</p><p><code>query()</code>有一个弊端，如果你的绑定参数的形式（非参数绑定）是直接写进sql的话，他有可能会判断你这个不是一个储存过程；<br>具体实现请查看thinkphp&#x2F;library&#x2F;think&#x2F;db&#x2F;Connection.php:368行，当然也不会有结果集返回。</p><p>你也可以用调用<code>procedure()</code>,这个方法调用的话就一定会返回结果集。</p><p>起初我就是这个问题，并没有采用绑定参数的形式提交，直接写sql，就获取不到结果集，后来我在我的sql提行里面加入了<code>SET NOCOUNT ON;</code>，才能勉强拿到返回，在文章最后我给出了我最开始获取的结果集的方案例子，但是真的拉稀，你们可以看看，不要吐槽。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Dbname</span> = <span class="string">&#x27;UserDBConn&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">GetIndirectAgentList</span>(<span class="params"><span class="variable">$agentId</span>,<span class="variable">$strAccount</span>,<span class="variable">$strSuperior</span>,<span class="variable">$iPageIndex</span>,<span class="variable">$pagesize</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$conn</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Dbconn</span>(<span class="variable">$this</span>-&gt;Dbname);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="variable">$TotalCount</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="variable">$res</span> = <span class="variable">$conn</span>::<span class="title function_ invoke__">query</span>(<span class="string">&#x27;exec [dbo].[Agent_GetAgentList] :agentId,:strAccount,:strSuperior,:iPageIndex,:pagesize,:TotalCount&#x27;</span>, [</span><br><span class="line">                <span class="string">&#x27;agentId&#x27;</span> =&gt; <span class="variable">$agentId</span>,</span><br><span class="line">                <span class="string">&#x27;strAccount&#x27;</span> =&gt; [<span class="variable">$strAccount</span>, PDO::<span class="variable constant_">PARAM_STR</span>],</span><br><span class="line">                <span class="string">&#x27;strSuperior&#x27;</span> =&gt; [<span class="variable">$strSuperior</span>, PDO::<span class="variable constant_">PARAM_STR</span>],</span><br><span class="line">                <span class="string">&#x27;iPageIndex&#x27;</span> =&gt; [<span class="variable">$iPageIndex</span>, PDO::<span class="variable constant_">PARAM_INT</span>],</span><br><span class="line">                <span class="string">&#x27;pagesize&#x27;</span> =&gt; [<span class="variable">$pagesize</span>, PDO::<span class="variable constant_">PARAM_INT</span>],</span><br><span class="line">                <span class="string">&#x27;TotalCount&#x27;</span> =&gt; [<span class="variable">$TotalCount</span>, PDO::<span class="variable constant_">PARAM_INPUT_OUTPUT</span>],</span><br><span class="line">            ]);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (PDOException <span class="variable">$e</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="最初的Agent-php"><a href="#最初的Agent-php" class="headerlink" title="最初的Agent.php"></a>最初的Agent.php</h5><p>很显然 这里并不会获取到@AgentID 以及  @TotalCount；他只会返回Agent_GetAgentList的结果集</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">GetIndirectAgentList</span>(<span class="params"><span class="variable">$agentId</span>,<span class="variable">$strAccount</span>,<span class="variable">$strSuperior</span>,<span class="variable">$iPageIndex</span>,<span class="variable">$pagesize</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$conn</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Dbconn</span>(<span class="variable">$this</span>-&gt;Dbname);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$res</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;</span></span><br><span class="line"><span class="string">                SET NOCOUNT ON;</span></span><br><span class="line"><span class="string">                declare @AgentID int;</span></span><br><span class="line"><span class="string">                declare @TotalCount int;</span></span><br><span class="line"><span class="string">                exec [dbo].[Agent_GetAgentList] &#x27;</span>.<span class="variable">$agentId</span>.<span class="string">&#x27;,\&#x27;&#x27;</span>.<span class="variable">$strAccount</span>.<span class="string">&#x27;\&#x27;,\&#x27;&#x27;</span>.<span class="variable">$strSuperior</span>.<span class="string">&#x27;\&#x27;,&#x27;</span>.<span class="variable">$iPageIndex</span>.<span class="string">&#x27;,&#x27;</span>.<span class="variable">$pagesize</span>.<span class="string">&#x27;,@TotalCount output;</span></span><br><span class="line"><span class="string">                select @AgentID as AgentID,@TotalCount as TotalCount</span></span><br><span class="line"><span class="string">                &#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (PDOException <span class="variable">$e</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>见识略薄（也可能是我的理解和使用方式不对），也希望你们在使用的过程中能有所帮助！<br>原创不易，转载请附上原文出处链接,谢谢<br>原文链接：<a href="https://lihengc.coding.me/2020/01/06/thinkphp%E8%B0%83%E7%94%A8sqlserver%E5%82%A8%E5%AD%98%E8%BF%87%E7%A8%8B%E8%BF%94%E5%9B%9E%E5%A4%9A%E4%B8%AA%E7%BB%93%E6%9E%9C%E9%9B%86/">lihengc.coding.me</a> </p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> thinkphp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php-imap</title>
      <link href="/2019/12/26/php-imap/"/>
      <url>/2019/12/26/php-imap/</url>
      
        <content type="html"><![CDATA[<p>不多bb，直接切入主题，有什么需要就用什么招！</p><span id="more"></span><p>首先安装扩展，看shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> ~/Downloads</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wget https://www.php.net/distributions/php-7.2.1.tar.gz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gunzip php-7.2.1.tar.gz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tar xvf php-7.2.1.tar</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果已有了php环境的话，前面步骤直接跳过，</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> php-7.2.1/ext/imap</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mac os phpize报错的话，试试这个shell，实在不行就google</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk/usr/include/ /usr/include</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">phpize</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果使用的是linux的话 yum install -y libc-client-* 或者apt-get</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">brew install openssl</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">brew install imap-uw</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">请确认自己的openssl安装路径，以免发生误会</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./configure --with-kerberos --with-imap-ssl=/usr/local/Cellar/openssl/1.0.2r/ --with-imap=/usr/local/Cellar/imap-uw/2007f/</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">获取扩展路径</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">php -i | grep extension_dir</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">extension_dir =&gt; /usr/lib/php/extensions/no-debug-non-zts-20160303 =&gt; /usr/lib/php/extensions/no-debug-non-zts-20160303</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sqlite3.extension_dir =&gt; no value =&gt; no value</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> modules/imap.so /usr/lib/php/extensions/no-debug-non-zts-20160303</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">最后在php.ini添加扩展</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">[imap]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">extension=<span class="string">&quot;imap.so&quot;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>linux的比较简单，mac os 系统下面略坑，brew 不带imap源码包。</p><p>linux下面不用这么复杂，编译了过后直接在php.ini配置文件里面添加扩展文件即可。</p><p>##使用imap<br>我使用了一个轮子给大家推荐一下</p><figure class="highlight plaintext"><figcaption><span>log</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ composer require php-imap/php-imap</span><br></pre></td></tr></table></figure><p>地址和安装要求自行去看看：<a href="https://github.com/barbushin/php-imap">https://github.com/barbushin/php-imap</a></p><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create PhpImap\Mailbox instance for all further actions</span></span><br><span class="line"><span class="variable">$mailbox</span> = <span class="keyword">new</span> <span class="title class_">PhpImap\Mailbox</span>(</span><br><span class="line"><span class="string">&#x27;&#123;imap.gmail.com:993/imap/ssl&#125;INBOX&#x27;</span>, <span class="comment">// IMAP server and mailbox folder</span></span><br><span class="line"><span class="string">&#x27;some@gmail.com&#x27;</span>, <span class="comment">// Username for the before configured mailbox</span></span><br><span class="line"><span class="string">&#x27;*********&#x27;</span>, <span class="comment">// Password for the before configured username</span></span><br><span class="line"><span class="keyword">__DIR__</span>, <span class="comment">// Directory, where attachments will be saved (optional)</span></span><br><span class="line"><span class="string">&#x27;UTF-8&#x27;</span> <span class="comment">// Server encoding (optional)</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// Get all emails (messages)</span></span><br><span class="line"><span class="comment">// PHP.net imap_search criteria: http://php.net/manual/en/function.imap-search.php</span></span><br><span class="line"><span class="variable">$mailsIds</span> = <span class="variable">$mailbox</span>-&gt;<span class="title function_ invoke__">searchMailbox</span>(<span class="string">&#x27;ALL&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(PhpImap\Exceptions\ConnectionException <span class="variable">$ex</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;IMAP connection failed: &quot;</span> . <span class="variable">$ex</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// If $mailsIds is empty, no emails could be found</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$mailsIds</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Mailbox is empty&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get the first message</span></span><br><span class="line"><span class="comment">// If &#x27;__DIR__&#x27; was defined in the first line, it will automatically</span></span><br><span class="line"><span class="comment">// save all attachments to the specified directory</span></span><br><span class="line"><span class="variable">$mail</span> = <span class="variable">$mailbox</span>-&gt;<span class="title function_ invoke__">getMail</span>(<span class="variable">$mailsIds</span>[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Show, if $mail has one or more attachments</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\nMail has attachments? &quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">hasAttachments</span>()) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Yes\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;No\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Print all information of $mail</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$mail</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Print all attachements of $mail</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n\nAttachments:\n&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">getAttachments</span>());</span><br></pre></td></tr></table></figure><p>邮件检索命令的话可以自行google</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$mailsIds</span> = <span class="variable">$mailbox</span>-&gt;<span class="title function_ invoke__">searchMailbox</span>(<span class="string">&#x27;UNSEEN&#x27;</span>); <span class="comment">//设置读取邮件条件</span></span><br></pre></td></tr></table></figure><p>over～</p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> imap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTMLInputElement es call input change Event</title>
      <link href="/2019/12/24/HTMLInputElement/"/>
      <url>/2019/12/24/HTMLInputElement/</url>
      
        <content type="html"><![CDATA[<p>折腾了一天，是什么事件都去试了一次，最后还是google大法好</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nativeInputValueSetter = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(<span class="variable language_">window</span>.<span class="property">HTMLInputElement</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&quot;value&quot;</span>).<span class="property">set</span>;</span><br><span class="line">nativeInputValueSetter.<span class="title function_">call</span>(input, <span class="string">&#x27;react 16 value&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ev2 = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>, &#123; <span class="attr">bubbles</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">input.<span class="title function_">dispatchEvent</span>(ev2);</span><br></pre></td></tr></table></figure><span id="more"></span><p>With react-dom ^15.6.0 you can use simulated flag on the event object for the event to pass through</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ev = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>, &#123; <span class="attr">bubbles</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">ev.<span class="property">simulated</span> = <span class="literal">true</span>;</span><br><span class="line">element.<span class="property">value</span> = <span class="string">&#x27;Something new&#x27;</span>;</span><br><span class="line">element.<span class="title function_">dispatchEvent</span>(ev);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> JS </tag>
            
            <tag> ES </tag>
            
            <tag> recat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Google Vision OCR</title>
      <link href="/2019/12/19/Google-Vision-OCR/"/>
      <url>/2019/12/19/Google-Vision-OCR/</url>
      
        <content type="html"><![CDATA[<h1 id="Google-Vision-OCR-爬坑建议"><a href="#Google-Vision-OCR-爬坑建议" class="headerlink" title="Google Vision OCR 爬坑建议"></a>Google Vision OCR 爬坑建议</h1><p>首先安装 Google Vision</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require google/cloud-vision</span><br></pre></td></tr></table></figure><span id="more"></span><p>第一次使用的时候真的遇到的问题很多，文档是英文的，自己慢慢摸索的途中不免进行去<code>百度</code>和<code>google</code>搜索<br>但是搜索出来的结果却不尽人意，可能是搜索方式不太对哈哈～，其实使用蛮简单，因为是别人现成对轮子，只不过使用对时候坑比较多，<br>所以特别列出以下几点。</p><ol><li>身份认证(就这个身份认证我搞了2个小时)</li><li><code>$vision-&gt;image($img_path)</code> 图片如果传入url的话会抛出异常</li></ol><h3 id="身份认证"><a href="#身份认证" class="headerlink" title="身份认证"></a>身份认证</h3><p>进入 <a href="https://console.cloud.google.com/">https://console.cloud.google.com/</a>  在列表里面找到api与服务选择凭据，创建凭据，选择服务帐号与密钥进行创建，我选择的格式是json<br>这个就是我们需要的凭据，导出以后放进项目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Google</span>\<span class="title">Cloud</span>\<span class="title">Vision</span>\<span class="title">VisionClient</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$vision</span> = <span class="keyword">new</span> <span class="title class_">VisionClient</span>(</span><br><span class="line">            [</span><br><span class="line">                <span class="string">&#x27;keyFile&#x27;</span> =&gt; <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$key_path</span>), <span class="literal">true</span>)</span><br><span class="line">            ]</span><br><span class="line">        );</span><br></pre></td></tr></table></figure><p>到这里身份认证就没有问题了，还有其他的方式，可自行研究，文档太高深，说实话不太喜欢阅读。</p><h3 id="图片导入以及function选择"><a href="#图片导入以及function选择" class="headerlink" title="图片导入以及function选择"></a>图片导入以及<code>function</code>选择</h3><p>在google官方提供的文档当中是这样写的demo</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Google</span>\<span class="title">Cloud</span>\<span class="title">Vision</span>\<span class="title">VisionClient</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$vision</span> = <span class="keyword">new</span> <span class="title class_">VisionClient</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Annotate an image, detecting faces.</span></span><br><span class="line"><span class="variable">$image</span> = <span class="variable">$vision</span>-&gt;<span class="title function_ invoke__">image</span>(</span><br><span class="line">    <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;/data/family_photo.jpg&#x27;</span>, <span class="string">&#x27;r&#x27;</span>),</span><br><span class="line">    [<span class="string">&#x27;faces&#x27;</span>]</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$annotation</span> = <span class="variable">$vision</span>-&gt;<span class="title function_ invoke__">annotate</span>(<span class="variable">$image</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Determine if the detected faces have headwear.</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$annotation</span>-&gt;<span class="title function_ invoke__">faces</span>() <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$face</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$face</span>-&gt;<span class="title function_ invoke__">hasHeadwear</span>()) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Face <span class="subst">$key</span> has headwear.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>[&#39;faces&#39;]</code>features方法是可以多传的，更具需求传入，在最后我列出了所有的features。<br>这里还存在一个问题，我的图片是url，我尝试使用<code>fopen</code>和<code>file_get_contents</code>打开一个url，但是被抛出了异常（异常没深究，太高端看不懂，咱也不敢问），<br>最后是这样成功的，并成功拿到了返回。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">api</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$vision</span> = <span class="keyword">new</span> <span class="title class_">VisionClient</span>(</span><br><span class="line">            [</span><br><span class="line">                <span class="string">&#x27;keyFile&#x27;</span> =&gt; <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$key_path</span>), <span class="literal">true</span>)</span><br><span class="line">            ]</span><br><span class="line">        );</span><br><span class="line">        <span class="comment"># the name of the image file to annotate</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$fileName</span> = <span class="variable">$url</span>;</span><br><span class="line">        <span class="variable">$imageData</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$fileName</span>);</span><br><span class="line">        <span class="variable">$image</span> = <span class="keyword">new</span> <span class="title class_">Image</span>(<span class="variable">$imageData</span>, [</span><br><span class="line">            <span class="string">&#x27;TEXT_DETECTION&#x27;</span></span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$vision</span>-&gt;<span class="title function_ invoke__">annotate</span>(<span class="variable">$image</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$text_array</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">info</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$text_array</span>[<span class="string">&#x27;textAnnotations&#x27;</span>])&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$text_array</span>[<span class="string">&#x27;textAnnotations&#x27;</span>][<span class="string">&#x27;0&#x27;</span>][<span class="string">&#x27;description&#x27;</span>]))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$text_array</span>[<span class="string">&#x27;textAnnotations&#x27;</span>][<span class="string">&#x27;0&#x27;</span>][<span class="string">&#x27;description&#x27;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>##features</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> [</span><br><span class="line">    <span class="string">&#x27;faces&#x27;</span>,          <span class="comment">// Corresponds to `FACE_DETECTION`</span></span><br><span class="line">    <span class="string">&#x27;landmarks&#x27;</span>,      <span class="comment">// Corresponds to `LANDMARK_DETECTION`</span></span><br><span class="line">    <span class="string">&#x27;logos&#x27;</span>,          <span class="comment">// Corresponds to `LOGO_DETECTION`</span></span><br><span class="line">    <span class="string">&#x27;labels&#x27;</span>,         <span class="comment">// Corresponds to `LABEL_DETECTION`</span></span><br><span class="line">    <span class="string">&#x27;text&#x27;</span>,           <span class="comment">// Corresponds to `TEXT_DETECTION`,</span></span><br><span class="line">    <span class="string">&#x27;document&#x27;</span>,       <span class="comment">// Corresponds to `DOCUMENT_TEXT_DETECTION`</span></span><br><span class="line">    <span class="string">&#x27;safeSearch&#x27;</span>,     <span class="comment">// Corresponds to `SAFE_SEARCH_DETECTION`</span></span><br><span class="line">    <span class="string">&#x27;imageProperties&#x27;</span>,<span class="comment">// Corresponds to `IMAGE_PROPERTIES`</span></span><br><span class="line">    <span class="string">&#x27;crop&#x27;</span>,           <span class="comment">// Corresponds to `CROP_HINTS`</span></span><br><span class="line">    <span class="string">&#x27;web&#x27;</span>             <span class="comment">// Corresponds to `WEB_DETECTION`</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><blockquote><p>以上初次使用的坑，见识略薄（也可能是我的理解和使用方式不对），也希望你们在使用的过程中能有所帮助！</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> Google Vision </tag>
            
            <tag> OCR </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>H5网页唤醒app,判断app安装</title>
      <link href="/2019/09/24/H5%E7%BD%91%E9%A1%B5%E5%94%A4%E9%86%92app-%E5%88%A4%E6%96%ADapp%E5%AE%89%E8%A3%85/"/>
      <url>/2019/09/24/H5%E7%BD%91%E9%A1%B5%E5%94%A4%E9%86%92app-%E5%88%A4%E6%96%ADapp%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<blockquote><p>在阅读本文之前你首先应该对js有基本对掌握，并且对Scheme，intent有一定的理解。更多的是代码</p></blockquote><span id="more"></span><h2 id="callapp-lib"><a href="#callapp-lib" class="headerlink" title="callapp-lib"></a><a href="https://www.npmjs.com/package/callapp-lib">callapp-lib</a></h2><p>这里利用了别人的库，可以省略部分代码，<code>callapp-lib</code>可以直接唤醒app，以及唤醒失败的<code>callback</code>，但是你得传入Scheme。</p><p><code>callapp-lib</code>库可能有一点问题，我也没有理解透彻，它并不给你提供唤醒成功<code>callback</code>的功能，所以需要我们自己补足。<br>文档：<a href="https://www.npmjs.com/package/callapp-lib">callapp-lib</a></p><figure class="highlight javascript"><figcaption><span>1.6</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">CallApp</span> <span class="keyword">from</span> <span class="string">&#x27;callapp-lib&#x27;</span></span><br><span class="line"><span class="keyword">const</span> option = &#123;</span><br><span class="line">    <span class="attr">scheme</span>: &#123;</span><br><span class="line">        <span class="attr">protocol</span>: <span class="string">&#x27;itms-beta&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">outChain</span>: &#123;</span><br><span class="line">        <span class="attr">protocol</span>: <span class="string">&#x27;itms-beta&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">appstore</span>: <span class="string">&#x27;http://www.apple.com&#x27;</span>,</span><br><span class="line">    <span class="attr">yingyongbao</span>: <span class="string">&#x27;http://www.zhihu.com&#x27;</span>,</span><br><span class="line">    <span class="attr">fallback</span>: <span class="string">&#x27;https://www.baidu.com&#x27;</span>,</span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">3000</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> lib = <span class="keyword">new</span> <span class="title class_">CallApp</span>(option);</span><br><span class="line"><span class="keyword">const</span> callButton = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#call-button&#x27;</span>);</span><br><span class="line">callButton.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    vm.<span class="property">is_show</span> = <span class="number">1</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$toast</span>.<span class="title function_">loading</span>(&#123;</span><br><span class="line">        <span class="attr">mask</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;加载中...&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    lib.<span class="title function_">open</span>(&#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/text&#x27;</span>,</span><br><span class="line">        <span class="attr">callback</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            vm.<span class="property">is_show</span> = <span class="number">0</span></span><br><span class="line">            self.<span class="property">$toast</span>.<span class="title function_">fail</span>(<span class="string">&#x27;打开TestFlight失败,请先下载支持软件TestFlight&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">    </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="检测网页是否被切到后台运行，并监听该事件"><a href="#检测网页是否被切到后台运行，并监听该事件" class="headerlink" title="检测网页是否被切到后台运行，并监听该事件"></a>检测网页是否被切到后台运行，并监听该事件</h2><p><code>is_show</code> 是为了阻止重复加载</p><figure class="highlight javascript"><figcaption><span>1.6</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> hidden, state, visibilityChange;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">document</span>.<span class="property">hidden</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    hidden = <span class="string">&quot;hidden&quot;</span>;</span><br><span class="line">    visibilityChange = <span class="string">&quot;visibilitychange&quot;</span>;</span><br><span class="line">    state = <span class="string">&quot;visibilityState&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">document</span>.<span class="property">mozHidden</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    hidden = <span class="string">&quot;mozHidden&quot;</span>;</span><br><span class="line">    visibilityChange = <span class="string">&quot;mozvisibilitychange&quot;</span>;</span><br><span class="line">    state = <span class="string">&quot;mozVisibilityState&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">document</span>.<span class="property">msHidden</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    hidden = <span class="string">&quot;msHidden&quot;</span>;</span><br><span class="line">    visibilityChange = <span class="string">&quot;msvisibilitychange&quot;</span>;</span><br><span class="line">    state = <span class="string">&quot;msVisibilityState&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">document</span>.<span class="property">webkitHidden</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    hidden = <span class="string">&quot;webkitHidden&quot;</span>;</span><br><span class="line">    visibilityChange = <span class="string">&quot;webkitvisibilitychange&quot;</span>;</span><br><span class="line">    state = <span class="string">&quot;webkitVisibilityState&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(visibilityChange, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">  <span class="comment">//这里判断不要重复下载</span></span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="property">is_show</span> == <span class="number">1</span>) &#123;</span><br><span class="line">      vm.<span class="property">is_show</span> = <span class="number">0</span></span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">&#x27;正在下载&#x27;</span>);</span><br><span class="line">      location.<span class="title function_">reload</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>原创不易，转载请附上原文出处链接,谢谢<br>原文链接：<a href="https://lihengc.github.io/2019/09/24/H5%E7%BD%91%E9%A1%B5%E5%94%A4%E9%86%92app-%E5%88%A4%E6%96%ADapp%E5%AE%89%E8%A3%85/">https://lihengc.github.io/2019/09/24/H5%E7%BD%91%E9%A1%B5%E5%94%A4%E9%86%92app-%E5%88%A4%E6%96%ADapp%E5%AE%89%E8%A3%85/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> H5网页唤醒app </tag>
            
            <tag> intent </tag>
            
            <tag> Scheme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql主从复制配置</title>
      <link href="/2019/09/09/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE/"/>
      <url>/2019/09/09/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<blockquote><p>a为主库，b为从库！</p></blockquote><h3 id="mysql主从复制介绍"><a href="#mysql主从复制介绍" class="headerlink" title="mysql主从复制介绍"></a>mysql主从复制介绍</h3><span id="more"></span><p>mysql主从复制，发生在a,b数据库环境下，a为宿主机，b为奴隶机。在a里面写入数据，b也会自动写入数据，从而达到数据一致。</p><h4 id="主从原理及过程"><a href="#主从原理及过程" class="headerlink" title="主从原理及过程"></a>主从原理及过程</h4><p>mysql主从是基于binlog，主机上需要开启binlog才能实现主从。</p><p>过程及其简单<br><br /></p><ul><li><p>a将所有的写操作记录在binlog日志中，并生成log dump线程 将binlog日志传给b库的I&#x2F;O线程</p></li><li><p>b库生成两个线程，一个是I&#x2F;O线程，另一个是SQL线程</p></li><li><p>I&#x2F;O线程去请求主库的binlog日志，并将binlog日志中的文件写入relay log（中继日志）中</p></li><li><p>SQL线程会读取relay loy中的内容，并解析成具体的操作，来实现主从的操作一致，达到最终数据一致的目的</p></li></ul><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><ul><li>实时灾备，用于故障切换</li><li>读写分离，提供查询服务</li><li>备份，避免影响业务</li></ul><h3 id="主从复制配置步骤"><a href="#主从复制配置步骤" class="headerlink" title="主从复制配置步骤"></a>主从复制配置步骤</h3><ol><li><p>确保b数据库与a库里的数据一致</p></li><li><p>在a数据库里创建一个同步账户授权给b数据库使用</p></li><li><p>配置a库（修改数据库配置文件）</p></li><li><p>配置b库 (修改数据库配置文件)</p></li></ol><h3 id="下面是我自己测试所用到的环境以及整个过程"><a href="#下面是我自己测试所用到的环境以及整个过程" class="headerlink" title="下面是我自己测试所用到的环境以及整个过程"></a>下面是我自己测试所用到的环境以及整个过程</h3><blockquote><p>因为我使用的是docker环境直接部署的镜像数据库所有没有操作系统版本,并且我省略掉略docker的一些过程，可以自行琢磨。</p></blockquote><table><thead><tr><th>数据库角色</th><th>ip</th><th>数据库版本</th></tr></thead><tbody><tr><td>a(主数据库)</td><td>172.17.0.2</td><td>5.6</td></tr><tr><td>b(从数据库)</td><td>172.17.0.3</td><td>5.6</td></tr></tbody></table><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>1.安装docker，拉取镜像，运行两个数据库环境,并初始化数据库(如有需要可以挂载目录，以及建立软连)</p><h4 id="主库配置"><a href="#主库配置" class="headerlink" title="主库配置"></a>主库配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line">//建立一个新库及表并且插入了几条数据</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create database testbase;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">use testbase;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create table tom (<span class="built_in">id</span> int not null,name varchar(100)not null ,age tinyint);</span></span><br><span class="line">Query OK, 0 rows affected (11.83 sec)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">insert tom (<span class="built_in">id</span>,name,age) values(1,<span class="string">&#x27;zhangshan&#x27;</span>,20),(2,<span class="string">&#x27;wangwu&#x27;</span>,7),(3,<span class="string">&#x27;lisi&#x27;</span>,23);</span></span><br><span class="line">Query OK, 3 rows affected (0.07 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> * from tom;</span></span><br><span class="line">+----+-----------+------+</span><br><span class="line">| id | name      | age  |</span><br><span class="line">+----+-----------+------+</span><br><span class="line">|  1 | zhangshan |   20 |</span><br><span class="line">|  2 | wangwu    |    7 |</span><br><span class="line">|  3 | lisi      |   23 |</span><br><span class="line">+----+-----------+------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line">备份主库</span><br><span class="line">备份主库时需要另开一个终端，给数据库上读锁，避免在备份期间有其他人在写入导致数据同步的不一致</span><br><span class="line">//第一个终端</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">flush tables with <span class="built_in">read</span> lock;</span></span><br><span class="line">Query OK, 0 rows affected (0.76 sec)</span><br><span class="line"></span><br><span class="line">//第二个终端 备份完毕直接退出第一个终端就解锁</span><br><span class="line">root@ca05ed1d3a86:/#  mysqldump -uroot -proot --all-databases &gt; /opt/all-20190909.sql</span><br><span class="line"></span><br><span class="line">//现在需要把备份的sql文件放到从库环境当中去，因为我使用的是docker所以比较麻烦，过程我就省略了</span><br><span class="line"></span><br><span class="line">//进入从库环境 导入数据库</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">source</span> /opt/all-20190909.sql</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| testbase           |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> * from tom;</span></span><br><span class="line">+----+-----------+------+</span><br><span class="line">| id | name      | age  |</span><br><span class="line">+----+-----------+------+</span><br><span class="line">|  1 | zhangshan |   20 |</span><br><span class="line">|  2 | wangwu    |    7 |</span><br><span class="line">|  3 | lisi      |   23 |</span><br><span class="line">+----+-----------+------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line">//确认和主库一致 退出从库</span><br><span class="line">//在主数据库创建一个同步账户授权给从数据使用</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create user <span class="string">&#x27;Slave&#x27;</span>@<span class="string">&#x27;172.17.0.3&#x27;</span> identified by <span class="string">&#x27;root&#x27;</span>;</span></span><br><span class="line">Query OK, 0 rows affected (5.50 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">grant replication slave on *.* to <span class="string">&#x27;Slave&#x27;</span>@<span class="string">&#x27;172.17.0.3&#x27;</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges;</span></span><br><span class="line">Query OK, 0 rows affected (0.09 sec)</span><br><span class="line"></span><br><span class="line">//修改主库配置文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">quit</span></span><br><span class="line">Bye</span><br><span class="line">root@ca05ed1d3a86:/# vi /etc/mysql/mysql.conf.d/mysqld.cnf </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (c) 2014, 2016, Oracle and/or its affiliates. All rights reserved.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This program is free software; you can redistribute it and/or modify</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">it under the terms of the GNU General Public License as published by</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the Free Software Foundation; version 2 of the License.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This program is distributed in the hope that it will be useful,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">GNU General Public License <span class="keyword">for</span> more details.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># You should have received a copy of the GNU General Public License</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">along with this program; <span class="keyword">if</span> not, write to the Free Software</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The MySQL  Server configuration file.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># For explanations see</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">http://dev.mysql.com/doc/mysql/en/server-system-variables.html</span></span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">pid-file= /var/run/mysqld/mysqld.pid</span><br><span class="line">socket= /var/run/mysqld/mysqld.sock</span><br><span class="line">datadir= /var/lib/mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">log-error= /var/log/mysql/error.log</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line">symbolic-links=0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">add 此处为新加的</span></span><br><span class="line">log-bin=mysql-bin //启用binlog日志</span><br><span class="line">server-id=1 //主数据库服务器唯一标识符 主的必须必从大</span><br><span class="line">log-error=/var/log/mysql/error.log</span><br><span class="line"></span><br><span class="line">//重启主库</span><br><span class="line">root@ca05ed1d3a86:/# exit</span><br><span class="line">LeedeiMac:Desktop lee$ docker restart ts_mysql</span><br><span class="line"></span><br><span class="line">查看主库的状态</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show master status;</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show master status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             File: mysql-bin.000002</span><br><span class="line">         Position: 588</span><br><span class="line">     Binlog_Do_DB: </span><br><span class="line"> Binlog_Ignore_DB: </span><br><span class="line">Executed_Gtid_Set: </span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//下面接着配置从库</span><br><span class="line">root@1711bd0b98b0:/# vi /etc/mysql/mysql.conf.d/mysqld.cnf </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (c) 2014, 2016, Oracle and/or its affiliates. All rights reserved.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This program is free software; you can redistribute it and/or modify</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">it under the terms of the GNU General Public License as published by</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the Free Software Foundation; version 2 of the License.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This program is distributed in the hope that it will be useful,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">GNU General Public License <span class="keyword">for</span> more details.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># You should have received a copy of the GNU General Public License</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">along with this program; <span class="keyword">if</span> not, write to the Free Software</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The MySQL  Server configuration file.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># For explanations see</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">http://dev.mysql.com/doc/mysql/en/server-system-variables.html</span></span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">pid-file= /var/run/mysqld/mysqld.pid</span><br><span class="line">socket= /var/run/mysqld/mysqld.sock</span><br><span class="line">datadir= /var/lib/mysql</span><br><span class="line">log-error= /var/log/mysql/error.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line">symbolic-links=0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">add 此处为新加的</span></span><br><span class="line">server-id=2 //设置从库的唯一标识符 从的必须比主小</span><br><span class="line">relay-log=mysql-relay-bin //启用中继日志relay log</span><br><span class="line"></span><br><span class="line">//配置完毕后记得重启</span><br><span class="line">//配置并启动主从复制</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">change master to</span></span><br><span class="line">    -&gt; master_host=&#x27;172.17.0.2&#x27;,</span><br><span class="line">    -&gt; master_user=&#x27;Slave&#x27;,</span><br><span class="line">    -&gt; master_password=&#x27;root&#x27;,</span><br><span class="line">    -&gt; master_log_file=&#x27;mysql-bin.000002&#x27;,</span><br><span class="line">    -&gt; master_log_pos=588;</span><br><span class="line">Query OK, 0 rows affected, 2 warnings (0.28 sec)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">start slave</span></span><br><span class="line">//查看从服务器状态</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show slave status\G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 172.17.0.2</span><br><span class="line">                  Master_User: Slave</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000002</span><br><span class="line">          Read_Master_Log_Pos: 822</span><br><span class="line">               Relay_Log_File: mysql-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 985</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000002</span><br><span class="line">             Slave_IO_Running: Yes  //IO线程必须是YES</span><br><span class="line">            Slave_SQL_Running: Yes  //SQL线程必须是YES</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 822</span><br><span class="line">              Relay_Log_Space: 1158</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: ebbfdd47-b8f4-11e9-98ee-0242ac110002</span><br><span class="line">             Master_Info_File: /var/lib/mysql/master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to update it</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: 0</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line">//到这里就成功了，我也就不做验证了</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="如果有遇见io线程和sql线程开启不了的，原因太多，请自行-goole。"><a href="#如果有遇见io线程和sql线程开启不了的，原因太多，请自行-goole。" class="headerlink" title="如果有遇见io线程和sql线程开启不了的，原因太多，请自行 goole。"></a>如果有遇见io线程和sql线程开启不了的，原因太多，请自行 <a href="https://www.google.com/">goole</a>。</h4><blockquote><p>码字不易～</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>slow log慢日志分析,phpfpm性能分析</title>
      <link href="/2019/08/15/%E6%85%A2%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90-phpfpm%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/"/>
      <url>/2019/08/15/%E6%85%A2%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90-phpfpm%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>我们都知道mysql是有slow query log，根据慢查询日志，我们可以知道那些sql语句有性能问题<br>当然php也是具有慢日志的，如果你使用php-fpm来管理php的话，你可以通过如下选项开启。</p><span id="more"></span><h4 id="PHP-5-3-3-之前设置如下："><a href="#PHP-5-3-3-之前设置如下：" class="headerlink" title="PHP 5.3.3 之前设置如下："></a>PHP 5.3.3 之前设置如下：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;value name=&quot;request_slowlog_timeout&quot;&gt;5s&lt;/value&gt;</span><br><span class="line">&lt;value name=&quot;slowlog&quot;&gt;logs/php-fpm-slowlog.log&lt;/value&gt;</span><br></pre></td></tr></table></figure><h4 id="PHP-5-3-3-之后设置以下如下：php-fpm-conf"><a href="#PHP-5-3-3-之后设置以下如下：php-fpm-conf" class="headerlink" title="PHP 5.3.3 之后设置以下如下：php-fpm.conf"></a>PHP 5.3.3 之后设置以下如下：php-fpm.conf</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">request_slowlog_timeout = 5s</span><br><span class="line">slowlog = /usr/local/php/log/php-fpm-slowlog.log</span><br></pre></td></tr></table></figure><p>说明:</p><p>request_slowlog_timeout 是脚本超过多长时间 就可以记录到日志文件</p><p>slowlog 是日志文件的路径</p><h4 id="开启后，如果有脚本执行超过指定的时间，就会在指定的日志文件中写入类似如下的信息："><a href="#开启后，如果有脚本执行超过指定的时间，就会在指定的日志文件中写入类似如下的信息：" class="headerlink" title="开启后，如果有脚本执行超过指定的时间，就会在指定的日志文件中写入类似如下的信息："></a>开启后，如果有脚本执行超过指定的时间，就会在指定的日志文件中写入类似如下的信息：</h4><figure class="highlight plaintext"><figcaption><span>log</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[15-Aug-2019 14:50:19] [pool www] pid 18575</span><br><span class="line">script_filename = /home/web/htdocs/xxxx/test/tt.php</span><br><span class="line">[0x0000000003a00dc8] curl_exec() /home/web/htdocs/xxxx/test/tt.php:2</span><br><span class="line">[0x0000000003a00cd0] exfilter_curl_get() /home/web/htdocs/xxxx/test/tt.php:6</span><br></pre></td></tr></table></figure><h4 id="日志说明："><a href="#日志说明：" class="headerlink" title="日志说明："></a>日志说明：</h4><ol><li>script_filename 是入口文件</li><li>curl_exec() ： 说明是执行这个方法的时候超过执行时间的。</li><li>exfilter_curl_get() ：说明调用curl_exec()的方法是exfilter_curl_get() 。</li><li>每行冒号后面的数字是行号。</li></ol><p>开启后，在错误日志文件中也有相关记录。如下：</p><figure class="highlight plaintext"><figcaption><span>log</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[15-Aug-2019 15:55:37] WARNING: [pool www] child 18575, script &#x27;/home/web/htdocs/xxxxlong/test/tt.php&#x27; (request: &quot;GET /test/tt.php&quot;) executing too slow (1.006222 sec), logging</span><br><span class="line">[15-Aug-2019 15:55:37] NOTICE: child 18575 stopped for tracing</span><br><span class="line">[15-Aug-2019 15:55:37] NOTICE: about to trace 18575</span><br><span class="line">[15-Aug-2019 15:55:37] NOTICE: finished trace of 18575</span><br></pre></td></tr></table></figure><h3 id="Docker-php-fpm-慢查询-failed-to-ptrace-Operation-not-permitted解决方案"><a href="#Docker-php-fpm-慢查询-failed-to-ptrace-Operation-not-permitted解决方案" class="headerlink" title="Docker php-fpm 慢查询 failed to ptrace Operation not permitted解决方案"></a>Docker php-fpm 慢查询 failed to ptrace Operation not permitted解决方案</h3><p>宿主机的服务慢查询是正常的，但是到了Docker中的php-fpm服务，触发慢查询后，会输出类似报错：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[15-Aug-2019 15:59:17] ERROR: failed to ptrace(ATTACH) child 5118: Operation not permitted (1)</span><br><span class="line">[15-Aug-2019 15:59:17] WARNING: [pool www] child 5118, script &#x27;/www/index.php&#x27; (request: &quot;GET /index.php&quot;) executing too slow (1.021099 sec), logging</span><br></pre></td></tr></table></figure><p>开始没想到的Docker容器权限问题，后来搜了下，在serverfault找到了解决方案：<br>容器启动时，加入参数：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--cap-<span class="keyword">add</span><span class="language-bash"> SYS_PTRACE</span></span><br></pre></td></tr></table></figure><p>解决方案来自：<a href="https://serverfault.com/questions/704007/php-slowlog-causing-ptrace-error-in-docker-container/706982#706982">https://serverfault.com/questions/704007/php-slowlog-causing-ptrace-error-in-docker-container/706982#706982</a></p><hr><ul><li>系统日志：记录系统相关信息：<a href="http://blog.csdn.net/ty_hf/article/details/55511624">http://blog.csdn.net/ty_hf/article/details/55511624</a></li><li>apache访问日志与错误日志：<a href="http://blog.csdn.net/ty_hf/article/details/55504719">http://blog.csdn.net/ty_hf/article/details/55504719</a></li><li>nginx访问日志与错误日志：<a href="http://blog.csdn.net/ty_hf/article/details/55518070">http://blog.csdn.net/ty_hf/article/details/55518070</a></li><li>php-fpm慢日志：检测执行较慢的PHP脚本：<a href="http://blog.csdn.net/ty_hf/article/details/55504172">http://blog.csdn.net/ty_hf/article/details/55504172</a></li><li>php错误日志：检测php运行时或用户自记录错误日志：<a href="http://blog.csdn.net/ty_hf/article/details/55505262">http://blog.csdn.net/ty_hf/article/details/55505262</a></li><li>mysql慢日志：记录mysql服务器中影响性能的SQL：<a href="http://blog.csdn.net/ty_hf/article/details/55504172">http://blog.csdn.net/ty_hf/article/details/55504172</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> php-fpm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php-fpm安装redis</title>
      <link href="/2019/08/10/php-fpm%E5%AE%89%E8%A3%85redis/"/>
      <url>/2019/08/10/php-fpm%E5%AE%89%E8%A3%85redis/</url>
      
        <content type="html"><![CDATA[<p>一顿操作猛如虎</p><span id="more"></span><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it ts_phpfpm /bin/bash</span><br><span class="line">curl -L -o /tmp/redis.tar.gz https://github.com/phpredis/phpredis/archive/<span class="number">3.1</span>.<span class="number">3</span>.tar.gz</span><br><span class="line"></span><br><span class="line">tar xfz /tmp/redis.tar.gz</span><br><span class="line"></span><br><span class="line">rm -r /tmp/redis.tar.gz</span><br><span class="line"></span><br><span class="line">mkdir -p /usr/src/php/ext</span><br><span class="line"></span><br><span class="line">mv phpredis-<span class="number">3.1</span>.<span class="number">3</span> /usr/src/php/ext/redis</span><br><span class="line"></span><br><span class="line">docker-php-ext-install redis</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> docker </tag>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP编写守护进程</title>
      <link href="/2019/08/05/PHP%E7%BC%96%E5%86%99%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/"/>
      <url>/2019/08/05/PHP%E7%BC%96%E5%86%99%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<ul><li><p>进程根据状态可以分为三种进程，守护进程，僵尸进程，孤儿进程。今天我们着重来分析下守护进程。</p><h3 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h3>  <hr />  #### 简介  <span id="more"></span>  守护进程 (daemon) 是一类在后台运行的特殊进程，用于执行特定的系统任务。很多守护进程在系统引导的时候启动，并且一直运行直到系统关闭。另一些只在需要的时候才启动，完成任务后就自动结束。  <h4 id="创建步骤"><a href="#创建步骤" class="headerlink" title="创建步骤"></a>创建步骤</h4></li></ul><p>####1. 创建子进程，终止父进程<br>    由于守护进程是脱离控制终端的，因此首先创建子进程，终止父进程，使得程序在 shell 终端里造成一个已经运行完毕的假象。<br>    之后所有的工作都在子进程中完成，而用户在 shell 终端里则可以执行其他的命令，从而使得程序以僵尸进程形式运行，在形式 I 上做到了与控制终端的脱离。<br>####2. 在子进程中创建新会话<br>    这个步骤是创建守护进程中最重要的一步，在这里使用的是系统函数 setsid。<br>    setsid 函数用于创建一个新的会话，并担任该会话组的组长。<br>    调用 setsid 的三个作用：让进程摆脱原会话的控制、让进程摆脱原进程组的控制和让进程摆脱原控制终端的控制。<br>    在调用 fork 函数时，子进程全盘拷贝父进程的会话期 (session，是一个或多个进程组的集合)、进程组、控制终端等，虽然父进程退出了，但原先的会话期、进程组、控制终端等并没有改变，因此，那还不是真正意义上使两者独立开来。<br>    setsid 函数能够使进程完全独立出来，从而脱离所有其他进程的控制。</p><p>####3. 改变工作目录<br>    使用fork创建的子进程会继承父进程的当前工作目录。<br>    由于子进程运行的过程中，当前目录所在的文件系统不能被卸载，因此，我们需要把当前工作目录换成其他路径，如<code>/</code>或<code>/tmp</code>等。<br>    改变工作目录的常见函数是chdir。<br>####4. 重设文件创建掩码<br>    文件创建掩码是指屏蔽掉文件创建时的对应位。<br>    由于使用 fork 函数新建的子进程继承了父进程的文件创建掩码，这就给该子进程使用文件带来了诸多的麻烦。<br>    因此，把文件创建掩码设置为 0，可以大大增强该守护进程的灵活性。<br>    设置文件创建掩码的函数是 umask，通常的使用方法为 umask (0)。<br>####5. 关闭文件描述符<br>    用 fork 新建的子进程会从父进程那里继承一些已经打开了的文件。<br>    这些被打开的文件可能永远不会被守护进程读或写，但它们一样消耗系统资源，可能导致所在的文件系统无法卸载。<br>    在上面的第二步之后，守护进程已经与所属的控制终端失去了联系。<br>    因此从终端输入的字符不可能达到守护进程，守护进程中用常规方法（如printf）输出的字符也不可能在终端上显示出来。<br>    所以，文件描述符为0、1和2 的3个文件（常说的输入、输出和报错）已经失去了存在的价值，也应被关闭。</p><p>##code：</p><pre><code class="language-php">&lt;?phpclass Deamon{    protected $_pidFile;    public function __construct()    {        $this-&gt;_pidFile = &#39;/var/www/html/queue/public/pid.log&#39;;        $this-&gt;_checkPcntl();    }    /**     * 创建守护进程核心函数     * @return string|void     */    private function _demonize()    {        if (php_sapi_name() != &#39;cli&#39;) {            die(&#39;Should run in CLI&#39;);        }        //创建子进程        $pid = pcntl_fork();        if ($pid == -1) {            return &#39;fork faile&#39;;        } elseif ($pid) {            //终止父进程            exit(&#39;parent process&#39;);        }        //在子进程中创建新的会话        if (posix_setsid() === -1) {            die(&#39;Could not detach&#39;);        }        //改变工作目录        chdir(&#39;/&#39;);        //重设文件创建的掩码        umask(0);        $fp = fopen($this-&gt;_pidFile, &#39;w&#39;) or die(&quot;Can&#39;t create pid file&quot;);        //把当前进程的id写入到文件中        fwrite($fp, posix_getpid());        fclose($fp);        //关闭文件描述符        fclose(STDIN);        fclose(STDOUT);        fclose(STDERR);        //运行守护进程的逻辑        $this-&gt;job();        return;    }    /**     * 守护进程的任务     */    private function job()    {        //TODO 你的守护经常需要执行的任务        while (true) {            file_put_contents(&#39;/var/www/html/queue/public/job.log&#39;, &#39;job&#39; . PHP_EOL, FILE_APPEND);            sleep(5);        }    }    /**     * 获取守护进程的id     * @return int     */    private function _getPid()    {        //判断存放守护进程id的文件是否存在        if (!file_exists($this-&gt;_pidFile)) {            return 0;        }        $pid = intval(file_get_contents($this-&gt;_pidFile));        if (posix_kill($pid, SIG_DFL)) {//判断该进程是否正常运行中            return $pid;        } else {            unlink($this-&gt;_pidFile);            return 0;        }    }    /**     * 判断pcntl拓展     */    private function _checkPcntl()    {        !function_exists(&#39;pcntl_signal&#39;) &amp;&amp; die(&#39;Error:Need PHP Pcntl extension!&#39;);    }    private function _message($message)    {        printf(&quot;%s  %d %d  %s&quot; . PHP_EOL, date(&quot;Y-m-d H:i:s&quot;), posix_getpid(), posix_getppid(), $message);    }    /**     * 开启守护进程     */    private function start()    {        if ($this-&gt;_getPid() &gt; 0) {            $this-&gt;_message(&#39;Running&#39;);        } else {            $this-&gt;_demonize();            $this-&gt;_message(&#39;Start&#39;);        }    }    /**     * 停止守护进程     */    private function stop()    {        $pid = $this-&gt;_getPid();        if ($pid &gt; 0) {            //通过向进程id发送终止信号来停止进程            posix_kill($pid, SIGTERM);            unlink($this-&gt;_pidFile);            echo &#39;Stoped&#39; . PHP_EOL;        } else {            echo &quot;Not Running&quot; . PHP_EOL;        }    }    private function status()    {        if ($this-&gt;_getPid() &gt; 0) {            $this-&gt;_message(&#39;Is Running&#39;);        } else {            echo &#39;Not Running&#39; . PHP_EOL;        }    }    public function run($argv)    {        $param = is_array($argv) &amp;&amp; count($argv) == 2 ? $argv[1] : null;        switch ($param) {            case &#39;start&#39;:                $this-&gt;start();                break;            case &#39;stop&#39;:                $this-&gt;stop();                break;            case &#39;status&#39;:                $this-&gt;status();                break;            default:                echo &quot;Argv start|stop|status &quot; . PHP_EOL;                break;        }    }}$deamon = new \Deamon();$deamon-&gt;run($argv);</code></pre><h3 id="运行方式"><a href="#运行方式" class="headerlink" title="运行方式"></a>运行方式</h3><ul><li>开启守护进程：php test.php start</li><li>停止守护进程：php test.php stop</li><li>查看守护进程的状态：php test.php status</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> swoole </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php装饰器设计</title>
      <link href="/2019/06/26/%E8%A3%85%E9%A5%B0%E5%99%A8%E8%AE%BE%E8%AE%A1/"/>
      <url>/2019/06/26/%E8%A3%85%E9%A5%B0%E5%99%A8%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 装饰器模式（Decorator Pattern）允许向一个现有的对象添加新的功能，同时又不改变其结构。这种类型的设计模式属于结构型模式，它是作为现有的类的一个包装。</span></span><br><span class="line"><span class="comment"> * 这种模式创建了一个装饰类，用来包装原有的类，并在保持类方法签名完整性的前提下，提供了额外的功能。</span></span><br><span class="line"><span class="comment"> * 我们通过下面的实例来演示装饰器模式的用法。其中，我们将把一个形状装饰上不同的颜色，同时又不改变形状类。</span></span><br><span class="line"><span class="comment"> * 优点：装饰类和被装饰类可以独立发展，不会相互耦合，装饰模式是继承的一个替代模式，装饰模式可以动态扩展一个实现类的功能。</span></span><br><span class="line"><span class="comment"> * 缺点：多层装饰比较复杂。</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><span id="more"></span><p>(1)Shape.class.php（抽象接口）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Decorator</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Shape</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（2）Circle.class.php（圆形具体实现类）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Decorator</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="string">&quot;Shape: Circle&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（3）Rectangle.class.php（长方形具体实现类）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Decorator</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="string">&quot;Shape: Rectangle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(4)ShapeDecorator.class.php（形状装饰类 抽象父类）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Decorator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeDecorator</span> <span class="keyword">implements</span> <span class="title">Shape</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$decoratorShape</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Shape <span class="variable">$shape</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;decoratorShape = <span class="variable">$shape</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;decoratorShape-&gt;<span class="title function_ invoke__">draw</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（5）RedShapeDecorator.class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Decorator</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedShapeDecorator</span> <span class="keyword">extends</span> <span class="title">ShapeDecorator</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Shape <span class="variable">$shape</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>(<span class="variable">$shape</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;decoratorShape-&gt;<span class="title function_ invoke__">draw</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setRedColor</span>(<span class="variable">$this</span>-&gt;decoratorShape);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">setRedColor</span>(<span class="params">Shape <span class="variable">$shape</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(6)decorator.php（客户端类）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">spl_autoload_register</span>(function (<span class="variable">$className</span>)&#123;</span><br><span class="line">    <span class="variable">$className</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;/&#x27;</span>,<span class="variable">$className</span>);</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$className</span>.<span class="string">&quot;.class.php&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Decorator</span>\<span class="title">Circle</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Decorator</span>\<span class="title">RedShapeDecorator</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$circle</span> = <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$redCircle</span> = <span class="keyword">new</span> <span class="title class_">RedShapeDecorator</span>(<span class="keyword">new</span> <span class="title class_">Circle</span>());</span><br><span class="line"><span class="variable">$redCircle</span>-&gt;<span class="title function_ invoke__">draw</span>();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js复制和js识别各大蜘蛛</title>
      <link href="/2019/06/24/js%E5%A4%8D%E5%88%B6%E5%92%8Cjs%E8%AF%86%E5%88%AB%E5%90%84%E5%A4%A7%E8%9C%98%E8%9B%9B/"/>
      <url>/2019/06/24/js%E5%A4%8D%E5%88%B6%E5%92%8Cjs%E8%AF%86%E5%88%AB%E5%90%84%E5%A4%A7%E8%9C%98%E8%9B%9B/</url>
      
        <content type="html"><![CDATA[<blockquote><p>js实现复制内容到剪贴板，兼容移动端和pc端</p></blockquote><span id="more"></span><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="keyword">function</span> <span class="title function_">copy</span>(<span class="params">str</span>)&#123;</span><br><span class="line">　　　　<span class="keyword">var</span> save = <span class="keyword">function</span> (<span class="params">e</span>)&#123;</span><br><span class="line">　　　　　　e.<span class="property">clipboardData</span>.<span class="title function_">setData</span>(<span class="string">&#x27;text/plain&#x27;</span>,str);</span><br><span class="line">　　　　　　e.<span class="title function_">preventDefault</span>();<span class="comment">//阻止默认行为</span></span><br><span class="line">　　　　&#125;</span><br><span class="line">　　　　<span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;copy&#x27;</span>,save);</span><br><span class="line">　　　　<span class="variable language_">document</span>.<span class="title function_">execCommand</span>(<span class="string">&quot;copy&quot;</span>);<span class="comment">//使文档处于可编辑状态，否则无效</span></span><br><span class="line">　　&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//使用jQuery中的方法监听用户的剪切、复制、粘贴的行为：</span></span><br><span class="line">$(<span class="string">&quot;#cut&quot;</span>).<span class="title function_">on</span>(<span class="string">&quot;cut&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="title function_">alert</span>(<span class="string">&quot;剪切&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;#copy&quot;</span>).<span class="title function_">on</span>(<span class="string">&quot;copy&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="title function_">alert</span>(<span class="string">&quot;复制&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;#paste&quot;</span>).<span class="title function_">on</span>(<span class="string">&quot;paste&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="title function_">alert</span>(<span class="string">&quot;粘贴&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这些行为包括使用键盘的ctrl + c操作，或者右击鼠标—&gt;复制等操作。</p><h3 id="Evevt-clipboardData-对象"><a href="#Evevt-clipboardData-对象" class="headerlink" title="Evevt.clipboardData 对象"></a>Evevt.clipboardData 对象</h3><pre><code>clipboardData是JavaScript剪切板对象，该对象提供了3个常用方法：</code></pre><ul><li><p>clearData():  clipboardData对象从剪切板删除一种或多种数据格式（一个参数：数据类型）</p></li><li><p>getData():  clipboardData对象从剪切板获取指定格式的数据（一个参数：数据类型）</p></li><li><p>setData():  clipboardData对象赋予指定格式的数据（两个参数：数据类型，要赋予的值）</p></li><li><p>*数据类型一般为“”text&#x2F;plain” ”</p></li></ul><h2 id="js识别蜘蛛"><a href="#js识别蜘蛛" class="headerlink" title="js识别蜘蛛"></a>js识别蜘蛛</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pattern = <span class="regexp">/google/gi</span>;</span><br><span class="line"><span class="keyword">var</span> pattern1= <span class="regexp">/yahoo/gi</span>;</span><br><span class="line"><span class="keyword">var</span> keyValue=<span class="built_in">escape</span>(<span class="variable language_">document</span>.<span class="property">referrer</span>);</span><br><span class="line"><span class="keyword">if</span> (pattern.<span class="title function_">exec</span>(keyValue))</span><br><span class="line"><span class="built_in">setTimeout</span>(</span><br><span class="line"><span class="string">&quot;windows.location=&#x27;//www.baidu.com&#x27;&quot;</span>,<span class="number">10</span>*<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(pattern1.<span class="title function_">exec</span>(keyValue))</span><br><span class="line"><span class="built_in">setTimeout</span>(</span><br><span class="line"><span class="string">&quot;window.location=&#x27;//www.baidu.com&#x27;&quot;</span>,<span class="number">10</span>*<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>php301版本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(“#(google|slurp@inktomi|yahoo! slurp|msnbot)<span class="comment">#si”, $_SERVER[&#x27;HTTP_USER_AGENT&#x27;])) &#123;</span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">header</span>(“HTTP/<span class="number">1.1</span> <span class="number">301</span> Moved Permanently”);</span><br><span class="line"><span class="title function_ invoke__">header</span>(“<span class="attr">Location</span>: <span class="attr">http</span>://www.saoyu.com/”);</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">  </span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> JS </tag>
            
            <tag> ES </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chrome插件开发二</title>
      <link href="/2019/06/06/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E4%BA%8C/"/>
      <url>/2019/06/06/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E4%BA%8C/</url>
      
        <content type="html"><![CDATA[<h3 id="popup"><a href="#popup" class="headerlink" title="popup"></a>popup</h3><p><code>popup</code>是点击<code>browser_action</code>或者<code>page_action</code>图标时打开的一个小窗口网页，焦点离开网页就立即关闭，一般用来做一些临时性的交互。<br><br /><br><img src="/img/popup.png" alt="popup" title="popup"><br><br /><br><code>popup</code>可以包含任意你想要的HTML内容，并且会自适应大小。可以通过<code>default_popup</code>字段来指定<code>popup</code>页面，也可以调用<code>setPopup()</code>方法。<br><br /></p><span id="more"></span><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// 图标悬停时的标题，可选</span></span><br><span class="line">        <span class="attr">&quot;default_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;这是一个示例Chrome插件&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">background.<span class="property">js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCurrentTabid</span>(<span class="params">callback</span>)&#123;</span><br><span class="line">    chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="keyword">function</span>(<span class="params">tabs</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(callback) <span class="title function_">callback</span>(tabs.<span class="property">length</span> ? tabs[<span class="number">0</span>].<span class="property">id</span>: <span class="literal">null</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="string">&#x27;#changeBower&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">getCurrentTabid</span>(<span class="function">(<span class="params">tabId</span>) =&gt;</span> &#123;</span><br><span class="line">        chrome.<span class="property">pageAction</span>.<span class="title function_">setPopup</span>(&#123;<span class="string">&quot;tabId&quot;</span>:tabId,<span class="string">&quot;popup&quot;</span>:<span class="string">&#x27;popup2.html&#x27;</span>&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>需要特别注意的是，由于单击图标打开popup，焦点离开又立即关闭，所以popup页面的生命周期一般很短，需要长时间运行的代码千万不要写在popup里面。</strong><br><br/><br><strong>在权限上，它和background非常类似，它们之间最大的不同是生命周期的不同，popup中可以直接通过chrome.extension.getBackgroundPage()获取background的window对象。</strong></p><h3 id="injected-script"><a href="#injected-script" class="headerlink" title="injected-script"></a>injected-script</h3><p><code>injected-script</code>是干嘛用的？</p><p><code>content-script</code>在上面我们就说过，他不能从DOM里面调用js或者任何变量，也就是在DOM当中无法通过绑定事件的方式调用<code>content-script</code>中的代码<br>（包括直接写<code>onclick</code>和<code>addEventListener</code>），如果说非要调用插件的扩展API咋整？</p><p>在<code>content-script</code>中通过DOM方式向页面注入<code>injected-script</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向页面注入JS</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">injectCustomJs</span>(<span class="params">jsPath</span>)</span><br><span class="line">&#123;</span><br><span class="line">    jsPath = jsPath || <span class="string">&#x27;js/inject.js&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> temp = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">    temp.<span class="title function_">setAttribute</span>(<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;text/javascript&#x27;</span>);</span><br><span class="line">    <span class="comment">// 获得的地址类似：chrome-extension://ihcokhadfjfchaeagdoclpnjdiokfakg/js/inject.js</span></span><br><span class="line">    temp.<span class="property">src</span> = chrome.<span class="property">extension</span>.<span class="title function_">getURL</span>(jsPath);</span><br><span class="line">    temp.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 放在页面不好看，执行完后移除掉</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当你注入过后你可能会发现 报错了：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Denying</span> load <span class="keyword">of</span> chrome-<span class="attr">extension</span>:<span class="comment">//asdasdadasdasdagfdgnfngnfg/js/inject.js. Resources must be listed in the web_accessible_resources manifest key in order to be loaded by pages outside the extension.</span></span><br></pre></td></tr></table></figure><p>意思就是你想要在web中直接访问插件中的资源的话必须显示声明才行，配置文件中增加如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span></span><br><span class="line">    <span class="attr">&quot;web_accessible_resources&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/inject.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>至于inject-script如何调用content-script中的代码，现在的我也不是太清楚，继续学习把。</p><h3 id="homepage-url"><a href="#homepage-url" class="headerlink" title="homepage_url"></a>homepage_url</h3><p>这东西就是一个免费的广告，在popup当中右键第一项点击过后就可以进入你配置的地址</p><p>在扩展中心里面也可以进入，记住这个是推荐配置的就可以了</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;homepage_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://lihengc.github.io&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Chrome插件 </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chrome插件开发(一)</title>
      <link href="/2019/06/05/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91-%E4%B8%80/"/>
      <url>/2019/06/05/Chrome%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91-%E4%B8%80/</url>
      
        <content type="html"><![CDATA[<h3 id="Chrome扩展-Chrome-Extension-构成"><a href="#Chrome扩展-Chrome-Extension-构成" class="headerlink" title="Chrome扩展(Chrome Extension)构成"></a>Chrome扩展(Chrome Extension)构成</h3><p>Chrome插件实际上指的是Chrome扩展。<br><br>Chrome插件是一个用Web技术开发、用来增强浏览器功能的软件，它其实就是一个由HTML、CSS、JS、图片等资源组成的一个.crx后缀的压缩包.<br><br /></p><span id="more"></span><p>当然chrome或者还可以深入更底层配合<code>c++</code>编写的dll动态链接来实现一些更底层的功能，<strong><code>NPAPI</code></strong><br>比如全屏截图，或者打开某项服务等等，在后面的学习过程中我们会逐步完善。<br><br /></p><blockquote><p>由于安全原因，Chrome浏览器42以上版本已经陆续不再支持NPAPI插件，取而代之的是更安全的PPAPI。</p></blockquote><br /><h3 id="manifest-json"><a href="#manifest-json" class="headerlink" title="manifest.json"></a>manifest.json</h3><p>这是一个Chrome插件最重要也是必不可少的文件，用来配置所有和插件相关的配置，必须放在根目录。其中，manifest_version、name、version3个是必不可少的，description和icons是推荐的。</p><p>下面给出的是一些常见的配置项，均有中文注释，完整的配置文档请戳<a href="https://developer.chrome.com/extensions/manifest" title="这里">这里</a>。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 清单文件的版本，这个必须写，而且必须是2</span></span><br><span class="line">    <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 插件的名称</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;demo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 插件的版本</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 插件描述</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;简单的Chrome扩展demo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 图标，一般偷懒全部用一个尺寸的也没问题</span></span><br><span class="line">    <span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;16&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;48&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;128&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 会一直常驻的后台JS或后台页面</span></span><br><span class="line">    <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span></span><br><span class="line">        <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;background.html&quot;</span></span><br><span class="line">        <span class="comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 浏览器右上角图标设置，browser_action、page_action、app必须三选一</span></span><br><span class="line">    <span class="attr">&quot;browser_action&quot;</span><span class="punctuation">:</span> </span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// 图标悬停时的标题，可选</span></span><br><span class="line">        <span class="attr">&quot;default_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;这是一个示例Chrome插件&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 当某些特定页面打开才显示的图标</span></span><br><span class="line">    <span class="comment">/*&quot;page_action&quot;:</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        &quot;default_icon&quot;: &quot;img/icon.png&quot;,</span></span><br><span class="line"><span class="comment">        &quot;default_title&quot;: &quot;我是pageAction&quot;,</span></span><br><span class="line"><span class="comment">        &quot;default_popup&quot;: &quot;popup.html&quot;</span></span><br><span class="line"><span class="comment">    &#125;,*/</span></span><br><span class="line">    <span class="comment">// 需要直接注入页面的JS</span></span><br><span class="line">    <span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> </span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span></span><br><span class="line">            <span class="comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span></span><br><span class="line">            <span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;all_urls&gt;&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// 多个JS按顺序注入</span></span><br><span class="line">            <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/jquery-1.8.3.js&quot;</span><span class="punctuation">,</span> <span class="string">&quot;js/content-script.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span></span><br><span class="line">            <span class="attr">&quot;css&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;css/custom.css&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span></span><br><span class="line">            <span class="attr">&quot;run_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;document_start&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// 这里仅仅是为了演示content-script可以配置多个规则</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;*://*/*.png&quot;</span><span class="punctuation">,</span> <span class="string">&quot;*://*/*.jpg&quot;</span><span class="punctuation">,</span> <span class="string">&quot;*://*/*.gif&quot;</span><span class="punctuation">,</span> <span class="string">&quot;*://*/*.bmp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/show-image-content-size.js&quot;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 权限申请</span></span><br><span class="line">    <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;contextMenus&quot;</span><span class="punctuation">,</span> <span class="comment">// 右键菜单</span></span><br><span class="line">        <span class="string">&quot;tabs&quot;</span><span class="punctuation">,</span> <span class="comment">// 标签</span></span><br><span class="line">        <span class="string">&quot;notifications&quot;</span><span class="punctuation">,</span> <span class="comment">// 通知</span></span><br><span class="line">        <span class="string">&quot;webRequest&quot;</span><span class="punctuation">,</span> <span class="comment">// web请求</span></span><br><span class="line">        <span class="string">&quot;webRequestBlocking&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;storage&quot;</span><span class="punctuation">,</span> <span class="comment">// 插件本地存储</span></span><br><span class="line">        <span class="string">&quot;http://*/*&quot;</span><span class="punctuation">,</span> <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">        <span class="string">&quot;https://*/*&quot;</span> <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span></span><br><span class="line">    <span class="attr">&quot;web_accessible_resources&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/inject.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 插件主页，这个很重要，不要浪费了这个免费广告位</span></span><br><span class="line">    <span class="attr">&quot;homepage_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://www.baidu.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 覆盖浏览器默认页面</span></span><br><span class="line">    <span class="attr">&quot;chrome_url_overrides&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">// 覆盖浏览器默认的新标签页</span></span><br><span class="line">        <span class="attr">&quot;newtab&quot;</span><span class="punctuation">:</span> <span class="string">&quot;newtab.html&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// Chrome40以前的插件配置页写法</span></span><br><span class="line">    <span class="attr">&quot;options_page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;options.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// Chrome40以后的插件配置页写法，如果2个都写，新版Chrome只认后面这一个</span></span><br><span class="line">    <span class="attr">&quot;options_ui&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;options.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// 添加一些默认的样式，推荐使用</span></span><br><span class="line">        <span class="attr">&quot;chrome_style&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span></span><br><span class="line">    <span class="attr">&quot;omnibox&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;keyword&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;go&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 默认语言</span></span><br><span class="line">    <span class="attr">&quot;default_locale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zh_CN&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// devtools页面入口，注意只能指向一个HTML文件，不能是JS文件</span></span><br><span class="line">    <span class="attr">&quot;devtools_page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;devtools.html&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="content-srcipts"><a href="#content-srcipts" class="headerlink" title="content-srcipts"></a>content-srcipts</h4><p>content-srcipts 简单点来说他就是向页面注入脚本的一种方式（其实还可以注入css）。<br><br /></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#manifest.json</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 需要直接注入页面的JS</span></span><br><span class="line">    <span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> </span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="comment">//&quot;matches&quot;: [&quot;http://*/*&quot;, &quot;https://*/*&quot;],</span></span><br><span class="line">            <span class="comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span></span><br><span class="line">            <span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;all_urls&gt;&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// 多个JS按顺序注入</span></span><br><span class="line">            <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/jquery-1.8.3.js&quot;</span><span class="punctuation">,</span> <span class="string">&quot;js/content-script.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span></span><br><span class="line">            <span class="attr">&quot;css&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;css/custom.css&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// 代码注入的时间，可选值： &quot;document_start&quot;, &quot;document_end&quot;, or &quot;document_idle&quot;，最后一个表示页面空闲时，默认document_idle</span></span><br><span class="line">            <span class="attr">&quot;run_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;document_start&quot;</span></span><br><span class="line">            <span class="comment">//需要注意的是当为&quot;document_idle&quot;时 下面js并不会执行，因为不满足</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">#js/content-srcipts</span><br><span class="line">document.addEventListener(&#x27;DOMContentLoaded&#x27;<span class="punctuation">,</span> function()</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    console.log(&#x27;我被执行了！&#x27;);</span><br><span class="line"><span class="punctuation">&#125;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>content-srcipts和页面共享DOM，但是不共享js，假如想要访问页面上某个<code>js</code>变量，不好意思，可能就要复杂一点，当然习惯就无所谓了，可以通过<code>injected js</code>，不懂别慌，下面会讲。<br><br />还有更重要的一点，content-scripts不能访问<code>chrome.xxx.xxx</code>，除了这四种：</p><blockquote><ul><li>chrome.extension(getURL , inIncognitoContext , lastError , onRequest , sendRequest)</li><li>chrome.i18n</li><li>chrome.runtime(connect , getManifest , getURL , id , onConnect , onMessage , sendMessage)</li><li>chrome.storage</li></ul></blockquote><p>如果说你还是觉得api不够用的话，那么你可以选择通过通信的方式让<code>background</code>（容器）它来帮你调用，通信我们后话讲。</p><h4 id="background-后台，容器"><a href="#background-后台，容器" class="headerlink" title="background(后台，容器)"></a>background(后台，容器)</h4><p>background,容器顾名思义，就是装东西的嘛，生命周期就是你浏览器的生命周期，你关闭浏览器，它就结束，通常把一些一直运行的、监听和全局代码放到容器里面（当然你可以敞开发挥你的脑洞）<br><br /></p><blockquote><p>background的权限很高基本上可以调用全部的chrome的api(除了devtools)，并且本地文件可以无限制跨域，不需要设置cors</p></blockquote><p>配置中，background可以通过page指定一张网页，也可以通过scripts直接指定一个JS，Chrome会自动为这个JS生成一个默认的网页：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 会一直常驻的后台JS或后台页面</span></span><br><span class="line">    <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span></span><br><span class="line">        <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;background.html&quot;</span></span><br><span class="line">        <span class="comment">//&quot;scripts&quot;: [&quot;js/background.js&quot;]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>需要特别说明的是，虽然你可以通过chrome-extension:&#x2F;&#x2F;xxx&#x2F;background.html直接打开后台页，但是你打开的后台页和真正一直在后台运行的那个页面不是同一个，换句话说，你可以打开无数个background.html，但是真正在后台常驻的只有一个，而且这个你永远看不到它的界面，只能调试它的代码。</p><p>在background当中还有一个<code>event-pages</code>,它是干嘛的？<br><br /><br>鉴于background生命周期太长，长时间挂载后台可能会影响性能，所以Google又弄一个event-pages，在配置文件上，<br><br /><br>它与background的唯一区别就是多了一个<code>persistent</code>参数：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;event-page.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>它的生命周期是：在被需要时加载，在空闲时被关闭，什么叫被需要时呢？比如第一次安装、插件更新、有content-script向它发送消息，等等。<br><br /><br>除了配置文件的变化，代码上也有一些细微变化，个人这个简单了解一下就行了，一般情况下background也不会很消耗性能的。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Chrome插件 </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>理解高内聚低耦合</title>
      <link href="/2019/06/04/%E7%90%86%E8%A7%A3%E9%AB%98%E5%86%85%E8%81%9A%E4%BD%8E%E8%80%A6%E5%90%88/"/>
      <url>/2019/06/04/%E7%90%86%E8%A7%A3%E9%AB%98%E5%86%85%E8%81%9A%E4%BD%8E%E8%80%A6%E5%90%88/</url>
      
        <content type="html"><![CDATA[<h4 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h4><p> 模块独立性指每个模块只完成系统要求的独立子功能，并且与其他模块的联系最少且接口简单，两个定性的度量标准――耦合性和内聚性。</p><span id="more"></span><h4 id="2、耦合性"><a href="#2、耦合性" class="headerlink" title="2、耦合性"></a>2、耦合性</h4><ol><li>定义<blockquote><p>耦合性也称块间联系。指软件系统结构中各模块间相互联系紧密程度的一种度量。模块之间联系越紧密，其耦合性就越强，模块的独立性则越差。模块间耦合高低取决于模块间接口的复杂性、调用的方式及传递的信息。</p></blockquote></li><li>分类<blockquote><p>耦合性分类(低――高): 无直接耦合;数据耦合;标记耦合;控制耦合;公共耦合;内容耦合;</p></blockquote></li><li>详解</li></ol><ul><li>无直接耦合:</li><li>数据耦合: 指两个模块之间有调用关系，传递的是简单的数据值，相当于高级语言的值传递;</li><li>标记耦合: 指两个模块之间传递的是数据结构，如高级语言中的数组名、记录名、文件名等这些名字即标记，其实传递的是这个数据结构的地址;</li><li>控制耦合: 指一个模块调用另一个模块时，传递的是控制变量（如开关、标志等），被调模块通过该控制变量的值有选择地执行块内某一功能;</li><li>公共耦合: 指通过一个公共数据环境相互作用的那些模块间的耦合。公共耦合的复杂程序随耦合模块的个数增加而增加。</li><li>内容耦合: 这是最高程度的耦合，也是最差的耦合。当一个模块直接使用另一个模块的内部数据，或通过非正常入口而转入另一个模块内部。</li></ul><h4 id="3、内聚性"><a href="#3、内聚性" class="headerlink" title="3、内聚性"></a>3、内聚性</h4><ol><li>定义<blockquote><p>内聚性又称块内联系。指模块的功能强度的度量，即一个模块内部各个元素彼此结合的紧密程度的度量。若一个模块内各元素（语名之间、程序段之间）联系的越紧密，则它的内聚性就越高。</p></blockquote></li><li>分类<blockquote><p>内聚性分类(低――高): 偶然内聚;逻辑内聚;时间内聚;通信内聚;顺序内聚;功能内聚; </p></blockquote></li><li>详解</li></ol><ul><li>偶然内聚: 指一个模块内的各处理元素之间没有任何联系。</li><li>逻辑内聚: 指模块内执行几个逻辑上相似的功能，通过参数确定该模块完成哪一个功能。</li><li>时间内聚: 把需要同时执行的动作组合在一起形成的模块为时间内聚模块。</li><li>通信内聚: 指模块内所有处理元素都在同一个数据结构上操作（有时称之为信息内聚），或者指各处理使用相同的输入数据或者产生相同的输出数据。</li><li>顺序内聚: 指一个模块中各个处理元素都密切相关于同一功能且必须顺序执行，前一功能元素输出就是下一功能元素的输入。</li><li>功能内聚: 这是最强的内聚，指模块内所有元素共同完成一个功能，缺一不可。与其他模块的耦合是最弱的。</li></ul><h4 id="4、要求"><a href="#4、要求" class="headerlink" title="4、要求"></a>4、要求</h4><blockquote><p>耦合性与内聚性是模块独立性的两个定性标准，将软件系统划分模块时，尽量做到高内聚低耦合，提高模块的独立性，为设计高质量的软件结构奠定基础。</p></blockquote><h4 id="5、示例"><a href="#5、示例" class="headerlink" title="5、示例"></a>5、示例</h4><blockquote><p>  有个例子很容易明白：一个程序有50个函数，这个程序执行得非常好；然而一旦你修改其中一个函数，其他49个函数都需要做修改，这就是高耦合的后果。一旦你理解了它，你编写概要设计的时候设计类或者模块自然会考虑到“高内聚，低耦合”。<br><br />分层扩展，继承和多态，就是保证高内聚低耦合的一种设计手段。</p></blockquote><h4 id="6-原文"><a href="#6-原文" class="headerlink" title="6.原文"></a>6.原文</h4><blockquote><p>本问大部分来自于 <a href="http://www.cnblogs.com/robnetcn/archive/2012/04/15/2449008.html" title="co">robnetcn</a></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> 架构 </tag>
            
            <tag> 设计 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP开发当中的一些优化建议</title>
      <link href="/2019/06/04/PHP%E5%BC%80%E5%8F%91%E5%BD%93%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE/"/>
      <url>/2019/06/04/PHP%E5%BC%80%E5%8F%91%E5%BD%93%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<ol><li><code>echo</code> 比 <code>print</code> 快。 </li><li>尽量避免使用<code>__get</code>，<code>__set</code>，<code>__autoload</code>。</li><li><code>$row[‘id’]</code>的效率是<code>$row[id]</code>的7倍。</li></ol><span id="more"></span><ol start="4"><li>尽量采用大量的PHP内置函数。 </li><li><code>str_replace</code>函数比<code>preg_replace</code>函数快，但<code>strtr</code>函数的效率是<code>str_replace</code>函数的四倍。 </li><li>如果一个方法可静态化，就对它做静态声明。速率可提升至4倍。</li><li>mod_zip可作为Apache模块，用来即时压缩你的数据，并可让数据传输量降低80%。 </li><li>使用echo的多重参数（译注：指用逗号而不是句点）代替字符串连接。 </li><li>用@屏蔽错误消息的做法非常低效。 </li><li>在执行for循环之前确定最大循环数，不要每循环一次都计算最大值。 </li><li>注销那些不用的变量尤其是大数组，以便释放内存。 </li><li><code>require_once()</code>代价昂贵。 </li><li>在包含文件时使用完整路径，解析操作系统路径所需的时间会更少。 </li><li>如果你想知道脚本开始执行（译注：即服务器端收到客户端请求）的时刻，使用<code>$_SERVER[‘REQUEST_TIME’]</code>要好于<code>time()</code>。 </li><li>函数代替正则表达式完成相同功能。 </li><li>如果一个字符串替换函数，可接受数组或字符作为参数，并且参数长度不太长，那么可以考虑额外写一段替换代码，17、使得每次传递参数是一个字符，而不是只写一行代码接受数组作为查询和替换的参数。 </li><li>使用选择分支语句（译注：即<code>switch case</code>）好于使用多个<code>if</code>，<code>else if</code>语句。 </li><li>打开apache的mod_deflate模块。 </li><li>数据库连接当使用完毕时应关掉。 </li><li>错误消息代价昂贵。 </li><li>尽量不要在for循环中使用函数，比如<code>for ($x=0; $x &lt; count($array); $x)</code>每循环一次都会调用count()函数。 </li><li>在方法中递增局部变量，速度是最快的。几乎与在函数中调用局部变量的速度相当。 </li><li>递增一个全局变量要比递增一个局部变量慢2倍。 </li><li>递增一个对象属性（如：<code>$this-&gt;prop++</code>）要比递增一个局部变量慢3倍。 </li><li>递增一个未预定义的局部变量要比递增一个预定义的局部变量慢9至10倍。 </li><li>仅定义一个局部变量而没在函数中调用它，同样会减慢速度（其程度相当于递增一个局部变量）。PHP大概会检查看是否存在全局变量。 </li><li>方法调用看来与类中定义的方法的数量无关，因为我（在测试方法之前和之后都）添加了10个方法，但性能上没有变化。 </li><li>派生类中的方法运行起来要快于在基类中定义的同样的方法。 </li><li>调用带有一个参数的空函数，其花费的时间相当于执行7至8次的局部变量递增操作。类似的方法调用所花费的时间接近于15次的局部变量递增操作。 </li><li>用单引号代替双引号来包含字符串，这样做会更快一些。因为PHP会在双引号包围的字符串中搜寻变量，单引号则不会。当然，只有当你不需要在字符串中包含变量时才可以这么做。 </li><li>输出多个字符串时，用逗号代替句点来分隔字符串，速度更快。注意：只有echo能这么做，它是一种可以把多个字符串当作参数的“函数”（译注：PHP手册中说echo是语言结构，不是真正的函数，故把函数加上了双引号）。 </li><li>Apache解析一个PHP脚本的时间要比解析一个静态HTML页面慢2至10倍。尽量多用静态HTML页面，少用脚本。除非脚本可以缓存，否则每次调用时都会重新编译一次。引入一套PHP缓存机制通常可以提升25%至100%的性能，以免除编译开销。 </li><li>尽量做缓存，可使用memcached。memcached是一款高性能的内存对象缓存系统，可用来加速动态Web应用程序，减轻数据库负载。对运算码 (OP code)的缓存很有用，使得脚本不必为每个请求做重新编译。 </li><li>当操作字符串并需要检验其长度是否满足某种要求时，你想当然地会使用<code>strlen()</code>函数。此函数执行起来相当快，因为它不做任何计算，只返回在zval 结构（C的内置数据结构，用于存储PHP变量）中存储的已知字符串长度。但是，由35、于<code>strlen()</code>是函数，多多少少会有些慢，因为函数调用会经过诸多步骤，如字母小写化（译注：指函数名小写化，PHP不区分函数名大小写）、哈希查找，会跟随被调用的函数一起执行。在某些情况下，你可以使用<code>isset()</code> 技巧加速执行你的代码。（举例如下）<code>if (strlen($foo) &lt; 5) { echo “Foo is too short”; }</code>（与下面的技巧做比较）<code>if (!isset($foo)){ echo “Foo is too short”; }</code>调用<code>isset()</code>恰巧比<code>strlen()</code>快，因为与后者不同的是，<code>isset()</code>作为一种语言结构，意味着它的执行不需要函数查找和字母小写化。也就是说，实际上在检验字符串长度的顶层代码中你没有花太多开销。 </li><li>当执行变量$i的递增或递减时，<code>$i++</code>会比<code>++$i</code>慢一些。这种差异是PHP特有的，并不适用于其他语言，所以请不要修改你的C或Java代码并指望它们能立即变快，没用的。<code>++$i</code>更快是因为它只需要3条指令(opcodes)，$i++则需要4条指令。后置递增实际上会产生一个临时变量，这个临时变量随后被递增。而前置递增直接在原值上递增。这是最优化处理的一种，正如Zend的PHP优化器所作的那样。牢记这个优化处理不失为一个好主意，因为并不是所有的指令优化器都会做同样的优化处理，并且存在大量没有装配指令优化器的互联网服务提供商（ISPs）和服务器。 </li><li>并不是事必面向对象(OOP)，面向对象往往开销很大，每个方法和对象调用都会消耗很多内存。并非要用类实现所有的数据结构，数组也很有用。 </li><li>不要把方法细分得过多，仔细想想你真正打算重用的是哪些代码？当你需要时，你总能把代码分解成方法。 </li><li>如果在代码中存在大量耗时的函数，你可以考虑用C扩展的方式实现它们。 </li><li>评估检验(profile)你的代码。检验器会告诉你，代码的哪些部分消耗了多少时间。Xdebug调试器包含了检验程序，评估检验总体上可以显示出代码的瓶颈。</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Base64编码简单认识</title>
      <link href="/2019/06/03/Base64%E7%BC%96%E7%A0%81%E8%AE%A4%E8%AF%86/"/>
      <url>/2019/06/03/Base64%E7%BC%96%E7%A0%81%E8%AE%A4%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<h3 id="Base64是一种用64个字符来表示任意二进制数据的方法。"><a href="#Base64是一种用64个字符来表示任意二进制数据的方法。" class="headerlink" title="Base64是一种用64个字符来表示任意二进制数据的方法。"></a>Base64是一种用64个字符来表示任意二进制数据的方法。</h3><ul><li><p>用记事本打开exe、jpg、pdf这些文件时，我们都会看到一大堆乱码，因为二进制文件包含很多无法显示和打印的字符，所以，如果要让记事本这样的文本处理软件能处理二进制数据，就需要一个二进制到字符串的转换方法。</p></li><li><p>系统之间的报文交互都需要使用Base64对明文进行转码，然后再进行签名或加密，之后再进行（或再次Base64）传输。</p></li></ul><span id="more"></span><ul><li>在参数传递的过程当中，会出现中文乱码的情况，于此类似的还有很多，所以说网络上传输的字符并不全是可打印的字符，列如，图片，二进制文件等等。Base64的出现就是为了解决此问题，它是基于64个可打印的字符来表示二进制的数据的一种方法。</li><li>电子邮件刚问世的时候，只能传输英文，但后来随着用户的增加，中文、日文等文字的用户也有需求，但这些字符并不能被服务器或网关有效处理，因此Base64就登场了。随之，Base64在URL、Cookie、网页传输少量二进制文件中也有相应的使用。</li></ul><h4 id="Base64原理"><a href="#Base64原理" class="headerlink" title="Base64原理"></a>Base64原理</h4><blockquote><p>首先准备一个数组</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, ... <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, ... <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, ... <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;/&#x27;</span>]</span><br></pre></td></tr></table></figure><p>上面就是Base64的索引表，字符选用了”A-Z、a-z、0-9、+、&#x2F;“ 64个可打印字符，这是标准的Base64协议规定。在日常使用中我们还会看到“&#x3D;”或“&#x3D;&#x3D;”号出现在Base64的编码结果中，“&#x3D;”在此是作为填充字符出现。</p><h5 id="具体转换步骤"><a href="#具体转换步骤" class="headerlink" title="具体转换步骤"></a>具体转换步骤</h5><ul><li><p>第一步，将待转换的字符串每三个字节分为一组，每个字节占8bit，那么共有24个二进制位。</p></li><li><p>第二步，将上面的24个二进制位每6个一组，共分为4组</p></li><li><p>第三步，在每组前面添加两个0，每组由6个变为8个二进制位，总共32个二进制位，即四个字节。</p></li><li><p>第四步，根据Base64编码对照表（见下图）获得对应的值。</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>　A　　<span class="number">17</span>　R　　　<span class="number">34</span>　i　　　<span class="number">51</span>　z</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>　B　　<span class="number">18</span>　S　　　<span class="number">35</span>　j　　　<span class="number">52</span>　<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>　C　　<span class="number">19</span>　T　　　<span class="number">36</span>　k　　　<span class="number">53</span>　<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>　D　　<span class="number">20</span>　U　　　<span class="number">37</span>　l　　　<span class="number">54</span>　<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>　E　　<span class="number">21</span>　V　　　<span class="number">38</span>　m　　　<span class="number">55</span>　<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>　F　　<span class="number">22</span>　W　　　<span class="number">39</span>　n　　　<span class="number">56</span>　<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="number">6</span>　G　　<span class="number">23</span>　X　　　<span class="number">40</span>　o　　　<span class="number">57</span>　<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="number">7</span>　H　　<span class="number">24</span>　Y　　　<span class="number">41</span>　p　　　<span class="number">58</span>　<span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="number">8</span>　I　　<span class="number">25</span>　Z　　　<span class="number">42</span>　q　　　<span class="number">59</span>　<span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="number">9</span>　J　　<span class="number">26</span>　a　　　<span class="number">43</span>　r　　　<span class="number">60</span>　<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="number">10</span>　K　　<span class="number">27</span>　b　　　<span class="number">44</span>　s　　　<span class="number">61</span>　<span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="number">11</span>　L　　<span class="number">28</span>　c　　　<span class="number">45</span>　t　　　<span class="number">62</span>　+</span><br><span class="line"></span><br><span class="line"><span class="number">12</span>　M　　<span class="number">29</span>　d　　　<span class="number">46</span>　u　　　<span class="number">63</span>　/</span><br><span class="line"></span><br><span class="line"><span class="number">13</span>　N　　<span class="number">30</span>　e　　　<span class="number">47</span>　v</span><br><span class="line"></span><br><span class="line"><span class="number">14</span>　O　　<span class="number">31</span>　f　　　<span class="number">48</span>　w　　　</span><br><span class="line"></span><br><span class="line"><span class="number">15</span>　P　　<span class="number">32</span>　g　　　<span class="number">49</span>　x</span><br><span class="line"></span><br><span class="line"><span class="number">16</span>　Q　　<span class="number">33</span>　h　　　<span class="number">50</span>　y</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>从上面的步骤我们发现：</p></blockquote><ul><li>Base64字符表中的字符原本用6个bit就可以表示，现在前面添加2个0，变为8个bit，会造成一定的浪费。因此，Base64编码之后的文本，要比原文大约三分之一。</li><li>为什么使用3个字节一组呢？因为6和8的最小公倍数为24，三个字节正好24个二进制位，每6个bit位一组，恰好能够分为4组。</li></ul><h5 id="可以参照这个图："><a href="#可以参照这个图：" class="headerlink" title="可以参照这个图："></a>可以参照这个图：</h5><p><img src="https://img-blog.csdnimg.cn/20190517212249969.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9oZWxsby5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="参照图" title="参照图"></p><ul><li>第一步：“M”、“a”、”n”对应的ASCII码值分别为77，97，110，对应的二进制值是01001101、01100001、01101110。如图第二三行所示，由此组成一个24位的二进制字符串。</li><li>第二步：如图红色框，将24位每6位二进制位一组分成四组。</li><li>第三步：在上面每一组前面补两个0，扩展成32个二进制位，此时变为四个字节：00010011、00010110、00000101、00101110。分别对应的值（Base64编码索引）为：19、22、5、46。</li><li>第四步：用上面的值在Base64编码表中进行查找，分别对应：T、W、F、u。因此“Man”Base64编码之后就变为：TWFu。</li></ul><h4 id="位数不足情况"><a href="#位数不足情况" class="headerlink" title="位数不足情况"></a>位数不足情况</h4><p><img src="https://img-blog.csdnimg.cn/20190517212307382.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9oZWxsby5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="位数不足解析图" title="位数不足解析图"></p><ul><li><p>两个字节：两个字节共16个二进制位，依旧按照规则进行分组。此时总共16个二进制位，每6个一组，则第三组缺少2位，用0补齐，得到三个Base64编码，第四组完全没有数据则用“&#x3D;”补上。因此，上图中“BC”转换之后为“QKM&#x3D;”；</p></li><li><p>一个字节：一个字节共8个二进制位，依旧按照规则进行分组。此时共8个二进制位，每6个一组，则第二组缺少4位，用0补齐，得到两个Base64编码，而后面两组没有对应数据，都用“&#x3D;”补上。因此，上图中“A”转换之后为“QQ&#x3D;&#x3D;”；</p></li></ul><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>大多数编码都是由字符串转化成二进制的过程，而Base64的编码则是从二进制转换为字符串。与常规恰恰相反，</li><li>Base64编码主要用在传输、存储、表示二进制领域，不能算得上加密，只是无法直接看到明文。也可以通过打乱Base64编码来进行加密。</li><li>中文有多种编码（比如：utf-8、gb2312、gbk等），不同编码对应Base64编码结果都不一样。</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> 编码 </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3.6浅谈携程异步IO</title>
      <link href="/2019/05/28/3-6%E5%8D%8F%E7%A8%8B%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/"/>
      <url>/2019/05/28/3-6%E5%8D%8F%E7%A8%8B%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA/</url>
      
        <content type="html"><![CDATA[<h2 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h2><h6 id="协程，又称微线程，纤程。英文名Coroutine。"><a href="#协程，又称微线程，纤程。英文名Coroutine。" class="headerlink" title="协程，又称微线程，纤程。英文名Coroutine。"></a>协程，又称微线程，纤程。英文名Coroutine。</h6><ol><li>子程序，或者称为函数，在所有语言中都是层级调用，比如A调用B，B在执行过程中又调用了C，C执行完毕返回，B执行完毕返回，最后是A执行完毕。</li><li>所以子程序调用是通过栈实现的，一个线程就是执行一个子程序。</li></ol><span id="more"></span><ol start="3"><li>子程序调用总是一个入口，一次返回，调用顺序是明确的。而协程的调用和子程序不同。</li><li>协程看上去也是子程序，但执行过程中，在子程序内部可中断，然后转而执行别的子程序，在适当的时候再返回来接着执行。</li><li>注意，在一个子程序中中断，去执行其他子程序，不是函数调用，有点类似CPU的中断。比如子程序A、B：</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">A</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">B</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;z&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>假设由协程执行，在执行A的过程中，可以随时中断，去执行B，B也可能在执行过程中中断再去执行A，结果可能是：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">x</span><br><span class="line">y</span><br><span class="line"><span class="number">3</span></span><br><span class="line">z</span><br></pre></td></tr></table></figure><p>但是在A中是没有调用B的，所以协程的调用比函数调用理解起来要难一些。</p><p>看起来A、B的执行有点像多线程，但协程的特点在于是一个线程执行，那和多线程比，协程有何优势？</p><p>最大的优势就是协程极高的执行效率。因为子程序切换不是线程切换，而是由程序自身控制，因此，没有线程切换的开销，和多线程比，线程数量越多，协程的性能优势就越明显。</p><p>第二大优势就是不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。</p><p>因为协程是一个线程执行，那怎么利用多核CPU呢？最简单的方法是多进程+协程，既充分利用多核，又充分发挥协程的高效率，可获得极高的性能。</p><p>Python对协程的支持是通过generator实现的。</p><p>在generator中，我们不但可以通过<code>for</code>循环来迭代，还可以不断调用<code>next()</code>函数获取由<code>yield</code>语句返回的下一个值。</p><p>但是Python的<code>yield</code>不但可以返回一个值，它还可以接收调用者发出的参数。</p><p>来看例子：</p><p>传统的生产者-消费者模型是一个线程写消息，一个线程取消息，通过锁机制控制队列和等待，但一不小心就可能死锁。</p><p>如果改用协程，生产者生产消息后，直接通过<code>yield</code>跳转到消费者开始执行，待消费者执行完毕后，切换回生产者继续生产，效率极高：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">consumer</span>():</span><br><span class="line">    r = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        n = <span class="keyword">yield</span> r</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> n:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[CONSUMER] Consuming %s...&#x27;</span> % n)</span><br><span class="line">        r = <span class="string">&#x27;200 OK&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">produce</span>(<span class="params">c</span>):</span><br><span class="line">    c.send(<span class="literal">None</span>)</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> n &lt; <span class="number">5</span>:</span><br><span class="line">        n = n + <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[PRODUCER] Producing %s...&#x27;</span> % n)</span><br><span class="line">        r = c.send(n)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[PRODUCER] Consumer return: %s&#x27;</span> % r)</span><br><span class="line">    c.close()</span><br><span class="line"></span><br><span class="line">c = consumer()</span><br><span class="line">produce(c)</span><br></pre></td></tr></table></figure><blockquote><p>执行结果：</p></blockquote><pre><code>[PRODUCER] Producing 1...[CONSUMER] Consuming 1...[PRODUCER] Consumer return: 200 OK[PRODUCER] Producing 2...[CONSUMER] Consuming 2...[PRODUCER] Consumer return: 200 OK[PRODUCER] Producing 3...[CONSUMER] Consuming 3...[PRODUCER] Consumer return: 200 OK[PRODUCER] Producing 4...[CONSUMER] Consuming 4...[PRODUCER] Consumer return: 200 OK[PRODUCER] Producing 5...[CONSUMER] Consuming 5...[PRODUCER] Consumer return: 200 OK</code></pre><p>注意到<code>consumer</code>函数是一个<code>generator</code>，把一个<code>consumer</code>传入<code>produce</code>后：</p><ol><li><p>首先调用<code>c.send(None)</code>启动生成器；</p></li><li><p>然后，一旦生产了东西，通过<code>c.send(n)</code>切换到<code>consumer</code>执行；</p></li><li><p><code>consumer</code>通过<code>yield</code>拿到消息，处理，又通过<code>yield</code>把结果传回；</p></li><li><p><code>produce</code>拿到<code>consumer</code>处理的结果，继续生产下一条消息；</p></li><li><p><code>produce</code>决定不生产了，通过<code>c.close()</code>关闭<code>consumer</code>，整个过程结束。</p></li></ol><p>整个流程无锁，由一个线程执行，<code>produce</code>和<code>consumer</code>协作完成任务，所以称为“协程”，而非线程的抢占式多任务。</p><h5 id="asyncio是Python-3-4版本引入的标准库，直接内置了对异步IO的支持。"><a href="#asyncio是Python-3-4版本引入的标准库，直接内置了对异步IO的支持。" class="headerlink" title="asyncio是Python 3.4版本引入的标准库，直接内置了对异步IO的支持。"></a>asyncio是Python 3.4版本引入的标准库，直接内置了对异步IO的支持。</h5><p><code>asyncio</code>的编程模型就是一个消息循环。我们从<code>asyncio</code>模块中直接获取一个<code>EventLoop</code>的引用，然后把需要执行的协程扔到<code>EventLoop</code>中执行，就实现了异步IO。</p><blockquote><p>简单示列如下</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Hello world! (%s)&#x27;</span> % threading.currentThread())</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Hello again! (%s)&#x27;</span> % threading.currentThread())</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">tasks = [hello(), hello()]</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line">loop.close()</span><br></pre></td></tr></table></figure><p><code>@asyncio.coroutine</code>把一个<code>generator</code>标记为<code>coroutine</code>类型，然后，我们就把这个<code>coroutine</code>扔到<code>EventLoop</code>中执行。<br><code>coroutine</code>方法体里面也只能存在<code>coroutine</code>方法，否则就会等待执行，所以这里直接中断并执行下一个消息循环。<br><code>yield from</code>语法可以让我们方便地调用另一个<code>generator</code>。<br>当<code>asyncio.sleep()</code>返回时，线程就可以从<code>yield from</code>拿到返回值（此处是None），然后接着执行下一行语句。<br>把<code>asyncio.sleep(1)</code>看成是一个耗时1秒的IO操作，在此期间，主线程并未等待，而是去执行<code>EventLoop</code>中其他可以执行的<code>coroutine</code>了。<br>异步操作需要在<code>coroutine</code>中通过<code>yield from</code>完成。<br>多个<code>coroutine</code>可以封装成一组<code>Task</code>然后并发执行。</p><h5 id="从Python-3-5开始引入了新的语法async和await，可以让coroutine的代码更简洁易读"><a href="#从Python-3-5开始引入了新的语法async和await，可以让coroutine的代码更简洁易读" class="headerlink" title="从Python 3.5开始引入了新的语法async和await，可以让coroutine的代码更简洁易读"></a>从Python 3.5开始引入了新的语法async和await，可以让coroutine的代码更简洁易读</h5><ol><li>把<code>@asyncio.coroutine</code>替换为&#96;async；</li><li>把<code>yield from</code>替换为<code>await</code></li></ol><blockquote><p>新语法如下 其他代码不变</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello world!&quot;</span>)</span><br><span class="line">    r = <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello again!&quot;</span>)</span><br></pre></td></tr></table></figure><hr><p><a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017959540289152" title="该文部分引用廖雪峰官网">该文部分引用廖雪峰官网</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> python3 </tag>
            
            <tag> 异步IO </tag>
            
            <tag> 携程 </tag>
            
            <tag> asyncio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS获取URL参数</title>
      <link href="/2019/05/22/JS%E8%8E%B7%E5%8F%96URL%E5%8F%82%E6%95%B0/"/>
      <url>/2019/05/22/JS%E8%8E%B7%E5%8F%96URL%E5%8F%82%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>目前没发现兼容情况</p></blockquote><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function getQueryVariable(variable)</span><br><span class="line">&#123;</span><br><span class="line">    var query = window.location.search.substring(1);</span><br><span class="line">    var vars = query.split(&quot;&amp;&quot;);</span><br><span class="line">    for (var i=0;i&lt;vars.length;i++) &#123;</span><br><span class="line">        var pair = vars[i].split(&quot;=&quot;);</span><br><span class="line">        if(pair[0] == variable)&#123;return pair[1];&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return(false);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> JS </tag>
            
            <tag> ES </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>致歉申明之前文章丢失</title>
      <link href="/2019/05/22/%E8%87%B4%E6%AD%89%E7%94%B3%E6%98%8E%E4%B9%8B%E5%89%8D%E6%96%87%E7%AB%A0%E4%B8%A2%E5%A4%B1/"/>
      <url>/2019/05/22/%E8%87%B4%E6%AD%89%E7%94%B3%E6%98%8E%E4%B9%8B%E5%89%8D%E6%96%87%E7%AB%A0%E4%B8%A2%E5%A4%B1/</url>
      
        <content type="html"><![CDATA[<h2 id="非常抱歉"><a href="#非常抱歉" class="headerlink" title="非常抱歉"></a>非常抱歉</h2><blockquote><p>因为之前电脑之前硬盘顺坏，没有备份，hexo很难剥离出静态页面，所以也就干脆放弃剥离了，现在这个博客会保持更新，~~ sigeyi</p></blockquote><p> <img src="/img/46ea4b66ccd13cbcfe75604985479e8d.jpg" alt="12312"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
            <tag> 申明 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
