<!-- @format -->



<!DOCTYPE html>
<html lang="en">
<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <!--360 使用 Google Chrome Frame-->
  <meta name="renderer" content="webkit">
  <!--百度禁止转码-->
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <!--Description-->
  
  <meta name="description" content="thinkphp调用sqlserver储存过程返回多个结果集，thinkphp调用sqlsrv多数据库增删改查">
  
  <meta name="google-site-verification" content="J4gssmXGNI9-DfJ9w52mL5KFPlRCYvySveEN0RJFZHU" />
  <!--Author-->
  
  <meta name="author" content="李恒">
  
  <!--Open Graph Title-->
  <meta property="og:title" content="thinkphp调用sqlserver储存过程返回多个结果集" />
  <!--Open Graph Description-->
  <meta property="og:description" content="thinkphp调用sqlserver储存过程返回多个结果集，thinkphp调用sqlsrv多数据库增删改查" />
  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="Harthali" />
  <!--Type page-->
  
  <meta property="og:type" content="article" />
  
  <!--Page Cover-->
  
  <meta property="og:image" content="/null" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- Title -->
  
  <title>thinkphp调用sqlserver储存过程返回多个结果集 - Harthali</title>
  <!-- 添加到主屏后的标题（iOS 6 新增） -->
  <meta name="apple-mobile-web-app-title" content="Harthali">
  <!-- 是否启用 WebApp 全屏模式 -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <link rel="apple-touch-startup-image" href="/assets/ splash-assets.png" media="(max-device-width: 700px)">
  <!-- 禁止数字识自动别为电话号码 -->
  <meta name="format-detection" content="telephone=no" />
  <link rel="shortcut icon" href="/null">
  <!--Apple iOS Safari ICON-->
  <link rel="apple-touch-icon" sizes="57x57" href="" />
  <link rel="apple-touch-icon" sizes="72x72" href="" />
  <link rel="apple-touch-icon" sizes="114x114" href="" />
  <link rel="apple-touch-icon" sizes="144x144" href="" />
  <!-- 添加 RSS 订阅 -->
  <link rel="alternate" type="application/rss+xml" title="Harthali" href="/atom.xml" />
  <!-- uc强制竖屏 -->
  <meta name="screen-orientation" content="portrait">
  <!-- QQ强制竖屏 -->
  <meta name="x5-orientation" content="portrait">
  <!-- UC强制全屏 -->
  <meta name="full-screen" content="yes">
  <!-- QQ强制全屏 -->
  <meta name="x5-fullscreen" content="true">
  <!-- UC应用模式 -->
  <meta name="browsermode" content="application">
  <!-- QQ应用模式 -->
  <meta name="x5-page-mode" content="app">
  <!-- https://material.io/resources/icons/?style=outline -->
  
  <script src="https://lf1-cdn-tos.bytegoofy.com/obj/iconpark/icons_20213_18.4a5f87dae8e6f9e336b9ad6fa00f8e8f.js"></script>
  
  
<style>
  .itp-gallery-title,
  .itp-gallery-subtitle,
  .itp-post-title,
  .itp-post-entry-title,
  .itp-post-entry-subtitle,
  .itp-mag-logo,
  .itp-index-title,
  .itp-post-entry-moment,
  .itp-header-actions-menu {
    font-family: ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans,Ubuntu,Cantarell,Helvetica Neue,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans,Ubuntu,Cantarell,Helvetica Neue,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;
  }

  .itp-header-title,
  .itp-m3-post-entry-info .title,
  .itp-header-actions,
  .itp-cover-title,
  .itp-cover-subtitle,
  .itp-post-subtitle,
  .itp-post-entry-title,
  .itp-m3-cover-subtitle,
  .itp-m3-cover-title,
  .itp-gallery-info .title,
  .footer-info {
    font-family: ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans,Ubuntu,Cantarell,Helvetica Neue,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Noto Sans,Ubuntu,Cantarell,Helvetica Neue,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;
  }

  .article,
  .itp-post-entry-excerpt {
    font-family: 'SF UI Display', '.PingFang SC', 'PingFang SC', 'Neue Haas Grotesk Text Pro', 'Arial Nova', 'Segoe UI', 'Microsoft YaHei', 'Microsoft JhengHei', 'Helvetica Neue', 'Source Han Sans SC', 'Noto Sans CJK SC', 'Source Han Sans CN', 'Noto Sans SC', 'Source Han Sans TC', 'Noto Sans CJK TC', 'Helvetica', 'Hiragino Sans GB', sans-serif;
  }
</style>

  <!-- Custom CSS/Sass -->
  
<link rel="stylesheet" href="/css/style.css">

  <!--样式切换-->
  
  
<link rel="stylesheet" href="/css/material3.css">

  
  
  
  
  <!--highlight.js CSS-->
  
  
<link rel="stylesheet" href="/css/highlight/github.css">

  
  
  <!-- jquery -->
  
  <script src="/js/jquery.min.js"></script>
  
  <!--Comment-->
  
  <!--Waline-->
  <script src="/js/waline.js" defer></script>
  <link rel="stylesheet" href="/css/waline.css" />
  
  <!--Vercel Audiences Analytics-->
  
  <!--umami analytics-->
  
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HFH67WJVKQ" defer></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'G-HFH67WJVKQ');
  </script>
  
  
  
  
  
  <!-- Google Search Advanced
  https://developers.google.com/search/docs/advanced/structured-data/search-gallery
  -->
  
  
  
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "headline": "thinkphp调用sqlserver储存过程返回多个结果集",
      "image": "",
      "datePublished": "Mon Jan 06 2020 14:45:44 GMT+0800",
      "author": [{
        "@type": "Person",
        "name": "李恒",
        "url": "https://lihengtt.github.io"
      }]
    }
  </script>
  
  
  
  <!--<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      spacing: {
        '1': '8px',
        '2': '12px',
        '3': '16px',
        '4': '24px',
        '5': '32px',
        '6': '48px',
      },
      container: {
        center: true,
      },
      extend: {
        colors: {
          tblack: '#222831',
        },
        boxShadow: {
          'itp': '1px 10px 30px 0 rgb(0 0 0 / 10%)',
        }
      }
    }
  }
</script>-->

<link rel="stylesheet" href="/css/tailwind.css">

<meta name="generator" content="Hexo 8.1.1"></head>


<!--Other Pages-->


<body>
  <!-- Nav -->
  


<div class="itp-float-bar">
  <!--所有页面都显示-->
  <a class="itp-float-bar-item rounded" href="/" title="Harthali">
    
    <iconpark-icon class="navicon" name="home"></iconpark-icon>
    
  </a>
  
  <!--只在 **文章** 页面显示-->
  <a class="itp-float-bar-item rounded" onclick="scrollto(comment)" title="comment">
    
    <iconpark-icon class="navicon" name="comment"></iconpark-icon>
    
  </a>
  <a class="itp-float-bar-item rounded" id="open_toc" onclick="OpenToc()" title="Table of contents">
    
    <iconpark-icon class="navicon" name="list"></iconpark-icon>
    
  </a>
  <a class="itp-float-bar-item rounded" href="javascript:scroll(0,0)" title="to top">
    
    <iconpark-icon class="navicon" name="top"></iconpark-icon>
    
  </a>
  

  <div class="itp-float-layer itp-toc-layer">
    <div class="clost-btn" style="display: flex;">
      <a class="itp-float-layer-close-btn" id="close_btn">
        <div class="close_btn_red">
        </div>
      </a>
    </div>
    
  </div>
  <div class="itp-float-layer-bg layer-bg-nodisplay" id="close_layer"></div>
</div>


<style>
  .navicon {
    font-size: 18px;
    padding-top: 18px;
    color: var(--main-black);
  }
</style>
  <!-- Main Content -->
  

<section class="pjax-area">
  <div class="content-area post-content-area">
    <div class=" left-area"></div>
    <div class="main-area">
      <div class="itp-m3-card post-cover">
        <div class="itp-m3-card-cover">
          <div class="itp-m3-cover-bg" style="
          background-image: url();
          background-size: cover;
          background-position: center center;
        ">
            <div class="itp-m3-card-cover-layer ">
              <div class="info-area pjax-area">
                <div class="itp-m3-cover-avatar">
                  <img src="https://lihengc.github.io/images/WechatIMG10.jpeg" class="nofancy">
                </div>
                <div class="itp-m3-cover-title" style="opacity: 1;">
                  thinkphp调用sqlserver储存过程返回多个结果集
                </div>
                <div class="itp-m3-cover-subtitle" style="opacity: 0.8;">
                  
2020-01-06
<span> / </span>


<span> / </span>
3.6k
<style>
  .category-link {
    color: var(--main-black);
  }

  @media print {
    .itp-cover-subtitle a {
      color: var(--main-black) !important;
    }
  }

  @media screen {
    .itp-cover-subtitle a {
      color: #fff !important;
    }
  }
</style>

                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article">
          <h3 id="首先安装扩展"><a href="#首先安装扩展" class="headerlink" title="首先安装扩展"></a>首先安装扩展</h3><span id="more"></span>
<h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><p>分为两个步骤</p>
<ol>
<li>找到对应自己PHP版本的pdo扩展，下载解压出来，并且在<code>php.ini</code>里面启用扩展,需要注意的问题是php版本以及是否为安全版本</li>
<li>下载 <code>ODBC Driver</code>  <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/sql/connect/odbc/download-odbc-driver-for-sql-server?view=sql-server-2017,%E8%BF%99%E4%B8%AA%E6%B2%A1%E5%95%A5%E6%B3%A8%E6%84%8F%E7%9A%84%EF%BC%8C%E4%BD%A0%E6%98%AF%E5%95%A5%E7%B3%BB%E7%BB%9F%E5%B0%B1%E4%B8%8B%E8%BD%BD%E5%95%A5%E5%AE%89%E8%A3%85%E5%8C%85%E5%B0%B1%E8%A1%8C">https://docs.microsoft.com/zh-cn/sql/connect/odbc/download-odbc-driver-for-sql-server?view=sql-server-2017,这个没啥注意的，你是啥系统就下载啥安装包就行</a></li>
</ol>
<p>linux 和 windows差不多，安装扩展的话直接可以用pecl</p>
<p>当你成功加载了可以在<code>phpinfo()</code>里面看到，当然了，如果你安装扩展这些都有诸多问题都话，～你可真拉稀。</p>
<hr />

<h3 id="thinkphp操作sqlsrv储存过程"><a href="#thinkphp操作sqlsrv储存过程" class="headerlink" title="thinkphp操作sqlsrv储存过程"></a>thinkphp操作sqlsrv储存过程</h3><blockquote>
<p>我使用的tp版本是5.0和操作多个数据库，希望能对你有所帮助</p>
</blockquote>
<h4 id="配置config文件"><a href="#配置config文件" class="headerlink" title="配置config文件"></a>配置config文件</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 账号数据库</span></span><br><span class="line">   <span class="string">&#x27;UserDBConn&#x27;</span> =&gt;  [</span><br><span class="line">       <span class="string">&#x27;type&#x27;</span>            =&gt; <span class="string">&#x27;sqlsrv&#x27;</span>,</span><br><span class="line">       <span class="comment">// 服务器地址</span></span><br><span class="line">       <span class="string">&#x27;hostname&#x27;</span>        =&gt; <span class="string">&#x27;139.129.1.1&#x27;</span>,</span><br><span class="line">       <span class="comment">// 数据库名</span></span><br><span class="line">       <span class="string">&#x27;database&#x27;</span>        =&gt; <span class="string">&#x27;DB3&#x27;</span>,</span><br><span class="line">       <span class="comment">// 用户名</span></span><br><span class="line">       <span class="string">&#x27;username&#x27;</span>        =&gt; <span class="string">&#x27;xxxx&#x27;</span>,</span><br><span class="line">       <span class="comment">// 密码</span></span><br><span class="line">       <span class="string">&#x27;password&#x27;</span>        =&gt; <span class="string">&#x27;tt123!@#&#x27;</span>,</span><br><span class="line">       <span class="comment">// 端口</span></span><br><span class="line">       <span class="string">&#x27;hostport&#x27;</span>        =&gt; <span class="string">&#x27;5188&#x27;</span></span><br><span class="line">   ],</span><br><span class="line">   <span class="comment">// 金币数据库</span></span><br><span class="line">   <span class="string">&#x27;ScoreDBConn&#x27;</span> =&gt;  [</span><br><span class="line">       <span class="string">&#x27;type&#x27;</span>            =&gt; <span class="string">&#x27;sqlsrv&#x27;</span>,</span><br><span class="line">       <span class="comment">// 服务器地址</span></span><br><span class="line">       <span class="string">&#x27;hostname&#x27;</span>        =&gt; <span class="string">&#x27;139.129.1.1&#x27;</span>,</span><br><span class="line">       <span class="comment">// 数据库名</span></span><br><span class="line">       <span class="string">&#x27;database&#x27;</span>        =&gt; <span class="string">&#x27;DB2&#x27;</span>,</span><br><span class="line">       <span class="comment">// 用户名</span></span><br><span class="line">       <span class="string">&#x27;username&#x27;</span>        =&gt; <span class="string">&#x27;xxxx&#x27;</span>,</span><br><span class="line">       <span class="comment">// 密码</span></span><br><span class="line">       <span class="string">&#x27;password&#x27;</span>        =&gt; <span class="string">&#x27;tt123!@#&#x27;</span>,</span><br><span class="line">       <span class="comment">// 端口</span></span><br><span class="line">       <span class="string">&#x27;hostport&#x27;</span>        =&gt; <span class="string">&#x27;5188&#x27;</span></span><br><span class="line">   ],</span><br><span class="line">   <span class="comment">// 记录数据库</span></span><br><span class="line">   <span class="string">&#x27;RecordDBConn&#x27;</span> =&gt;  [</span><br><span class="line">       <span class="string">&#x27;type&#x27;</span>            =&gt; <span class="string">&#x27;sqlsrv&#x27;</span>,</span><br><span class="line">       <span class="comment">// 服务器地址</span></span><br><span class="line">       <span class="string">&#x27;hostname&#x27;</span>        =&gt; <span class="string">&#x27;139.129.1.1&#x27;</span>,</span><br><span class="line">       <span class="comment">// 数据库名</span></span><br><span class="line">       <span class="string">&#x27;database&#x27;</span>        =&gt; <span class="string">&#x27;DB1&#x27;</span>,</span><br><span class="line">       <span class="comment">// 用户名</span></span><br><span class="line">       <span class="string">&#x27;username&#x27;</span>        =&gt; <span class="string">&#x27;xxxx&#x27;</span>,</span><br><span class="line">       <span class="comment">// 密码</span></span><br><span class="line">       <span class="string">&#x27;password&#x27;</span>        =&gt; <span class="string">&#x27;tt123!@#&#x27;</span>,</span><br><span class="line">       <span class="comment">// 端口</span></span><br><span class="line">       <span class="string">&#x27;hostport&#x27;</span>        =&gt; <span class="string">&#x27;5188&#x27;</span></span><br><span class="line">   ],</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="修改thinkphp-library-think-Model-php"><a href="#修改thinkphp-library-think-Model-php" class="headerlink" title="修改thinkphp&#x2F;library&#x2F;think&#x2F;Model.php"></a>修改thinkphp&#x2F;library&#x2F;think&#x2F;Model.php</h4><p>在末尾追加</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> $DbconnName</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">Dbconn</span>(<span class="params"><span class="variable">$DbconnName</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span>&#123;</span><br><span class="line">           <span class="variable">$conn</span> = <span class="title class_">Db</span>::<span class="title function_ invoke__">connect</span>(<span class="variable">$DbconnName</span>);</span><br><span class="line">       &#125;<span class="keyword">catch</span> (\<span class="built_in">InvalidArgumentException</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&#x27;连接异常&#x27;</span>;</span><br><span class="line">           <span class="keyword">die</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable">$conn</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="添加模型"><a href="#添加模型" class="headerlink" title="添加模型"></a>添加模型</h4><h5 id="Agent-php"><a href="#Agent-php" class="headerlink" title="Agent.php"></a>Agent.php</h5><p>查询和增删改都可以调用query，如果你没有想要获取的结果集的话可以调用<code>execute()</code>。</p>
<p><code>query()</code>有一个弊端，如果你的绑定参数的形式（非参数绑定）是直接写进sql的话，他有可能会判断你这个不是一个储存过程；<br>具体实现请查看thinkphp&#x2F;library&#x2F;think&#x2F;db&#x2F;Connection.php:368行，当然也不会有结果集返回。</p>
<p>你也可以用调用<code>procedure()</code>,这个方法调用的话就一定会返回结果集。</p>
<p>起初我就是这个问题，并没有采用绑定参数的形式提交，直接写sql，就获取不到结果集，后来我在我的sql提行里面加入了<code>SET NOCOUNT ON;</code>，才能勉强拿到返回，在文章最后我给出了我最开始获取的结果集的方案例子，但是真的拉稀，你们可以看看，不要吐槽。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Dbname</span> = <span class="string">&#x27;UserDBConn&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">GetIndirectAgentList</span>(<span class="params"><span class="variable">$agentId</span>,<span class="variable">$strAccount</span>,<span class="variable">$strSuperior</span>,<span class="variable">$iPageIndex</span>,<span class="variable">$pagesize</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$conn</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Dbconn</span>(<span class="variable">$this</span>-&gt;Dbname);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="variable">$TotalCount</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="variable">$res</span> = <span class="variable">$conn</span>::<span class="title function_ invoke__">query</span>(<span class="string">&#x27;exec [dbo].[Agent_GetAgentList] :agentId,:strAccount,:strSuperior,:iPageIndex,:pagesize,:TotalCount&#x27;</span>, [</span><br><span class="line">                <span class="string">&#x27;agentId&#x27;</span> =&gt; <span class="variable">$agentId</span>,</span><br><span class="line">                <span class="string">&#x27;strAccount&#x27;</span> =&gt; [<span class="variable">$strAccount</span>, PDO::<span class="variable constant_">PARAM_STR</span>],</span><br><span class="line">                <span class="string">&#x27;strSuperior&#x27;</span> =&gt; [<span class="variable">$strSuperior</span>, PDO::<span class="variable constant_">PARAM_STR</span>],</span><br><span class="line">                <span class="string">&#x27;iPageIndex&#x27;</span> =&gt; [<span class="variable">$iPageIndex</span>, PDO::<span class="variable constant_">PARAM_INT</span>],</span><br><span class="line">                <span class="string">&#x27;pagesize&#x27;</span> =&gt; [<span class="variable">$pagesize</span>, PDO::<span class="variable constant_">PARAM_INT</span>],</span><br><span class="line">                <span class="string">&#x27;TotalCount&#x27;</span> =&gt; [<span class="variable">$TotalCount</span>, PDO::<span class="variable constant_">PARAM_INPUT_OUTPUT</span>],</span><br><span class="line">            ]);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (PDOException <span class="variable">$e</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="最初的Agent-php"><a href="#最初的Agent-php" class="headerlink" title="最初的Agent.php"></a>最初的Agent.php</h5><p>很显然 这里并不会获取到@AgentID 以及  @TotalCount；他只会返回Agent_GetAgentList的结果集</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">GetIndirectAgentList</span>(<span class="params"><span class="variable">$agentId</span>,<span class="variable">$strAccount</span>,<span class="variable">$strSuperior</span>,<span class="variable">$iPageIndex</span>,<span class="variable">$pagesize</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$conn</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Dbconn</span>(<span class="variable">$this</span>-&gt;Dbname);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$res</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;</span></span><br><span class="line"><span class="string">                SET NOCOUNT ON;</span></span><br><span class="line"><span class="string">                declare @AgentID int;</span></span><br><span class="line"><span class="string">                declare @TotalCount int;</span></span><br><span class="line"><span class="string">                exec [dbo].[Agent_GetAgentList] &#x27;</span>.<span class="variable">$agentId</span>.<span class="string">&#x27;,\&#x27;&#x27;</span>.<span class="variable">$strAccount</span>.<span class="string">&#x27;\&#x27;,\&#x27;&#x27;</span>.<span class="variable">$strSuperior</span>.<span class="string">&#x27;\&#x27;,&#x27;</span>.<span class="variable">$iPageIndex</span>.<span class="string">&#x27;,&#x27;</span>.<span class="variable">$pagesize</span>.<span class="string">&#x27;,@TotalCount output;</span></span><br><span class="line"><span class="string">                select @AgentID as AgentID,@TotalCount as TotalCount</span></span><br><span class="line"><span class="string">                &#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (PDOException <span class="variable">$e</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>见识略薄（也可能是我的理解和使用方式不对），也希望你们在使用的过程中能有所帮助！<br>原创不易，转载请附上原文出处链接,谢谢<br>原文链接：<a target="_blank" rel="noopener" href="https://lihengc.coding.me/2020/01/06/thinkphp%E8%B0%83%E7%94%A8sqlserver%E5%82%A8%E5%AD%98%E8%BF%87%E7%A8%8B%E8%BF%94%E5%9B%9E%E5%A4%9A%E4%B8%AA%E7%BB%93%E6%9E%9C%E9%9B%86/">lihengc.coding.me</a> </p>
</blockquote>

        </div>
        <div class="itp-m3-post-info_area">
          <div class="info_area-category">
            
            
            <div class="itp-m3-chip-normal-list">
              <a class="tag-none-link" href="/tags/php/" rel="tag">php</a><a class="tag-none-link" href="/tags/thinkphp/" rel="tag">thinkphp</a>
            </div>
            
          </div>
          <div class="info_area-copyright">
            <p>本文著作权归作者&nbsp李恒&nbsp所有，转载或引用请联系作者获得授权。</p>
          </div>
        </div>
      </div>
      
      <div class="itp-m3-card itp-m3-post-comment_area" id="comment">
        
<div id="waline"></div>
<script>
  function startWaline() {
    Waline.init({
      el: '#waline',
      serverURL: 'https://comment.tripper.press/',
      path: '/2020/01/06/thinkphp%E8%B0%83%E7%94%A8sqlserver%E5%82%A8%E5%AD%98%E8%BF%87%E7%A8%8B%E8%BF%94%E5%9B%9E%E5%A4%9A%E4%B8%AA%E7%BB%93%E6%9E%9C%E9%9B%86/',
      dark: 'auto',
      search: false,
      imageUploader: false,
      wordLimit: [5, 200],
      emoji: [
        'https://imgur.lzmun.com/press_assets/emojis/bili'
      ],
    })
  };
  document.addEventListener("DOMContentLoaded", startWaline);
</script>
<style>
  button[title="表情包"] {
    display: none;
  }

  .wl-panel {
    border-radius: 3px !important;
  }

  .wl-btn {
    border-radius: 3px !important;
  }

  .wl-power {
    text-align: center;
    opacity: 0.3;
  }
</style>

      </div>
      
    </div>
    <div class="right-area">
      
      

<div id="column-toc-m3" class="noprn column-toc-m3 itp-toc-m3-sidetop">
  <ol class="itp-toc"><li class="itp-toc-item itp-toc-level-3"><a class="itp-toc-link" href="#%E9%A6%96%E5%85%88%E5%AE%89%E8%A3%85%E6%89%A9%E5%B1%95"><span class="itp-toc-text">首先安装扩展</span></a></li><li class="itp-toc-item itp-toc-level-3"><a class="itp-toc-link" href="#thinkphp%E6%93%8D%E4%BD%9Csqlsrv%E5%82%A8%E5%AD%98%E8%BF%87%E7%A8%8B"><span class="itp-toc-text">thinkphp操作sqlsrv储存过程</span></a></li></ol>
</div>

      
    </div>
  </div>
  
  <!--
<div class="mdui-dialog" id="shareDialogText" style="text-align: center;">
  <div class="itp-share-card" id="shareInfo">
    <div class="itp-share-cover" style="background: url('');">
      <div class="itp-share-layer">
        <div class="itp-share-info">
          <div class="itp-share-avatar">
            <img src="https://lihengc.github.io/images/WechatIMG10.jpeg" class="nofancy">
          </div>
          <div class="itp-share-title">thinkphp调用sqlserver储存过程返回多个结果集</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="mdui-dialog" id="shareDialogImg" style="text-align: center;">
  分享图已生成
</div>-->
</section>
  <!-- Footer -->
  <!-- Footer -->
<footer class="itp-footer text-center">
  <section class="footer-info">
    Harthali &copy; 2016 - 2025
    
    <span> / </span>
    65k
    
    
    
    <span> / Theme</span>
    <a href="https://github.com/aiokr/hexo-theme-type" target="_blank">Type
    </a>
  </section>
  
    <a href="../about/" target="_blank">
      <img width="80px" height="80px" style="padding-top: 12px; display: block; margin: 0 auto;" src="https://imgur.lzmun.com/picgo/after2022/tripper2whitefull.png_avatar" alt="footer logo"></a>
  
</footer>
  <!-- After footer scripts -->
  <!-- fancybox -->

<script src="/js/fancybox.umd.js" defer></script>
<link rel="stylesheet" href="/css/fancybox.css" />

<!-- mdui -->

<!-- busuanzi -->

<!-- highlightjs -->


<script src="/js/highlight.min.js" async></script>

<script>window.addEventListener('load', () => hljs.initHighlighting());</script>
<script>
  $("pre.code").each(function() {
    $(this).html("<ol><li>" + $(this).html().replace(/\n/g, "\n</li><li>") + "\n</li></ol>");
  });
</script>



<script src="/js/app.js"></script>



<!--

<script src="/js/canvas2image.js"></script>


<script src="/js/shareimg.js"></script>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.js" defer></script>
-->
<!--lazyload-->


<script src="/js/lazyload.js"></script>


<!--PJAX-->
<!--Pjax from https://github.com/MoOx/pjax-->

<!--<script src="https://cdn.jsdelivr.net/npm/pjax/pjax.js"></script>-->
<!---->
<!---->
<!---->
<!---->
<!--首页键盘快捷键-->

  <style>
  :root {
    --main-color: #71AFDD;
    --sub-color: #6CD9CE;
    --main-black: #222831;
  }
</style>
</body>




</html>
